const{abs:t,acos:e,asin:a,atan:r,atan2:n,ceil:i,cos:l,exp:s,floor:o,log:h,hypot:y,max:c,min:u,pow:x,random:f,round:p,sin:g,sqrt:d,tan:v,PI:w}=Math;async function m(t,{minSize:e=1e3,maxSize:a=5e3,filter:r="",scale:n=1,stripWhite:i=!0,crop:l=!0,canvas:s=null,brightness:o=1,contrast:h=1,invert:y=!1,blur:c=0}={}){let u,x,f=function(t){if(t instanceof HTMLImageElement)return"img";if(t instanceof SVGElement)return"svg";if(t instanceof HTMLCanvasElement)return"canvas";if(t instanceof File)return"file";if(t instanceof ArrayBuffer)return"buffer";if(t instanceof Blob)return"blob";if(Array.isArray(t))return"array";if("string"==typeof t){let e=/^(file:|https?:\/\/|\/|\.\/|\.\.\/)/.test(t),a=t.startsWith("data:image");return e||a?"url":"string"}let e=typeof t,a=t.constructor.name;return(a||e).toLowerCase()}(t),p={minSize:e,maxSize:a,filter:r,scale:n,brightness:o,contrast:h,invert:y,blur:c,canvas:s};if("img"===f)x=t.src,u=await b(x,p);else if("blob"===f||"file"===f)x=await URL.createObjectURL(t),u=await b(x,p);else if("url"===f)x=t,console.log("is URL",t),u=await b(x,p);else if("svg"===f)x=await M(t),u=await b(x,p);else if("canvas"===f){let e=t.getContext("2d"),a=`grayscale(1) invert(${y=y?"1":"0"}) blur(${c}px) brightness(${o}) contrast(${h})`;e.filter=a;let r=await e.getImageData(0,0,t.width,t.height);u={imgData:r,width:r.width,height:r.height,scaleAdjust:1}}let{imgData:g,scaleAdjust:d,width:v,height:w}=u,m={x:0,y:0,width:0,height:0};l&&(m=function(t,e=!0,a=!0,r=!1,n=null){let[i,l]=[t.width,t.height];if(!i&&!l)throw new Error("No width or height specified");let s,o=[],h={x:0,y:0,width:i,height:l},y=new Uint32Array(t.data.buffer),c=0,u="";const x=(t,e,a)=>{let r=Math.floor(a/t);return{x:a-r*t,y:r}},f=(t=0,e=!1,a=null)=>{if(r&&a){c++;let t=x(i,0,a);u+=`<rect x="${t.x}" y="${t.y}" transform="scale(1)" transform-origin="center" width="1" height="1" fill="rgba(0,255,255,0.25)" stroke="none" />`}return e?t<4294867295:t>0};let p=0,g=0,d=0,v=0,w=i,m=l,b=0,A=i*l-1,[M,$,S,z]=[1,1,1,1];if(a){let t=Math.floor(i/2),a=Math.floor(l/2),n=[0,l*i-1,i-1,l*i-i,t,l*i-t-1,a*i-1,a*i];for(let t=0;t<n.length;t++){let a=n[t];if(!(M||z||$||S))break;f(y[a],e,a)&&(0===t?(M=0,$=0):1===t?(z=0,S=0):2===t?(z=0,$=0):3===t?(M=0,$=0):4===t?M=0:5===t?z=0:6===t?S=0:7===t&&($=0))}if(r&&console.log("corner mid check",c,"cropTop",M,"cropLeft",$,"cropRight",S,"cropBottom",z),!(M||$||S||z))return r&&console.log("image cannot be cropped â€“ opaque pixels in corners",c,"cropTop",M,"cropLeft",$,"cropRight",S,"cropBottom",z),h}for(g=0;g<l;g++){for(p=0;p<i&&(!M||!f(y[b],e,b)||(d=g,M=0,o.push(p),z))&&(!z||!f(y[A],e,A)||(m=l-g,z=0,s=x(i,0,A),o.push(s.x),M));p++)b++,A--;if(!M&&!z)break;if(g+2>=l-g&&!d)return r&&(console.log("image is empty",g,c,i*l),n.insertAdjacentHTML("beforeend",u)),h}for(p=0;p<i;p++)for(b=(d+1)*i+p,A=d*i+(i-p-1),g=d;g<m-1&&(!$||!f(y[b],e,b)||(v=p,$=0,S))&&(!S||!f(y[A],e,A)||(w=i-p,S=0,$));g++)b+=i,A+=i;return v=Math.min(...o,v),w=Math.max(...o,w),h.x=v,h.y=d,h.width=w-v,h.height=m-d,r&&(console.log(c,i*l,"skipped:",i*l-c,o),n.insertAdjacentHTML("beforeend",u)),h}(g,i),v=Math.ceil(m.width/d),w=Math.ceil(m.height/d),u.width=v,u.height=w);let A=function(t,e=0,a=0,r=0,n=0){let{data:i,width:l,height:s}=t;r=r||l,n=n||s;let o=new $(r,n),h=4*l,y=0;for(let t=a;t<a+n;t++){let a=0,n=t*h;for(let t=e;t<e+r;t++){let e=i[n+4*t],l=y*r+a;o.data[l]=e<127?1:0,a++}y++}return o}(g,m.x,m.y,m.width,m.height);return{bmp:A,scaleAdjust:d,width:v,height:w}}async function b(t="",{minSize:e=1e3,maxSize:a=5e3,scale:r=1,brightness:n=1,contrast:i=1,invert:l=0,blur:s=0,canvas:o=null}={}){let h,y,c,u,x=1,f=0;e*=r,a*=r,o||((o=document.getElementById("canvasPot"))||(o=document.createElement("canvas")),o.id="canvasPot",document.body.append(o));let p,g=o.getContext("2d",{alpha:!1,willReadFrequently:!0}),d=await fetch(t);if(d.ok){let r=await d.blob(),{type:v}=r;"image/svg+xml"!==v?(p=!0,h=await createImageBitmap(r),[y,c]=[h.width,h.height]):(h=new Image,h.src=t,h.crossOrigin="anonymous",await h.decode(),[y,c]=[h.naturalWidth,h.naturalHeight]),f=Math.min(y,c),x=!p&&(f<e||f>a)?e/f:1,y*=x,c*=x,o.width=y,o.height=c,g.fillStyle="white",g.fillRect(0,0,y,c);let w=`grayscale(1) invert(${l=l?"1":"0"}) blur(${s}px) brightness(${n}) contrast(${i})`;g.filter=w,g.drawImage(h,0,0,y,c),u=g.getImageData(0,0,y,c)}let{width:v,height:w}=u;return v=Math.ceil(v/x),w=Math.ceil(w/x),{imgData:u,scaleAdjust:x,width:v,height:w}}async function A(t,{minSize:e=1e3,maxSize:a=5e3,filter:r="",scale:n=1,canvas:i=null}={}){i||(i=document.createElement("canvas"));let l=await M(t),s=new Image;s.src=l,s.crossOrigin="anonymous",await s.decode();let[o,h]=[s.naturalWidth,s.naturalHeight],y=Math.min(o,h),c=y<e||y>a?e/y:1,u=o*c,x=h*c;i.width=u,i.height=x;let f=i.getContext("2d");return f.fillStyle="white",f.fillRect(0,0,u,x),r&&(f.filter=r),f.drawImage(s,0,0,u,x),URL.revokeObjectURL(l),i}async function M(t){const e=t.cloneNode(!0);if(document.body.append(e),!e.hasAttribute("width")&&!e.hasAttribute("height")){let a=e.hasAttribute("viewBox")?{x:0,y:0,width:300,height:150}:t.getBBox(),r=t.viewBox.baseVal.width?e.viewBox.baseVal.width:t.width.baseVal.value?t.width.baseVal.value:a.width,n=t.viewBox.baseVal.height?e.viewBox.baseVal.height:t.height.baseVal.value?t.height.baseVal.value:a.height;e.setAttribute("width",r),e.setAttribute("height",n)}let a=(new XMLSerializer).serializeToString(e),r=new Blob([a],{type:"image/svg+xml"}),n=URL.createObjectURL(r);return e.remove(),n}function $(t,e){this.w=t,this.h=e,this.size=t*e,this.arraybuffer=new ArrayBuffer(this.size),this.data=new Int8Array(this.arraybuffer)}function S(){this.area=0,this.len=0,this.curve={},this.pt=[],this.minX=1e5,this.minY=1e5,this.maxX=-1,this.maxY=-1}function z(t){this.n=t,this.tag=new Array(t),this.c=new Array(3*t),this.alphaCurve=0,this.vertex=new Array(t),this.alpha=new Array(t),this.alpha0=new Array(t),this.beta=new Array(t)}function L(t,e=1){let a=t.curve,r=a.n,n=[];n.push({x:a.c[3*(r-1)+2].x*e,y:a.c[3*(r-1)+2].y*e});for(let t=0;t<r;t++){let r=a.tag[t];"curve"===r?n.push({x:a.c[3*t+2].x*e,y:a.c[3*t+2].y*e}):"corner"===r&&n.push({x:a.c[3*t+1].x*e,y:a.c[3*t+1].y*e},{x:a.c[3*t+2].x*e,y:a.c[3*t+2].y*e})}return n}function D(t,{turnpolicy:e="majority",turdsize:a=1,optcurve:r=!0,alphamax:n=1,opttolerance:i=1,getPolygon:l=!0}={}){let s=[],o=[];return(()=>{let r,n=t.copy(),i={x:0,y:0};const l=t=>{let e=n.w*t.y+t.x;for(;e<n.size&&1!==n.data[e];)e++;return e<n.size&&n.index(e)},o=(t,e)=>{for(let a=2;a<5;a++){let r=0;for(let i=1-a;i<=a-1;i++)r+=n.at(t+i,e+a-1)?1:-1,r+=n.at(t+a-1,e+i-1)?1:-1,r+=n.at(t+i-1,e-a)?1:-1,r+=n.at(t-a,e+i)?1:-1;if(r>0)return 1;if(r<0)return 0}return 0},h=a=>{let r,i=new S,l=a.x,s=a.y,h=0,y=1;for(i.sign=t.at(a.x,a.y)?"+":"-";i.pt.push({x:l,y:s}),l>i.maxX&&(i.maxX=l),l<i.minX&&(i.minX=l),s>i.maxY&&(i.maxY=s),s<i.minY&&(i.minY=s),i.len++,l+=h,s+=y,i.area-=l*y,l!==a.x||s!==a.y;){let t=n.at(l+(h+y-1)/2,s+(y-h-1)/2),a=n.at(l+(h-y-1)/2,s+(y+h-1)/2);a&&!t?"right"===e||"black"===e&&"+"===i.sign||"white"===e&&"-"===i.sign||"majority"===e&&o(l,s)||"minority"===e&&!o(l,s)?(r=h,h=-y,y=r):(r=h,h=y,y=-r):a?(r=h,h=-y,y=r):t||(r=h,h=y,y=-r)}return i},y=t=>{let e,a,r=t.pt[0].y,i=t.len;for(let l=1;l<i;l++){let i=t.pt[l].x,s=t.pt[l].y;if(s!==r){a=r<s?r:s,e=t.maxX;for(let t=i;t<e;t++)n.flip(t,a);r=s}}};for(;i=l(i);)r=h(i),y(r),r.area>a&&s.push(r)})(),(()=>{function t(){this.data=[0,0,0,0,0,0,0,0,0]}function e(t,e,a,r,n){this.x=t,this.y=e,this.xy=a,this.x2=r,this.y2=n}t.prototype.at=function(t,e){return this.data[3*t+e]};const a=(t,e)=>t>=e?t%e:t>=0?t:e-1-(-1-t)%e,h=(t,e)=>t.x*e.y-t.y*e.x,y=(t,e,a)=>t<=a?t<=e&&e<a:t<=e||e<a,c=t=>t>0?1:t<0?-1:0,u=(t,e)=>{let a=new Array(3),r=0;a[0]=e.x,a[1]=e.y,a[2]=1;for(let e=0;e<3;e++)for(let n=0;n<3;n++)r+=a[e]*t.at(e,n)*a[n];return r},x=(t,e,a)=>({x:e.x+t*(a.x-e.x),y:e.y+t*(a.y-e.y)}),f=(t,e)=>{let a=((t,e)=>({x:-c(e.y-t.y),y:c(e.x-t.x)}))(t,e);return a.y*(e.x-t.x)-a.x*(e.y-t.y)},p=(t="",e={},a={},r={},n={})=>{let i,l,s,o;return"cprod"===t||"iprod1"===t?(i=a.x-e.x,s=a.y-e.y,l=n.x-r.x,o=n.y-r.y):(i=a.x-e.x,s=a.y-e.y,l=r.x-e.x,o=r.y-e.y),"cprod"===t||"dpara"===t?i*o-l*s:i*l+s*o},g=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),d=(t,e,a,r,n)=>{let i=1-t;return{x:i*i*i*e.x+i*i*t*3*a.x+t*t*i*3*r.x+t*t*t*n.x,y:i*i*i*e.y+i*i*t*3*a.y+t*t*i*3*r.y+t*t*t*n.y}},v=(t,e,a,r,n,i)=>{let l=p("cprod",t,e,n,i),s=p("cprod",e,a,n,i),o=l-2*s+p("cprod",a,r,n,i),h=-2*l+2*s,y=h*h-4*o*l;if(0===o||y<0)return-1;let c=Math.sqrt(y),u=(-h+c)/(2*o),x=(-h-c)/(2*o);return u>=0&&u<=1?u:x>=0&&x<=1?x:-1},w=t=>{t.x0=t.pt[0].x,t.y0=t.pt[0].y,t.sums=[];let a=t.sums;a.push(new e(0,0,0,0,0));for(let r=0;r<t.len;r++){let n=t.pt[r].x-t.x0,i=t.pt[r].y-t.y0;a.push(new e(a[r].x+n,a[r].y+i,a[r].xy+n*i,a[r].x2+n*n,a[r].y2+i*i))}},m=t=>{let e,r=t.len,n=t.pt,i=new Array(r),l=new Array(r),s=new Array(4);t.lon=new Array(r);let o,u,x,f,p,g,d,v,w=[{x:0,y:0},{x:0,y:0}],m={x:0,y:0},b={x:0,y:0},A={x:0,y:0},M=0;for(u=r-1;u>=0;u--)n[u].x!=n[M].x&&n[u].y!=n[M].y&&(M=u+1),l[u]=M;for(u=r-1;u>=0;u--){for(s[0]=s[1]=s[2]=s[3]=0,e=(3+3*(n[a(u+1,r)].x-n[u].x)+(n[a(u+1,r)].y-n[u].y))/2,s[e]++,w[0].x=0,w[0].y=0,w[1].x=0,w[1].y=0,M=l[u],f=u;;){if(o=0,e=(3+3*c(n[M].x-n[f].x)+c(n[M].y-n[f].y))/2,s[e]++,s[0]&&s[1]&&s[2]&&s[3]){i[u]=f,o=1;break}if(m.x=n[M].x-n[u].x,m.y=n[M].y-n[u].y,h(w[0],m)<0||h(w[1],m)>0)break;if(Math.abs(m.x)<=1&&Math.abs(m.y)<=1||(b.x=m.x+(m.y>=0&&(m.y>0||m.x<0)?1:-1),b.y=m.y+(m.x<=0&&(m.x<0||m.y<0)?1:-1),h(w[0],b)>=0&&(w[0].x=b.x,w[0].y=b.y),b.x=m.x+(m.y<=0&&(m.y<0||m.x<0)?1:-1),b.y=m.y+(m.x>=0&&(m.x>0||m.y<0)?1:-1),h(w[1],b)<=0&&(w[1].x=b.x,w[1].y=b.y)),f=M,M=l[f],!y(M,u,f))break}0===o&&(A.x=c(n[M].x-n[f].x),A.y=c(n[M].y-n[f].y),m.x=n[f].x-n[u].x,m.y=n[f].y-n[u].y,p=h(w[0],m),g=h(w[0],A),d=h(w[1],m),v=h(w[1],A),x=1e7,g<0&&(x=Math.floor(p/-g)),v>0&&(x=Math.min(x,Math.floor(-d/v))),i[u]=a(f+x,r))}for(x=i[r-1],t.lon[r-1]=x,u=r-2;u>=0;u--)y(u+1,i[u],x)&&(x=i[u]),t.lon[u]=x;for(u=r-1;y(a(u+1,r),x,t.lon[u]);u--)t.lon[u]=x},b=t=>{const e=(t,e,a)=>{let r,n,i,l,s,o,h,y,c,u,x,f,p,g,d=t.len,v=t.pt,w=t.sums,m=0;return a>=d&&(a-=d,m=1),0===m?(r=w[a+1].x-w[e].x,n=w[a+1].y-w[e].y,l=w[a+1].x2-w[e].x2,i=w[a+1].xy-w[e].xy,s=w[a+1].y2-w[e].y2,o=a+1-e):(r=w[a+1].x-w[e].x+w[d].x,n=w[a+1].y-w[e].y+w[d].y,l=w[a+1].x2-w[e].x2+w[d].x2,i=w[a+1].xy-w[e].xy+w[d].xy,s=w[a+1].y2-w[e].y2+w[d].y2,o=a+1-e+d),x=(v[e].x+v[a].x)/2-v[0].x,f=(v[e].y+v[a].y)/2-v[0].y,g=v[a].x-v[e].x,p=-(v[a].y-v[e].y),h=(l-2*r*x)/o+x*x,y=(i-r*f-n*x)/o+x*f,c=(s-2*n*f)/o+f*f,u=p*p*h+2*p*g*y+g*g*c,Math.sqrt(u)};let r,n,i,l,s,o,h,y=t.len,c=new Array(y+1),u=new Array(y+1),x=new Array(y),f=new Array(y+1),p=new Array(y+1),g=new Array(y+1);for(r=0;r<y;r++)h=a(t.lon[a(r-1,y)]-1,y),h==r&&(h=a(r+1,y)),x[r]=h<r?y:h;for(n=1,r=0;r<y;r++)for(;n<=x[r];)f[n]=r,n++;for(r=0,n=0;r<y;n++)p[n]=r,r=x[r];for(p[n]=y,i=n,r=y,n=i;n>0;n--)g[n]=r,r=f[r];for(g[0]=0,c[0]=0,n=1;n<=i;n++)for(r=g[n];r<=p[n];r++){for(o=-1,l=p[n-1];l>=f[r];l--)s=e(t,l,r)+c[l],(o<0||s<o)&&(u[r]=l,o=s);c[r]=o}for(t.m=i,t.po=new Array(i),r=y,n=i-1;r>0;n--)r=u[r],t.po[n]=r},A=e=>{const r=(t,e,a,r,n)=>{let i,l,s,o,h,y,c,u,x,f,p,g=t.len,d=t.sums,v=0;for(;a>=g;)a-=g,v+=1;for(;e>=g;)e-=g,v-=1;for(;a<0;)a+=g,v-=1;for(;e<0;)e+=g,v+=1;i=d[a+1].x-d[e].x+v*d[g].x,l=d[a+1].y-d[e].y+v*d[g].y,s=d[a+1].x2-d[e].x2+v*d[g].x2,o=d[a+1].xy-d[e].xy+v*d[g].xy,h=d[a+1].y2-d[e].y2+v*d[g].y2,y=a+1-e+v*g,r.x=i/y,r.y=l/y,c=(s-i*i/y)/y,u=(o-i*l/y)/y,x=(h-l*l/y)/y,f=(c+x+Math.sqrt((c-x)*(c-x)+4*u*u))/2,c-=f,x-=f,Math.abs(c)>=Math.abs(x)?(p=Math.sqrt(c*c+u*u),0!==p&&(n.x=-u/p,n.y=c/p)):(p=Math.sqrt(x*x+u*u),0!==p&&(n.x=-x/p,n.y=u/p)),0===p&&(n.x=n.y=0)};let n,i,l,s,o,h,y,c,x,f,p,g,d,v,w,m=e.m,b=e.po,A=e.len,M=e.pt,$=e.x0,S=e.y0,L=new Array(m),D=new Array(m),R=new Array(m),j=new Array(3),k={x:0,y:0};for(e.curve=new z(m),i=0;i<m;i++)l=b[a(i+1,m)],l=a(l-b[i],A)+b[i],L[i]={x:0,y:0},D[i]={x:0,y:0},r(e,b[i],l,L[i],D[i]);for(i=0;i<m;i++)if(R[i]=new t,n=D[i].x*D[i].x+D[i].y*D[i].y,0===n)for(l=0;l<3;l++)for(s=0;s<3;s++)R[i].data[3*l+s]=0;else for(j[0]=D[i].y,j[1]=-D[i].x,j[2]=-j[1]*L[i].y-j[0]*L[i].x,o=0;o<3;o++)for(s=0;s<3;s++)R[i].data[3*o+s]=j[o]*j[s]/n;for(i=0;i<m;i++){for(h=new t,y={x:0,y:0},k.x=M[b[i]].x-$,k.y=M[b[i]].y-S,l=a(i-1,m),o=0;o<3;o++)for(s=0;s<3;s++)h.data[3*o+s]=R[l].at(o,s)+R[i].at(o,s);for(;;){if(f=h.at(0,0)*h.at(1,1)-h.at(0,1)*h.at(1,0),0!==f){y.x=(-h.at(0,2)*h.at(1,1)+h.at(1,2)*h.at(0,1))/f,y.y=(h.at(0,2)*h.at(1,0)-h.at(1,2)*h.at(0,0))/f;break}for(h.at(0,0)>h.at(1,1)?(j[0]=-h.at(0,1),j[1]=h.at(0,0)):h.at(1,1)?(j[0]=-h.at(1,1),j[1]=h.at(1,0)):(j[0]=1,j[1]=0),n=j[0]*j[0]+j[1]*j[1],j[2]=-j[1]*k.y-j[0]*k.x,o=0;o<3;o++)for(s=0;s<3;s++)h.data[3*o+s]+=j[o]*j[s]/n}if(c=Math.abs(y.x-k.x),x=Math.abs(y.y-k.y),c<=.5&&x<=.5)e.curve.vertex[i]={x:y.x+$,y:y.y+S};else{if(p=u(h,k),d=k.x,v=k.y,0!==h.at(0,0))for(w=0;w<2;w++)y.y=k.y-.5+w,y.x=-(h.at(0,1)*y.y+h.at(0,2))/h.at(0,0),c=Math.abs(y.x-k.x),g=u(h,y),c<=.5&&g<p&&(p=g,d=y.x,v=y.y);if(0!==h.at(1,1))for(w=0;w<2;w++)y.x=k.x-.5+w,y.y=-(h.at(1,0)*y.x+h.at(1,2))/h.at(1,1),x=Math.abs(y.y-k.y),g=u(h,y),x<=.5&&g<p&&(p=g,d=y.x,v=y.y);for(o=0;o<2;o++)for(s=0;s<2;s++)y.x=k.x-.5+o,y.y=k.y-.5+s,g=u(h,y),g<p&&(p=g,d=y.x,v=y.y);e.curve.vertex[i]={x:d+$,y:v+S}}}},M=t=>{let e,a,r,n=t.curve,i=n.n,l=n.vertex;for(e=0,a=i-1;e<a;e++,a--)r=l[e],l[e]=l[a],l[a]=r},$=t=>{let e,r,i,l,s,o,h,y,c,u=t.curve.n,g=t.curve;for(e=0;e<u;e++)r=a(e+1,u),i=a(e+2,u),c=x(.5,g.vertex[i],g.vertex[r]),s=f(g.vertex[e],g.vertex[i]),0!==s?(l=p("dpara",g.vertex[e],g.vertex[r],g.vertex[i])/s,l=Math.abs(l),o=l>1?1-1/l:0,o/=.75):o=4/3,g.alpha0[r]=o,o>=n?(g.tag[r]="corner",g.c[3*r+1]=g.vertex[r],g.c[3*r+2]=c):(o<.55?o=.55:o>1&&(o=1),h=x(.5+.5*o,g.vertex[e],g.vertex[r]),y=x(.5+.5*o,g.vertex[i],g.vertex[r]),g.tag[r]="curve",g.c[3*r+0]=h,g.c[3*r+1]=y,g.c[3*r+2]=c),g.alpha[r]=o,g.beta[r]=.5;g.alphacurve=1},S=t=>{function e(){this.pen=0,this.c=[{x:0,y:0},{x:0,y:0}],this.t=0,this.s=0,this.alpha=0}const r=(t,e,r,n,i,l,s)=>{let o,h,y,u,f,w,m,b,A,M,$,S,z,L,D,R,j,k,C,P,B,E,F,T=t.curve.n,q=t.curve,O=q.vertex;if(e==r)return 1;if(o=e,f=a(e+1,T),h=a(o+1,T),u=l[h],0===u)return 1;for(b=g(O[e],O[f]),o=h;o!=r;o=h){if(h=a(o+1,T),y=a(o+2,T),l[h]!=u)return 1;if(c(p("cprod",O[e],O[f],O[h],O[y]))!=u)return 1;if(p("iprod1",O[e],O[f],O[h],O[y])<b*g(O[h],O[y])*-.999847695156)return 1}if($=q.c[3*a(e,T)+2],S=O[a(e+1,T)],z=O[a(r,T)],L=q.c[3*a(r,T)+2],w=s[r]-s[e],w-=p("dpara",O[0],q.c[3*e+2],q.c[3*r+2])/2,e>=r&&(w+=s[T]),k=p("dpara",$,S,z),C=p("dpara",$,S,L),P=p("dpara",$,z,L),B=k+P-C,C===k)return 1;if(F=P/(P-B),E=C/(C-k),R=C*F/2,0===R)return 1;for(j=w/R,m=2-Math.sqrt(4-j/.3),n.c[0]=x(F*m,$,S),n.c[1]=x(E*m,L,z),n.alpha=m,n.t=F,n.s=E,S={x:n.c[0].x,y:n.c[0].y},z={x:n.c[1].x,y:n.c[1].y},n.pen=0,o=a(e+1,T);o!=r;o=h){if(h=a(o+1,T),F=v($,S,z,L,O[o],O[h]),F<-.5)return 1;if(D=d(F,$,S,z,L),b=g(O[o],O[h]),0===b)return 1;if(A=p("dpara",O[o],O[h],D)/b,Math.abs(A)>i)return 1;if(p("iprod",O[o],O[h],D)<0||p("iprod",O[h],O[o],D)<0)return 1;n.pen+=A*A}for(o=e;o!=r;o=h){if(h=a(o+1,T),F=v($,S,z,L,q.c[3*o+2],q.c[3*h+2]),F<-.5)return 1;if(D=d(F,$,S,z,L),b=g(q.c[3*o+2],q.c[3*h+2]),0===b)return 1;if(A=p("dpara",q.c[3*o+2],q.c[3*h+2],D)/b,M=p("dpara",q.c[3*o+2],q.c[3*h+2],O[h])/b,M*=.75*q.alpha[h],M<0&&(A=-A,M=-M),A<M-i)return 1;A<M&&(n.pen+=(A-M)*(A-M))}return 0};let n,l,s,o,h,y,u,f,w,m,b,A=t.curve,M=A.n,$=A.vertex,S=new Array(M+1),L=new Array(M+1),D=new Array(M+1),R=new Array(M+1),j=new e,k=new Array(M),C=new Array(M+1);for(l=0;l<M;l++)"curve"==A.tag[l]?k[l]=c(p("dpara",$[a(l-1,M)],$[l],$[a(l+1,M)])):k[l]=0;for(u=0,C[0]=0,h=A.vertex[0],l=0;l<M;l++)y=a(l+1,M),"curve"==A.tag[y]&&(f=A.alpha[y],u+=.3*f*(4-f)*p("dpara",A.c[3*l+2],$[y],A.c[3*y+2])/2,u+=p("dpara",h,A.c[3*l+2],A.c[3*y+2])/2),C[l+1]=u;for(S[0]=-1,L[0]=0,D[0]=0,s=1;s<=M;s++)for(S[s]=s-1,L[s]=L[s-1],D[s]=D[s-1]+1,l=s-2;l>=0&&(o=r(t,l,a(s,M),j,i,k,C),!o);l--)(D[s]>D[l]+1||D[s]==D[l]+1&&L[s]>L[l]+j.pen)&&(S[s]=l,L[s]=L[l]+j.pen,D[s]=D[l]+1,R[s]=j,j=new e);for(n=D[M],w=new z(n),m=new Array(n),b=new Array(n),s=M,l=n-1;l>=0;l--)S[s]==s-1?(w.tag[l]=A.tag[a(s,M)],w.c[3*l+0]=A.c[3*a(s,M)+0],w.c[3*l+1]=A.c[3*a(s,M)+1],w.c[3*l+2]=A.c[3*a(s,M)+2],w.vertex[l]=A.vertex[a(s,M)],w.alpha[l]=A.alpha[a(s,M)],w.alpha0[l]=A.alpha0[a(s,M)],w.beta[l]=A.beta[a(s,M)],m[l]=b[l]=1):(w.tag[l]="curve",w.c[3*l+0]=R[s].c[0],w.c[3*l+1]=R[s].c[1],w.c[3*l+2]=A.c[3*a(s,M)+2],w.vertex[l]=x(R[s].s,A.c[3*a(s,M)+2],$[a(s,M)]),w.alpha[l]=R[s].alpha,w.alpha0[l]=R[s].alpha,m[l]=R[s].s,b[l]=R[s].t),s=S[s];for(l=0;l<n;l++)y=a(l+1,n),w.beta[l]=m[l]/(m[l]+b[y]);w.alphacurve=1,t.curve=w};for(let t=0;t<s.length;t++){let e=s[t];if(w(e),m(e),b(e),A(e),"-"===e.sign&&M(e),$(e),l){let t=L(e);o.push(t)}r&&S(e)}})(),{pathList:s,polygons:o}}function R(t,e,a,r=!1){const n=(t,e,a)=>t>=e&&t<=a||t<=e&&t>=a;let i=!1;if((!r||!a.bottom)&&(a.left>t.x||a.top>t.y||a.bottom<t.y||a.right<t.x))return!1;for(let a=e.length-1,r=0;r<e.length;a=r,r++){const l=e[a],s=e[r];if(t.x==l.x&&t.y==l.y||t.x==s.x&&t.y==s.y)return!0;if(l.y==s.y&&t.y==l.y&&n(t.x,l.x,s.x))return!0;if(n(t.y,l.y,s.y)){if(t.y==l.y&&s.y>=l.y||t.y==s.y&&l.y>=s.y)continue;const e=(l.x-t.x)*(s.y-t.y)-(s.x-t.x)*(l.y-t.y);if(0==e)return!0;l.y<s.y==e>0&&(i=!i)}}return!!i}function j(t,e=!1){let a=[];return t[0].values[0],t[0].values[1],t.forEach(t=>{let{type:r,values:n}=t;if(n.length)if(e)for(let t=1;t<n.length;t+=2)a.push({x:n[t-1],y:n[t]});else a.push({x:n[n.length-2],y:n[n.length-1]})}),a}function k(t,e){let[a,r,n,i,l,s]=[t.x,t.y,t.width,t.height,t.x+t.width,t.y+t.height],[o,h,y,c,u,x]=[e.x,e.y,e.width,e.height,e.x+e.width,e.y+e.height],f=!1;return n*i!=y*c&&n*i>y*c&&a<o&&l>u&&r<h&&s>x&&(f=!0),f}function C(t,e=-1){let a=!("auto"!=e||!t[0].hasOwnProperty("decimals"));for(let r=0,n=t.length;r<n;r++){let n=t[r];(e>-1||a)&&(e=a?n.decimals:e,t[r].values=n.values.map(t=>t?+t.toFixed(e):t))}return t}function P(t,{toShorthands:e=!0,toRelative:a=!0,decimals:r=3}={}){return r>-1&&r<2&&(t=C(t,r)),e&&(t=function(t,e=-1,a=!0){let r;if(a){let e=t.map(t=>t.type).join("");r=/[astvqmhlc]/g.test(e)}t=a&&r?function(t,e=-1){return B(t,!1,e)}(t,e):t;let n={type:"M",values:t[0].values};t[0].decimals&&(n.decimals=t[0].decimals);let i,l=[n],s={x:t[0].values[0],y:t[0].values[1]},o=.01;for(let a=1,r=t.length;a<r;a++){let r=t[a],{type:h,values:y}=r,c=y.slice(-2),u=t[a-1],x=u.type;i={x:c[0],y:c[1]};let f,p,g,d,v={x:y[0],y:y[1]},w=Math.abs(i.x-s.x),m=Math.abs(i.y-s.y),b=(w+m)/2*o;switch(h){case"L":n=0===m||m<b&&w>b?{type:"H",values:[y[0]]}:0===w||m>b&&w<b?{type:"V",values:[y[1]]}:r;break;case"Q":if("Q"!==x){s={x:c[0],y:c[1]},l.push(r);continue}let t={x:u.values[0],y:u.values[1]};d={x:2*s.x-t.x,y:2*s.y-t.y},f=Math.abs(v.x-d.x),p=Math.abs(v.y-d.y),g=(f+p)/2,n=g<b?{type:"T",values:[i.x,i.y]}:r;break;case"C":let e={x:y[2],y:y[3]};if("C"!==x){l.push(r),s={x:c[0],y:c[1]};continue}let a={x:u.values[2],y:u.values[3]};d={x:2*s.x-a.x,y:2*s.y-a.y},f=Math.abs(v.x-d.x),p=Math.abs(v.y-d.y),g=(f+p)/2,n=g<b?{type:"S",values:[e.x,e.y,i.x,i.y]}:r;break;default:n={type:h,values:y}}(r.decimals||0===r.decimals)&&(n.decimals=r.decimals),e>-1&&(n.values=n.values.map(t=>+t.toFixed(e))),s={x:c[0],y:c[1]},l.push(n)}return l}(t)),a&&(t=function(t,e=-1){return B(t,!0,e)}(t)),r>-1&&(t=C(t,r)),t}function B(t,e=!1,a=-1){a>=0&&(t[0].values=t[0].values.map(t=>+t.toFixed(a)));let r=t[0].values,n=r[0],i=r[1],l=n,s=i;for(let r=1,o=t.length;r<o;r++){let o=t[r],{type:h,values:y}=o,c=e?h.toLowerCase():h.toUpperCase();if(h!==c)switch(h=c,o.type=h,h){case"a":case"A":y[5]=e?y[5]-n:y[5]+n,y[6]=e?y[6]-i:y[6]+i;break;case"v":case"V":y[0]=e?y[0]-i:y[0]+i;break;case"h":case"H":y[0]=e?y[0]-n:y[0]+n;break;case"m":case"M":e?(y[0]-=n,y[1]-=i):(y[0]+=n,y[1]+=i),l=e?y[0]+n:y[0],s=e?y[1]+i:y[1];break;default:if(y.length)for(let t=0;t<y.length;t++)y[t]=e?y[t]-(t%2?i:n):y[t]+(t%2?i:n)}let u=y.length;switch(h){case"z":case"Z":n=l,i=s;break;case"h":case"H":n=e?n+y[0]:y[0];break;case"v":case"V":i=e?i+y[0]:y[0];break;case"m":case"M":l=y[u-2]+(e?n:0),s=y[u-1]+(e?i:0);default:n=y[u-2]+(e?n:0),i=y[u-1]+(e?i:0)}a>=0&&(o.values=o.values.map(t=>+t.toFixed(a)))}return t}function E(t,e=!1,a=!0){let r=[],n=t.length,i=t[0].values[0],l=t[0].values[1];if(!("z"===t[n-1].type.toLowerCase()))return t;let s=0;if(a){let e=[];for(let a=0,r=t.length;a<r;a++){let r=t[a],{type:n,values:i}=r;if(i.length){let t=i.slice(-2),r={x:t[0],y:t[1],dist:0,index:0};r.index=a,e.push(r)}}e=e.sort((t,e)=>t.x-e.x||t.y-e.y),s=e[0].index}t=function(t,e){let a=t.length,r=0,n=t[a-1].type,i="z"===n.toLowerCase();if(!i||e<1||t.length<3)return t;let l=i?1:0;(function(t){let e=t.length,a="Z"==t[e-1].type,r=t[0],[n,i]=[r.values[0],r.values[1]].map(t=>+t.toFixed(8)),l=a?t[e-2]:t[e-1],s=l.values.length,[o,h]=[l.values[s-2],l.values[s-1]].map(t=>+t.toFixed(8));!a||n==o&&i==h||(t.pop(),t.push({type:"L",values:[n,i]},{type:"Z",values:[]}))})(t),r=e+1<t.length-1?e+1:t.length-1-l;let s=t.slice(r),o=t.slice(0,r);o.shift();let h,y,c=o.length;h=o[c-1].values||[],y=[h[h.length-2],h[h.length-1]],l&&(s.pop(),o.push({type:"Z",values:[]}));return t=[{type:"M",values:y},...s,...o],t}(t,s),n=t.length;let o=t[n-2],h=o.type,y=o.values.slice(-2),c="L"===h&&y[0]===i&&y[1]===l;return e&&c&&t.splice(n-2,1),r.push(...t),r}function F(t){let e={x:t[0].values[0],y:t[0].values[1]},a=e,r=[t[0]];for(let n=1,i=t.length;n<i;n++){let i=t[n],{type:l,values:s,t:o=0}=i,h=s.slice(-2);a={x:h[0],y:h[1]},"L"===l&&a.x===e.x&&a.y===e.y||(r.push(i),e=a)}return r}function T(t,e=.001){let a=0;for(let e=0,r=t.length;r&&e<r;e++){a+=t[e].x*t[e===t.length-1?0:e+1].y*.5-t[e===t.length-1?0:e+1].x*t[e].y*.5}return a}function q(t,e=1e-5){let a=[t[0]],r={x:t[0].values[0],y:t[0].values[1]},n=r,i=r;for(let l=1,s=t.length;l<s;l++){let o=t[l],h=t[l+1]||t[s-1],y="Z"===h.type?r:{x:h.values[h.values.length-2],y:h.values[h.values.length-1]},{type:c,values:u}=o,x=u.slice(-2);i="Z"!==c?{x:x[0],y:x[1]}:r;let f="C"===c?[{x:u[0],y:u[1]},{x:u[2],y:u[3]}]:"Q"===c?[{x:u[0],y:u[1]}]:[],p=Math.abs(T([n,...f,i,y]));n=i,p<e||("M"===c?(r=i,n=r):"Z"===c&&(n=r),a.push(o))}return a.push({type:"Z",values:[]}),a}function O(t,e=-1,a=!1){"l"===t[1].type&&a&&(t[0].type="m");let r=`${t[0].type}${t[0].values.join(" ")}`;for(let n=1;n<t.length;n++){let i=t[n-1],l=t[n],s=i.type===l.type&&a||("m"===i.type&&"l"===l.type||"M"===i.type&&"l"===l.type||"M"===i.type&&"L"===l.type)&&a?" ":l.type;l.values.length&&e>-1&&(l.values=l.values.map(t=>+t.toFixed(e))),r+=`${s}${l.values.join(" ")}`}return a&&(r=r.replaceAll(" 0."," .").replaceAll(" -","-").replaceAll("-0.","-.").replace(/\s+([mlcsqtahvz])/gi,"$1").replaceAll("Z","z")),r}function V(t,e,a,{toRelative:r=!0,toShorthands:n=!0,decimals:i=3,addDimensions:l=!1,optimize:s=!0,getPDF:o=!0}={}){e=Math.ceil(e),a=Math.ceil(a);let h=[],y=t.length;for(let e=0;e<y;e++){let a=t[e],r=a[0].bb,n=j(a,true);h.push({pathData:a,bb:r,poly:n,includes:[]})}if(s)for(let t=0,e=h.length;t<e;t++){let{pathData:e,bb:a}=h[t];e=F(e),e=E(e),e=q(e),h[t].pathData=e}for(let t=0,e=h.length;t<e;t++){let a=h[t],{bb:r,poly:n}=a;for(let a=0;a<e;a++){let e=h[a];if(t===a)continue;let[i,l]=[e.bb,e.poly];if(!k(r,i))continue;let s=[{x:i.x+.5*i.width,y:i.y+.5*i.height},l[0],l[Math.floor(l.length/2)],l[l.length-1]],o=!1;for(let t=0;t<s.length;t++){if(R(s[t],n,r,!0)){o=!0;break}}o&&h[t].includes.push(a)}}for(let t=0,e=h.length;t<e;t++){let e=h[t],{includes:a}=e;a.forEach(e=>{let a=h[e].pathData;a.length&&(h[t].pathData.push(...a),h[e].pathData=[])})}h=h.filter(t=>t.pathData.length);let c=JSON.parse(JSON.stringify(h)).map(t=>t.pathData),u=JSON.parse(JSON.stringify(c)).flat(),x=l?`width="${e}" height="${a}" `:"",f=`<svg viewBox="0 0 ${e} ${a}" ${x}xmlns="http://www.w3.org/2000/svg">`,p=[];h.forEach(t=>{let{pathData:e}=t;try{(r||n||-1!=i)&&(e=P(e,{toRelative:r,toShorthands:n,decimals:i}));let t=O(e,i);p.push(t),f+=`<path d="${t}"/>`}catch{console.warn("catch pathdata could not be parsed",e)}}),f+="</svg>",(r||n||-1!=i)&&(u=P(u,{toRelative:r,toShorthands:n,decimals:i}));let g=O(u,i),d=`<svg viewBox="0 0 ${e} ${a}" ${x}xmlns="http://www.w3.org/2000/svg"><path d="${g}"/></svg>`,v="";if(o)try{v=function(t=[],{width:e=0,height:a=0}={}){let r="";t.forEach(t=>{r+=function(t,{height:e=0,decimals:a=3}={}){let r=["q","0 0 0 1 k"];return t.forEach(t=>{let{type:n,values:i}=t;if(i.length){let t=e;for(let e=1,r=i.length;e<r;e+=2)i[e-1]=i[e-1].toFixed(a),i[e]=+(t-i[e]).toFixed(a)}let l=i.length?`${i.join(" ")} ${n.toLowerCase()}`:"h";r.push(l)}),r.push("f","Q"),r.join("\n")}(t,{height:a})+"\n"});let n=(new TextEncoder).encode(r).length,i="%PDF-1.4\n",l=["<<\n/Type /Catalog\n/Pages 2 0 R\n>>","<<\n/Type /Pages\n/Kids [3 0 R]\n/Count 1\n>>",`<<\n/Type /Page\n/Parent 2 0 R\n/MediaBox [0 0 ${e} ${a}]\n/Contents 4 0 R\n>>`,`<<\n/Length ${n}\n>>\nstream\n${r}endstream`],s=[];for(let t=0;t<l.length;t++)s.push(i.length),i+=`${t+1} 0 obj\n${l[t]}\nendobj\n`;let o=(new TextEncoder).encode(i).length;i+=`xref\n0 ${l.length+1}\n`,i+="0000000000 65535 f \n";for(let t of s)i+=`${String(t).padStart(10,"0")} 00000 n \n`;return i+=`trailer\n<<\n/Size ${l.length+1}\n/Root 1 0 R\n>>\n`,i+=`startxref\n${o}\n%%EOF`,i}(c,{width:e,height:a})}catch{console.warn("pdf generation failed")}return{width:e,height:a,commands:u.length,svg:d,d:g,svgSplit:f,dArr:p,pathData:u,pathDataArr:c,pdf:v}}function X(t={}){Object.assign(this,t)}async function I(t,{turnpolicy:e="majority",turdsize:a=1,optcurve:r=!0,alphamax:n=1,opttolerance:i=1,minSize:l=1e3,maxSize:s=5e3,scale:o=1,brightness:h=1,contrast:y=1,invert:c=0,blur:u=0,crop:x=!0,optimize:f=!0,addDimensions:p=!0,toRelative:g=!0,toShorthands:d=!0,decimals:v=3,getPolygon:w=!0,getPDF:b=!0}={}){let A=await m(t,{minSize:l,maxSize:s,crop:x,scale:o,brightness:h,contrast:y,invert:c,blur:u}),{bmp:M,scaleAdjust:$,width:S,height:z}=A,{pathList:L,polygons:R}=D(M,{turnpolicy:e,turdsize:a,optcurve:r,alphamax:n,opttolerance:i,scaleAdjust:$,minSize:l,maxSize:s,getPolygon:w}),j=function(t=[],e=1){t.sort((t,e)=>t.minX-e.minX||t.minY-e.minY);let a=t.length,r=[];for(let n=0;n<a;n++){let a,i=[],l=t[n],{curve:s,minX:o,maxX:h,minY:y,maxY:c,sign:u}=l,x={x:o,y:y,width:h-o,height:c-y},f=s.n;i.push({type:"M",values:[s.c[3*(f-1)+2].x*e,s.c[3*(f-1)+2].y*e],bb:x,cw:"+"===u});for(let t=0;t<f;t++){let r=s.tag[t];"curve"===r?a=[{type:"C",values:[s.c[3*t].x*e,s.c[3*t].y*e,s.c[3*t+1].x*e,s.c[3*t+1].y*e,s.c[3*t+2].x*e,s.c[3*t+2].y*e]}]:"corner"===r&&(a=[{type:"L",values:[s.c[3*t+1].x*e,s.c[3*t+1].y*e]},{type:"L",values:[s.c[3*t+2].x*e,s.c[3*t+2].y*e]}]),i.push(...a)}i.push({type:"Z",values:[]}),r.push(i)}return r}(L,o=1/$);if(!j.flat().length)throw new Error("Couldn't trace image");let k=V(j,S,z,{addDimensions:p,toRelative:g,toShorthands:d,optimize:f,decimals:v,getPDF:b});return k.scaleAdjust=$,k.polygons=w?R:[],new X(k)}$.prototype.at=function(t,e){return t>=0&&t<this.w&&e>=0&&e<this.h&&1===this.data[this.w*e+t]},$.prototype.index=function(t){let e={x:0,y:Math.floor(t/this.w)};return e.x=t-e.y*this.w,e},$.prototype.flip=function(t,e){this.at(t,e)?this.data[this.w*e+t]=0:this.data[this.w*e+t]=1},$.prototype.copy=function(){let t,e=new $(this.w,this.h);for(t=0;t<this.size;t++)e.data[t]=this.data[t];return e},X.prototype.getPdf=function(){return URL.createObjectURL(new Blob([this.pdf],{type:"application/pdf"}))},X.prototype.getSVG=function(t=!1){return t?this.svgSplit:this.svg},X.prototype.getPathData=function(){return this.pathDataNorm},X.prototype.getPathDataNorm=function(){return this.pathDataNorm},X.prototype.getD=function(){return this.d},"undefined"!=typeof window&&(window.pathDataToD=O,window.PotracePlus=I,window.svg2Canvas=A);export{w as PI,X as PotraceObj,I as PotracePlus,t as abs,e as acos,a as asin,r as atan,n as atan2,i as ceil,l as cos,s as exp,o as floor,y as hypot,h as log,c as max,u as min,x as pow,f as random,p as round,g as sin,d as sqrt,A as svg2Canvas,v as tan};
