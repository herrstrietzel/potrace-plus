!function(t){"use strict";const{abs:e,acos:a,asin:r,atan:n,atan2:l,ceil:i,cos:o,exp:y,floor:s,log:h,hypot:u,max:x,min:c,pow:f,random:p,round:g,sin:d,sqrt:v,tan:m,PI:w}=Math;async function b(t,{minSize:e=1e3,maxSize:a=5e3,filter:r="",scale:n=1,stripWhite:l=!0,crop:i=!0,canvas:o=null,brightness:y=1,contrast:s=1,invert:h=!1,blur:u=0}={}){let x,c,f=function(t){if(t instanceof HTMLImageElement)return"img";if(t instanceof SVGElement)return"svg";if(t instanceof HTMLCanvasElement)return"canvas";if(t instanceof File)return"file";if(t instanceof ArrayBuffer)return"buffer";if(t instanceof Blob)return"blob";if(Array.isArray(t))return"array";if("string"==typeof t){let e=/^(file:|https?:\/\/|\/|\.\/|\.\.\/)/.test(t),a=t.startsWith("data:image");return e||a?"url":"string"}let e=typeof t,a=t.constructor.name;return(a||e).toLowerCase()}(t),p={minSize:e,maxSize:a,filter:r,scale:n,brightness:y,contrast:s,invert:h,blur:u,canvas:o};if("img"===f)c=t.src,x=await A(c,p);else if("blob"===f||"file"===f)c=await URL.createObjectURL(t),x=await A(c,p);else if("url"===f)c=t,console.log("is URL",t),x=await A(c,p);else if("svg"===f)c=await S(t),x=await A(c,p);else if("canvas"===f){let e=t.getContext("2d"),a=`grayscale(1) invert(${h=h?"1":"0"}) blur(${u}px) brightness(${y}) contrast(${s})`;e.filter=a;let r=await e.getImageData(0,0,t.width,t.height);x={imgData:r,width:r.width,height:r.height,scaleAdjust:1}}let{imgData:g,scaleAdjust:d,width:v,height:m}=x,w={x:0,y:0,width:0,height:0};i&&(w=function(t,e=!0,a=!0,r=!1,n=null){let[l,i]=[t.width,t.height];if(!l&&!i)throw new Error("No width or height specified");let o,y=[],s={x:0,y:0,width:l,height:i},h=new Uint32Array(t.data.buffer),u=0,x="";const c=(t,e,a)=>{let r=T(a/t);return{x:a-r*t,y:r}},f=(t=0,e=!1,a=null)=>{if(r&&a){u++;let t=c(l,0,a);x+=`<rect x="${t.x}" y="${t.y}" transform="scale(1)" transform-origin="center" width="1" height="1" fill="rgba(0,255,255,0.25)" stroke="none" />`}return e?t<4294867295:t>0};let p=0,g=0,d=0,v=0,m=l,w=i,b=0,A=l*i-1,[L,S,z,D]=[1,1,1,1];if(a){let t=T(l/2),a=T(i/2),n=[0,i*l-1,l-1,i*l-l,t,i*l-t-1,a*l-1,a*l];for(let t=0;t<n.length;t++){let a=n[t];if(!(L||D||S||z))break;f(h[a],e,a)&&(0===t?(L=0,S=0):1===t?(D=0,z=0):2===t?(D=0,S=0):3===t?(L=0,S=0):4===t?L=0:5===t?D=0:6===t?z=0:7===t&&(S=0))}if(r&&console.log("corner mid check",u,"cropTop",L,"cropLeft",S,"cropRight",z,"cropBottom",D),!(L||S||z||D))return r&&console.log("image cannot be cropped â€“ opaque pixels in corners",u,"cropTop",L,"cropLeft",S,"cropRight",z,"cropBottom",D),s}for(g=0;g<i;g++){for(p=0;p<l&&(!L||!f(h[b],e,b)||(d=g,L=0,y.push(p),D))&&(!D||!f(h[A],e,A)||(w=i-g,D=0,o=c(l,0,A),y.push(o.x),L));p++)b++,A--;if(!L&&!D)break;if(g+2>=i-g&&!d)return r&&(console.log("image is empty",g,u,l*i),n.insertAdjacentHTML("beforeend",x)),s}for(p=0;p<l;p++)for(b=(d+1)*l+p,A=d*l+(l-p-1),g=d;g<w-1&&(!S||!f(h[b],e,b)||(v=p,S=0,z))&&(!z||!f(h[A],e,A)||(m=l-p,z=0,S));g++)b+=l,A+=l;return v=X(...y,v),m=F(...y,m),s.x=v,s.y=d,s.width=m-v,s.height=w-d,r&&(console.log(u,l*i,"skipped:",l*i-u,y),n.insertAdjacentHTML("beforeend",x)),s}(g,l),v=P(w.width/d),m=P(w.height/d),x.width=v,x.height=m);let b=function(t,e=0,a=0,r=0,n=0){let{data:l,width:i,height:o}=t;r=r||i,n=n||o;let y=new z(r,n),s=4*i,h=0;for(let t=a;t<a+n;t++){let a=0,n=t*s;for(let t=e;t<e+r;t++){let e=l[n+4*t],i=h*r+a;y.data[i]=e<127?1:0,a++}h++}return y}(g,w.x,w.y,w.width,w.height);return{bmp:b,scaleAdjust:d,width:v,height:m}}async function A(t="",{minSize:e=1e3,maxSize:a=5e3,scale:r=1,brightness:n=1,contrast:l=1,invert:i=0,blur:o=0,canvas:y=null}={}){let s,h,u,x,c=1,f=0;e*=r,a*=r,y||((y=document.getElementById("canvasPot"))||(y=document.createElement("canvas")),y.id="canvasPot",document.body.append(y));let p,g=y.getContext("2d",{alpha:!1,willReadFrequently:!0}),d=await fetch(t);if(d.ok){let r=await d.blob(),{type:v}=r;"image/svg+xml"!==v?(p=!0,s=await createImageBitmap(r),[h,u]=[s.width,s.height]):(s=new Image,s.src=t,s.crossOrigin="anonymous",await s.decode(),[h,u]=[s.naturalWidth,s.naturalHeight]),f=X(h,u),c=!p&&(f<e||f>a)?e/f:1,h*=c,u*=c,y.width=h,y.height=u,g.fillStyle="white",g.fillRect(0,0,h,u);let m=`grayscale(1) invert(${i=i?"1":"0"}) blur(${o}px) brightness(${n}) contrast(${l})`;g.filter=m,g.drawImage(s,0,0,h,u),x=g.getImageData(0,0,h,u)}let{width:v,height:m}=x;return v=P(v/c),m=P(m/c),{imgData:x,scaleAdjust:c,width:v,height:m}}async function L(t,{minSize:e=1e3,maxSize:a=5e3,filter:r="",scale:n=1,canvas:l=null}={}){l||(l=document.createElement("canvas"));let i=await S(t),o=new Image;o.src=i,o.crossOrigin="anonymous",await o.decode();let[y,s]=[o.naturalWidth,o.naturalHeight],h=X(y,s),u=h<e||h>a?e/h:1,x=y*u,c=s*u;l.width=x,l.height=c;let f=l.getContext("2d");return f.fillStyle="white",f.fillRect(0,0,x,c),r&&(f.filter=r),f.drawImage(o,0,0,x,c),URL.revokeObjectURL(i),l}async function S(t){const e=t.cloneNode(!0);if(document.body.append(e),!e.hasAttribute("width")&&!e.hasAttribute("height")){let a=e.hasAttribute("viewBox")?{x:0,y:0,width:300,height:150}:t.getBBox(),r=t.viewBox.baseVal.width?e.viewBox.baseVal.width:t.width.baseVal.value?t.width.baseVal.value:a.width,n=t.viewBox.baseVal.height?e.viewBox.baseVal.height:t.height.baseVal.value?t.height.baseVal.value:a.height;e.setAttribute("width",r),e.setAttribute("height",n)}let a=(new XMLSerializer).serializeToString(e),r=new Blob([a],{type:"image/svg+xml"}),n=URL.createObjectURL(r);return e.remove(),n}function z(t,e){this.w=t,this.h=e,this.size=t*e,this.arraybuffer=new ArrayBuffer(this.size),this.data=new Int8Array(this.arraybuffer)}function D(){this.area=0,this.len=0,this.curve={},this.pt=[],this.minX=1e5,this.minY=1e5,this.maxX=-1,this.maxY=-1}function C(t){this.n=t,this.tag=new Array(t),this.c=new Array(3*t),this.alphaCurve=0,this.vertex=new Array(t),this.alpha=new Array(t),this.alpha0=new Array(t),this.beta=new Array(t)}function $(t,e=1){let a=t.curve,r=a.n,n=[];n.push({x:a.c[3*(r-1)+2].x*e,y:a.c[3*(r-1)+2].y*e});for(let t=0;t<r;t++){let r=a.tag[t];"curve"===r?n.push({x:a.c[3*t+2].x*e,y:a.c[3*t+2].y*e}):"corner"===r&&n.push({x:a.c[3*t+1].x*e,y:a.c[3*t+1].y*e},{x:a.c[3*t+2].x*e,y:a.c[3*t+2].y*e})}return n}function k(t,{turnpolicy:e="majority",turdsize:a=1,optcurve:r=!0,alphamax:n=1,opttolerance:l=1,getPolygon:i=!1}={}){let o=[],y=[];if(function(){let r,n=t.copy(),l={x:0,y:0};function i(t){let e=n.w*t.y+t.x;for(;e<n.size&&1!==n.data[e];)e++;return e<n.size&&n.index(e)}function y(t,e){for(let a=2;a<5;a++){let r=0;for(let l=1-a;l<=a-1;l++)r+=n.at(t+l,e+a-1)?1:-1,r+=n.at(t+a-1,e+l-1)?1:-1,r+=n.at(t+l-1,e-a)?1:-1,r+=n.at(t-a,e+l)?1:-1;if(r>0)return 1;if(r<0)return 0}return 0}function s(a){let r,l=new D,i=a.x,o=a.y,s=0,h=1;for(l.sign=t.at(a.x,a.y)?"+":"-";l.pt.push({x:i,y:o}),i>l.maxX&&(l.maxX=i),i<l.minX&&(l.minX=i),o>l.maxY&&(l.maxY=o),o<l.minY&&(l.minY=o),l.len++,i+=s,o+=h,l.area-=i*h,i!==a.x||o!==a.y;){let t=n.at(i+(s+h-1)/2,o+(h-s-1)/2),a=n.at(i+(s-h-1)/2,o+(h+s-1)/2);a&&!t?"right"===e||"black"===e&&"+"===l.sign||"white"===e&&"-"===l.sign||"majority"===e&&y(i,o)||"minority"===e&&!y(i,o)?(r=s,s=-h,h=r):(r=s,s=h,h=-r):a?(r=s,s=-h,h=r):t||(r=s,s=h,h=-r)}return l}function h(t){let e,a,r=t.pt[0].y,l=t.len;for(let i=1;i<l;i++){let l=t.pt[i].x,o=t.pt[i].y;if(o!==r){a=r<o?r:o,e=t.maxX;for(let t=l;t<e;t++)n.flip(t,a);r=o}}}for(;l=i(l);)r=s(l),h(r),r.area>a&&o.push(r)}(),function(){function t(){this.data=[0,0,0,0,0,0,0,0,0]}function e(t,e,a,r,n){this.x=t,this.y=e,this.xy=a,this.x2=r,this.y2=n}function a(t,e){return t>=e?t%e:t>=0?t:e-1-(-1-t)%e}function s(t,e){return t.x*e.y-t.y*e.x}function h(t,e,a){return t<=a?t<=e&&e<a:t<=e||e<a}function u(t){return t>0?1:t<0?-1:0}function x(t,e){let a=new Array(3),r=0;a[0]=e.x,a[1]=e.y,a[2]=1;for(let e=0;e<3;e++)for(let n=0;n<3;n++)r+=a[e]*t.at(e,n)*a[n];return r}function c(t,e,a){return{x:e.x+t*(a.x-e.x),y:e.y+t*(a.y-e.y)}}function f(t,e){let a=function(t,e){return{x:-u(e.y-t.y),y:u(e.x-t.x)}}(t,e);return a.y*(e.x-t.x)-a.x*(e.y-t.y)}function p(t="",e={},a={},r={},n={}){let l,i,o,y;return"cprod"===t||"iprod1"===t?(l=a.x-e.x,o=a.y-e.y,i=n.x-r.x,y=n.y-r.y):(l=a.x-e.x,o=a.y-e.y,i=r.x-e.x,y=r.y-e.y),"cprod"===t||"dpara"===t?l*y-i*o:l*i+o*y}function g(t,e){return U((t.x-e.x)**2+(t.y-e.y)**2)}function d(t,e,a,r,n){let l=1-t;return{x:l*l*l*e.x+l*l*t*3*a.x+t*t*l*3*r.x+t*t*t*n.x,y:l*l*l*e.y+l*l*t*3*a.y+t*t*l*3*r.y+t*t*t*n.y}}function v(t,e,a,r,n,l){let i=p("cprod",t,e,n,l),o=p("cprod",e,a,n,l),y=i-2*o+p("cprod",a,r,n,l),s=-2*i+2*o,h=s*s-4*y*i;if(0===y||h<0)return-1;let u=U(h),x=(-s+u)/(2*y),c=(-s-u)/(2*y);return x>=0&&x<=1?x:c>=0&&c<=1?c:-1}function m(t){t.x0=t.pt[0].x,t.y0=t.pt[0].y,t.sums=[];let a=t.sums;a.push(new e(0,0,0,0,0));for(let r=0;r<t.len;r++){let n=t.pt[r].x-t.x0,l=t.pt[r].y-t.y0;a.push(new e(a[r].x+n,a[r].y+l,a[r].xy+n*l,a[r].x2+n*n,a[r].y2+l*l))}}function w(t){let e,r=t.len,n=t.pt,l=new Array(r),i=new Array(r),o=new Array(4);t.lon=new Array(r);let y,x,c,f,p,g,d,v,m=[{x:0,y:0},{x:0,y:0}],w={x:0,y:0},b={x:0,y:0},A={x:0,y:0},L=0;for(x=r-1;x>=0;x--)n[x].x!=n[L].x&&n[x].y!=n[L].y&&(L=x+1),i[x]=L;for(x=r-1;x>=0;x--){for(o[0]=o[1]=o[2]=o[3]=0,e=(3+3*(n[a(x+1,r)].x-n[x].x)+(n[a(x+1,r)].y-n[x].y))/2,o[e]++,m[0].x=0,m[0].y=0,m[1].x=0,m[1].y=0,L=i[x],f=x;;){if(y=0,e=(3+3*u(n[L].x-n[f].x)+u(n[L].y-n[f].y))/2,o[e]++,o[0]&&o[1]&&o[2]&&o[3]){l[x]=f,y=1;break}if(w.x=n[L].x-n[x].x,w.y=n[L].y-n[x].y,s(m[0],w)<0||s(m[1],w)>0)break;if(j(w.x)<=1&&j(w.y)<=1||(b.x=w.x+(w.y>=0&&(w.y>0||w.x<0)?1:-1),b.y=w.y+(w.x<=0&&(w.x<0||w.y<0)?1:-1),s(m[0],b)>=0&&(m[0].x=b.x,m[0].y=b.y),b.x=w.x+(w.y<=0&&(w.y<0||w.x<0)?1:-1),b.y=w.y+(w.x>=0&&(w.x>0||w.y<0)?1:-1),s(m[1],b)<=0&&(m[1].x=b.x,m[1].y=b.y)),f=L,L=i[f],!h(L,x,f))break}0===y&&(A.x=u(n[L].x-n[f].x),A.y=u(n[L].y-n[f].y),w.x=n[f].x-n[x].x,w.y=n[f].y-n[x].y,p=s(m[0],w),g=s(m[0],A),d=s(m[1],w),v=s(m[1],A),c=1e7,g<0&&(c=T(p/-g)),v>0&&(c=X(c,T(-d/v))),l[x]=a(f+c,r))}for(c=l[r-1],t.lon[r-1]=c,x=r-2;x>=0;x--)h(x+1,l[x],c)&&(c=l[x]),t.lon[x]=c;for(x=r-1;h(a(x+1,r),c,t.lon[x]);x--)t.lon[x]=c}function b(t){function e(t,e,a){let r,n,l,i,o,y,s,h,u,x,c,f,p,g,d=t.len,v=t.pt,m=t.sums,w=0;return a>=d&&(a-=d,w=1),0===w?(r=m[a+1].x-m[e].x,n=m[a+1].y-m[e].y,i=m[a+1].x2-m[e].x2,l=m[a+1].xy-m[e].xy,o=m[a+1].y2-m[e].y2,y=a+1-e):(r=m[a+1].x-m[e].x+m[d].x,n=m[a+1].y-m[e].y+m[d].y,i=m[a+1].x2-m[e].x2+m[d].x2,l=m[a+1].xy-m[e].xy+m[d].xy,o=m[a+1].y2-m[e].y2+m[d].y2,y=a+1-e+d),c=(v[e].x+v[a].x)/2-v[0].x,f=(v[e].y+v[a].y)/2-v[0].y,g=v[a].x-v[e].x,p=-(v[a].y-v[e].y),s=(i-2*r*c)/y+c*c,h=(l-r*f-n*c)/y+c*f,u=(o-2*n*f)/y+f*f,x=p*p*s+2*p*g*h+g*g*u,U(x)}let r,n,l,i,o,y,s,h=t.len,u=new Array(h+1),x=new Array(h+1),c=new Array(h),f=new Array(h+1),p=new Array(h+1),g=new Array(h+1);for(r=0;r<h;r++)s=a(t.lon[a(r-1,h)]-1,h),s==r&&(s=a(r+1,h)),c[r]=s<r?h:s;for(n=1,r=0;r<h;r++)for(;n<=c[r];)f[n]=r,n++;for(r=0,n=0;r<h;n++)p[n]=r,r=c[r];for(p[n]=h,l=n,r=h,n=l;n>0;n--)g[n]=r,r=f[r];for(g[0]=0,u[0]=0,n=1;n<=l;n++)for(r=g[n];r<=p[n];r++){for(y=-1,i=p[n-1];i>=f[r];i--)o=e(t,i,r)+u[i],(y<0||o<y)&&(x[r]=i,y=o);u[r]=y}for(t.m=l,t.po=new Array(l),r=h,n=l-1;r>0;n--)r=x[r],t.po[n]=r}function A(e){function r(t,e,a,r,n){let l,i,o,y,s,h,u,x,c,f,p,g=t.len,d=t.sums,v=0;for(;a>=g;)a-=g,v+=1;for(;e>=g;)e-=g,v-=1;for(;a<0;)a+=g,v-=1;for(;e<0;)e+=g,v+=1;l=d[a+1].x-d[e].x+v*d[g].x,i=d[a+1].y-d[e].y+v*d[g].y,o=d[a+1].x2-d[e].x2+v*d[g].x2,y=d[a+1].xy-d[e].xy+v*d[g].xy,s=d[a+1].y2-d[e].y2+v*d[g].y2,h=a+1-e+v*g,r.x=l/h,r.y=i/h,u=(o-l*l/h)/h,x=(y-l*i/h)/h,c=(s-i*i/h)/h,f=(u+c+U((u-c)*(u-c)+4*x*x))/2,u-=f,c-=f,j(u)>=j(c)?(p=U(u*u+x*x),0!==p&&(n.x=-x/p,n.y=u/p)):(p=U(c*c+x*x),0!==p&&(n.x=-c/p,n.y=x/p)),0===p&&(n.x=n.y=0)}let n,l,i,o,y,s,h,u,c,f,p,g,d,v,m,w=e.m,b=e.po,A=e.len,L=e.pt,S=e.x0,z=e.y0,D=new Array(w),$=new Array(w),k=new Array(w),E=new Array(3),R={x:0,y:0};for(e.curve=new C(w),l=0;l<w;l++)i=b[a(l+1,w)],i=a(i-b[l],A)+b[l],D[l]={x:0,y:0},$[l]={x:0,y:0},r(e,b[l],i,D[l],$[l]);for(l=0;l<w;l++)if(k[l]=new t,n=$[l].x*$[l].x+$[l].y*$[l].y,0===n)for(i=0;i<3;i++)for(o=0;o<3;o++)k[l].data[3*i+o]=0;else for(E[0]=$[l].y,E[1]=-$[l].x,E[2]=-E[1]*D[l].y-E[0]*D[l].x,y=0;y<3;y++)for(o=0;o<3;o++)k[l].data[3*y+o]=E[y]*E[o]/n;for(l=0;l<w;l++){for(s=new t,h={x:0,y:0},R.x=L[b[l]].x-S,R.y=L[b[l]].y-z,i=a(l-1,w),y=0;y<3;y++)for(o=0;o<3;o++)s.data[3*y+o]=k[i].at(y,o)+k[l].at(y,o);for(;;){if(f=s.at(0,0)*s.at(1,1)-s.at(0,1)*s.at(1,0),0!==f){h.x=(-s.at(0,2)*s.at(1,1)+s.at(1,2)*s.at(0,1))/f,h.y=(s.at(0,2)*s.at(1,0)-s.at(1,2)*s.at(0,0))/f;break}for(s.at(0,0)>s.at(1,1)?(E[0]=-s.at(0,1),E[1]=s.at(0,0)):s.at(1,1)?(E[0]=-s.at(1,1),E[1]=s.at(1,0)):(E[0]=1,E[1]=0),n=E[0]*E[0]+E[1]*E[1],E[2]=-E[1]*R.y-E[0]*R.x,y=0;y<3;y++)for(o=0;o<3;o++)s.data[3*y+o]+=E[y]*E[o]/n}if(u=j(h.x-R.x),c=j(h.y-R.y),u<=.5&&c<=.5)e.curve.vertex[l]={x:h.x+S,y:h.y+z};else{if(p=x(s,R),d=R.x,v=R.y,0!==s.at(0,0))for(m=0;m<2;m++)h.y=R.y-.5+m,h.x=-(s.at(0,1)*h.y+s.at(0,2))/s.at(0,0),u=j(h.x-R.x),g=x(s,h),u<=.5&&g<p&&(p=g,d=h.x,v=h.y);if(0!==s.at(1,1))for(m=0;m<2;m++)h.x=R.x-.5+m,h.y=-(s.at(1,0)*h.x+s.at(1,2))/s.at(1,1),c=j(h.y-R.y),g=x(s,h),c<=.5&&g<p&&(p=g,d=h.x,v=h.y);for(y=0;y<2;y++)for(o=0;o<2;o++)h.x=R.x-.5+y,h.y=R.y-.5+o,g=x(s,h),g<p&&(p=g,d=h.x,v=h.y);e.curve.vertex[l]={x:d+S,y:v+z}}}}function L(t){let e,a,r,n=t.curve,l=n.n,i=n.vertex;for(e=0,a=l-1;e<a;e++,a--)r=i[e],i[e]=i[a],i[a]=r}function S(t){let e,r,l,i,o,y,s,h,u,x=t.curve.n,g=t.curve;for(e=0;e<x;e++)r=a(e+1,x),l=a(e+2,x),u=c(.5,g.vertex[l],g.vertex[r]),o=f(g.vertex[e],g.vertex[l]),0!==o?(i=p("dpara",g.vertex[e],g.vertex[r],g.vertex[l])/o,i=j(i),y=i>1?1-1/i:0,y/=.75):y=4/3,g.alpha0[r]=y,y>=n?(g.tag[r]="corner",g.c[3*r+1]=g.vertex[r],g.c[3*r+2]=u):(y<.55?y=.55:y>1&&(y=1),s=c(.5+.5*y,g.vertex[e],g.vertex[r]),h=c(.5+.5*y,g.vertex[l],g.vertex[r]),g.tag[r]="curve",g.c[3*r+0]=s,g.c[3*r+1]=h,g.c[3*r+2]=u),g.alpha[r]=y,g.beta[r]=.5;g.alphacurve=1}function z(t){function e(){this.pen=0,this.c=[{x:0,y:0},{x:0,y:0}],this.t=0,this.s=0,this.alpha=0}function r(t,e,r,n,l,i,o){let y,s,h,x,f,m,w,b,A,L,S,z,D,C,$,k,E,R,B,M,P,I,O,T=t.curve.n,V=t.curve,F=V.vertex;if(e==r)return 1;if(y=e,f=a(e+1,T),s=a(y+1,T),x=i[s],0===x)return 1;for(b=g(F[e],F[f]),y=s;y!=r;y=s){if(s=a(y+1,T),h=a(y+2,T),i[s]!=x)return 1;if(u(p("cprod",F[e],F[f],F[s],F[h]))!=x)return 1;if(p("iprod1",F[e],F[f],F[s],F[h])<b*g(F[s],F[h])*-.999847695156)return 1}if(S=V.c[3*a(e,T)+2],z=F[a(e+1,T)],D=F[a(r,T)],C=V.c[3*a(r,T)+2],m=o[r]-o[e],m-=p("dpara",F[0],V.c[3*e+2],V.c[3*r+2])/2,e>=r&&(m+=o[T]),R=p("dpara",S,z,D),B=p("dpara",S,z,C),M=p("dpara",S,D,C),P=R+M-B,B==R)return 1;if(O=M/(M-P),I=B/(B-R),k=B*O/2,0===k)return 1;for(E=m/k,w=2-U(4-E/.3),n.c[0]=c(O*w,S,z),n.c[1]=c(I*w,C,D),n.alpha=w,n.t=O,n.s=I,z={x:n.c[0].x,y:n.c[0].y},D={x:n.c[1].x,y:n.c[1].y},n.pen=0,y=a(e+1,T);y!=r;y=s){if(s=a(y+1,T),O=v(S,z,D,C,F[y],F[s]),O<-.5)return 1;if($=d(O,S,z,D,C),b=g(F[y],F[s]),0===b)return 1;if(A=p("dpara",F[y],F[s],$)/b,j(A)>l)return 1;if(p("iprod",F[y],F[s],$)<0||p("iprod",F[s],F[y],$)<0)return 1;n.pen+=A*A}for(y=e;y!=r;y=s){if(s=a(y+1,T),O=v(S,z,D,C,V.c[3*y+2],V.c[3*s+2]),O<-.5)return 1;if($=d(O,S,z,D,C),b=g(V.c[3*y+2],V.c[3*s+2]),0===b)return 1;if(A=p("dpara",V.c[3*y+2],V.c[3*s+2],$)/b,L=p("dpara",V.c[3*y+2],V.c[3*s+2],F[s])/b,L*=.75*V.alpha[s],L<0&&(A=-A,L=-L),A<L-l)return 1;A<L&&(n.pen+=(A-L)*(A-L))}return 0}let n,i,o,y,s,h,x,f,m,w,b,A=t.curve,L=A.n,S=A.vertex,z=new Array(L+1),D=new Array(L+1),$=new Array(L+1),k=new Array(L+1),E=new e,R=new Array(L),B=new Array(L+1);for(i=0;i<L;i++)"curve"==A.tag[i]?R[i]=u(p("dpara",S[a(i-1,L)],S[i],S[a(i+1,L)])):R[i]=0;for(x=0,B[0]=0,s=A.vertex[0],i=0;i<L;i++)h=a(i+1,L),"curve"==A.tag[h]&&(f=A.alpha[h],x+=.3*f*(4-f)*p("dpara",A.c[3*i+2],S[h],A.c[3*h+2])/2,x+=p("dpara",s,A.c[3*i+2],A.c[3*h+2])/2),B[i+1]=x;for(z[0]=-1,D[0]=0,$[0]=0,o=1;o<=L;o++)for(z[o]=o-1,D[o]=D[o-1],$[o]=$[o-1]+1,i=o-2;i>=0&&(y=r(t,i,a(o,L),E,l,R,B),!y);i--)($[o]>$[i]+1||$[o]==$[i]+1&&D[o]>D[i]+E.pen)&&(z[o]=i,D[o]=D[i]+E.pen,$[o]=$[i]+1,k[o]=E,E=new e);for(n=$[L],m=new C(n),w=new Array(n),b=new Array(n),o=L,i=n-1;i>=0;i--)z[o]==o-1?(m.tag[i]=A.tag[a(o,L)],m.c[3*i+0]=A.c[3*a(o,L)+0],m.c[3*i+1]=A.c[3*a(o,L)+1],m.c[3*i+2]=A.c[3*a(o,L)+2],m.vertex[i]=A.vertex[a(o,L)],m.alpha[i]=A.alpha[a(o,L)],m.alpha0[i]=A.alpha0[a(o,L)],m.beta[i]=A.beta[a(o,L)],w[i]=b[i]=1):(m.tag[i]="curve",m.c[3*i+0]=k[o].c[0],m.c[3*i+1]=k[o].c[1],m.c[3*i+2]=A.c[3*a(o,L)+2],m.vertex[i]=c(k[o].s,A.c[3*a(o,L)+2],S[a(o,L)]),m.alpha[i]=k[o].alpha,m.alpha0[i]=k[o].alpha,w[i]=k[o].s,b[i]=k[o].t),o=z[o];for(i=0;i<n;i++)h=a(i+1,n),m.beta[i]=w[i]/(w[i]+b[h]);m.alphacurve=1,t.curve=m}t.prototype.at=function(t,e){return this.data[3*t+e]};for(let t=0;t<o.length;t++){let e=o[t];if(m(e),w(e),b(e),A(e),"-"===e.sign&&L(e),S(e),i){let t=$(e);y.push(t)}r&&z(e)}}(),i){let t="";y.forEach(e=>{t+="M"+e.map(t=>`${t.x} ${t.y}`).join(" ")})}return{pathList:o,polygons:y}}z.prototype.at=function(t,e){return t>=0&&t<this.w&&e>=0&&e<this.h&&1===this.data[this.w*e+t]},z.prototype.index=function(t){let e={x:0,y:T(t/this.w)};return e.x=t-e.y*this.w,e},z.prototype.flip=function(t,e){this.at(t,e)?this.data[this.w*e+t]=0:this.data[this.w*e+t]=1},z.prototype.copy=function(){let t,e=new z(this.w,this.h);for(t=0;t<this.size;t++)e.data[t]=this.data[t];return e};const{abs:j,acos:E,asin:R,atan:B,atan2:M,ceil:P,cos:I,exp:O,floor:T,log:V,max:F,min:X,pow:Y,random:Z,round:H,sin:N,sqrt:U,tan:q,PI:Q}=Math;function J(t,e,a=!1){let r=M(e.y-t.y,e.x-t.x);return a&&r<0&&(r+=2*Q),r}function W(t,e,a,r=!1){const n=(t,e,a)=>t>=e&&t<=a||t<=e&&t>=a;let l=!1;if((!r||!a.bottom)&&(a.left>t.x||a.top>t.y||a.bottom<t.y||a.right<t.x))return!1;for(let a=e.length-1,r=0;r<e.length;a=r,r++){const i=e[a],o=e[r];if(t.x==i.x&&t.y==i.y||t.x==o.x&&t.y==o.y)return!0;if(i.y==o.y&&t.y==i.y&&n(t.x,i.x,o.x))return!0;if(n(t.y,i.y,o.y)){if(t.y==i.y&&o.y>=i.y||t.y==o.y&&i.y>=o.y)continue;const e=(i.x-t.x)*(o.y-t.y)-(o.x-t.x)*(i.y-t.y);if(0==e)return!0;i.y<o.y==e>0&&(l=!l)}}return!!l}function G(t,e){return(e.x-t.x)**2+(e.y-t.y)**2}function K(t,e,a,r=!1){let n={x:(e.x-t.x)*a+t.x,y:(e.y-t.y)*a+t.y};return r&&(n.angle=J(t,e),n.angle<0&&(n.angle+=2*Q)),n}function _(t,e=.5,a=!1,r=!1){let n;return n=t.length>2?((t,e,a=!1)=>{let n=4===t.length,l=t[0],i=t[1],o=n?t[2]:t[1],y=t[t.length-1],s={x:0,y:0};if(a||r){let t,a,h,u,x,c=l.x===i.x&&l.y===i.y,f=y.x===o.x&&y.y===o.y;0!==e||c?1!==e||f?(c&&(e+=1e-7),f&&(e-=1e-7),t=K(l,i,e),n?(a=K(i,o,e),h=K(o,y,e),u=K(t,a,e),x=K(a,h,e),s=K(u,x,e),s.angle=J(u,x),r&&(s.cpts=[a,h,u,x])):(a=K(l,i,e),h=K(i,y,e),s=K(a,h,e),s.angle=J(a,h),r&&(s.cpts=[a,h]))):(s.x=y.x,s.y=y.y,s.angle=J(o,y)):(s.x=l.x,s.y=l.y,s.angle=J(l,i))}else{let t=1-e;s=n?{x:t**3*l.x+3*t**2*e*i.x+3*t*e**2*o.x+e**3*y.x,y:t**3*l.y+3*t**2*e*i.y+3*t*e**2*o.y+e**3*y.y}:{x:t*t*l.x+2*t*e*i.x+e**2*y.x,y:t*t*l.y+2*t*e*i.y+e**2*y.y}}return s})(t,e,a):K(t[0],t[1],e,a),a&&n.angle<0&&(n.angle+=2*Q),n}function tt(t,e=!1){let a=[];return t[0].values[0],t[0].values[1],t.forEach(t=>{let{type:r,values:n}=t;if(n.length)if(e)for(let t=1;t<n.length;t+=2)a.push({x:n[t-1],y:n[t]});else a.push({x:n[n.length-2],y:n[n.length-1]})}),a}function et(t){return 4===t.length?function(t,e,a,r){let[n,l,i,o,y,s,h,u]=[t.x,t.y,e.x,e.y,a.x,a.y,r.x,r.y],x=X(t.y,r.y),c=X(t.x,r.x),f=F(t.x,r.x),p=F(t.y,r.y);if(e.y>=x&&e.y<=p&&a.y>=x&&a.y<=p&&e.x>=c&&e.x<=f&&a.x>=c&&a.x<=f)return[];for(var g,d,v,m,w,b,A,L,S=[],z=0;z<2;++z)if(0==z?(d=6*n-12*i+6*y,g=-3*n+9*i-9*y+3*h,v=3*i-3*n):(d=6*l-12*o+6*s,g=-3*l+9*o-9*s+3*u,v=3*o-3*l),j(g)<1e-12){if(j(d)<1e-12)continue;0<(m=-v/d)&&m<1&&S.push(m)}else(A=d*d-4*v*g)<0?j(A)<1e-12&&0<(m=-d/(2*g))&&m<1&&S.push(m):(0<(w=(-d+(L=U(A)))/(2*g))&&w<1&&S.push(w),0<(b=(-d-L)/(2*g))&&b<1&&S.push(b));var D=S.length;for(;D--;)m=S[D];return S}(t[0],t[1],t[2],t[3]):function(t,e,a){let r,n,l,i=X(t.y,a.y),o=X(t.x,a.x),y=F(t.x,a.x),s=F(t.y,a.y);if(e.y>=i&&e.y<=s&&e.x>=o&&e.x<=y)return[];let[h,u,x,c,f,p]=[t.x,t.y,e.x,e.y,a.x,a.y],g=[];for(var d=0;d<2;++d)r=0==d?h-2*x+f:u-2*c+p,n=0==d?-2*h+2*x:-2*u+2*c,j(r)>1e-12&&(l=-n/(2*r),l>0&&l<1&&g.push(l));return g}(t[0],t[1],t[2])}function at(t,e){let a,r,n,l,i,o,y=[],s=[],h=t[0],u=t[1],x=t[t.length-2],c=t[t.length-1];return 4===t.length?(a=_([h,u],e),r=_([u,x],e),n=_([x,c],e),l=_([a,r],e),i=_([r,n],e),o=_([l,i],e),y.push({x:h.x,y:h.y},{x:a.x,y:a.y},{x:l.x,y:l.y},{x:o.x,y:o.y}),s.push({x:o.x,y:o.y},{x:i.x,y:i.y},{x:n.x,y:n.y},{x:c.x,y:c.y})):3===t.length?(r=_([h,u],e),n=_([u,c],e),o=_([r,n],e),y.push({x:h.x,y:h.y},{x:r.x,y:r.y},{x:o.x,y:o.y}),s.push({x:o.x,y:o.y},{x:n.x,y:n.y},{x:c.x,y:c.y})):2===t.length&&(r=_([h,c],e),y.push({x:h.x,y:h.y},{x:r.x,y:r.y}),s.push({x:r.x,y:r.y},{x:c.x,y:c.y})),[y,s]}function rt(t,e,a=!1){let r=[],n=6===e.length?"C":"Q",l={x:e[0],y:e[1]},i="C"===n?{x:e[2],y:e[3]}:l,o={x:e[4],y:e[5]},y=F(o.x,t.x),s=X(o.x,t.x),h=F(o.y,t.y),u=X(o.y,t.y),x=0,c=[];if(l.x<s||l.x>y||l.y<u||l.y>h||i.x<s||i.x>y||i.y<u||i.y>h){if(c=et("C"===n?[t,l,i,o]:[t,l,o]).sort(),c=c.filter(t=>t>.05&&t<.95),c.length){let a=function(t,e,a,r=!0){let n=[];if(!a.length)return!1;let l,i,o,y=e.length,s={x:e[y-2],y:e[y-1]};2===e.length?o=[t,s]:4===e.length?(l={x:e[0],y:e[1]},o=[t,l,s]):6===e.length&&(l={x:e[0],y:e[1]},i={x:e[2],y:e[3]},o=[t,l,i,s]);if(a.length)if(1===a.length){let t=at(o,a[0]),e=t[0],r=t[1];n.push(e,r)}else{let t=a[0],e=at(o,t),r=e[0];n.push(r),o=e[1];for(let e=1;e<a.length;e++){t=a[e-1];let r=at(o,(a[e]-t)/(1-t));n.push(r[0]),e===a.length-1&&n.push(r[r.length-1]),o=r[1]}}if(r){let t,e,a=[];return n.forEach(r=>{t={type:"",values:[]},r.shift(),e=r.map(t=>Object.values(t)).flat(),t.values=e,3===r.length?t.type="C":2===r.length?t.type="Q":1===r.length&&(t.type="L"),a.push(t)}),a}return n}(t,e,c);r.push(...a),x+=a.length}else r.push({type:n,values:e})}else r.push({type:n,values:e});return{pathData:r,count:x,tArr:c}}function nt(t,e=!1){let a=[t[0]],r={x:t[0].values[0],y:t[0].values[1]},n={x:t[0].values[0],y:t[0].values[1]},l=t.length;for(let i=1;l&&i<l;i++){let l=t[i],{type:o,values:y}=l,s=y.slice(-2);if(s[0],s[1],"C"!==o&&"Q"!==o)a.push(l);else if("C"===o||"Q"===o){let t=rt(r,y,e),{pathData:n,tArr:l=[]}=t;n.length>1&&(n.forEach((t,e)=>{if(e<n.length-1){let{values:e}=t;e.slice(-2)}}),e&&l.forEach((t,e)=>{n[e].t=t})),a.push(...n)}r={x:s[0],y:s[1]},"z"===o.toLowerCase()?r=n:"M"===o&&(n={x:s[0],y:s[1]})}return a}function lt(t,e=-1){let a=t.map(t=>t.x),r=t.map(t=>t.y),n=X(...a),l=F(...a),i=X(...r),o=F(...r),y={x:n,left:n,right:l,y:i,top:i,bottom:o,width:l-n,height:o-i};if(e>-1)for(let t in y)y[t]=+y[t].toFixed(e);return y}function it(t,e){let[a,r,n,l,i,o]=[t.x,t.y,t.width,t.height,t.x+t.width,t.y+t.height],[y,s,h,u,x,c]=[e.x,e.y,e.width,e.height,e.x+e.width,e.y+e.height],f=!1;return n*l!=h*u&&n*l>h*u&&a<y&&i>x&&r<s&&o>c&&(f=!0),f}function ot(t,e=.001){let a=0;for(let e=0,r=t.length;r&&e<r;e++){a+=t[e].x*t[e===t.length-1?0:e+1].y*.5-t[e===t.length-1?0:e+1].x*t[e].y*.5}return a}function yt(t,e){let a=0,r="z"===t[t.length-1].type.toLowerCase();if(!r||e<1||t.length<3)return t;let n=r?1:0;!function(t){let e=t.length,a="Z"==t[e-1].type,r=t[0],[n,l]=[r.values[0],r.values[1]].map(t=>+t.toFixed(8)),i=a?t[e-2]:t[e-1],o=i.values.length,[y,s]=[i.values[o-2],i.values[o-1]].map(t=>+t.toFixed(8));!a||n==y&&l==s||(t.pop(),t.push({type:"L",values:[n,l]},{type:"Z",values:[]}))}(t),a=e+1<t.length-1?e+1:t.length-1-n;let l,i,o=t.slice(a),y=t.slice(0,a);return y.shift(),l=y[y.length-1].values||[],i=[l[l.length-2],l[l.length-1]],n&&(o.pop(),y.push({type:"Z",values:[]})),t=[{type:"M",values:i},...o,...y]}function st(t,{removeFinalLineto:e=!0,startToTop:a=!0,bb:r={x:0,y:0,width:0,height:0}}={}){let n=[],l=t.length,i={x:t[0].values[0],y:t[0].values[1]};if(!("z"===t[l-1].type.toLowerCase()))return t;let o=0;if(a){let e=[];for(let a=0,r=t.length;a<r;a++){let r=t[a],{type:n,values:l}=r;if(l.length){let t=l.slice(-2),r={x:t[0],y:t[1],dist:0,index:0};r.index=a,e.push(r)}}e=e.sort((t,e)=>t.y-e.y||t.x-e.x),o=e[0].index}l=(t=yt(t,o)).length,i={x:t[0].values[0],y:t[0].values[1]};let y=t[l-2],s=y.type,h=y.values.slice(-2),u=1e-5,x=j(h[0]-i.x),c=j(h[1]-i.y);return e&&("L"===s&&x<u&&c<u)&&t.splice(l-2,1),n.push(...t),console.log("pathDataToTopLeft2",n),n}function ht(t,e=!1,a=!0){let r=[];new Set([...t.map(t=>t.type)]);let n=t.length,l=t[0].values[0],i=t[0].values[1];if(!("z"===t[n-1].type.toLowerCase()))return t;let o=0,y={x:0,y:0};if(a){let e=[];for(let a=0,r=t.length;a<r;a++){let r=t[a],{type:n,values:l}=r;if(l.length){let t=l.slice(-2),r={x:t[0],y:t[1],dist:0,index:0};r.dist=G(y,r),r.index=a,e.push(r)}}e=e.sort((t,e)=>t.dist-e.dist||t.y-e.y),o=e[0].index}n=(t=yt(t,o)).length;let s=t[n-2],h=s.type,u=s.values.slice(-2),x="L"===h&&u[0]===l&&u[1]===i;return e&&x&&t.splice(n-2,1),r.push(...t),r}function ut(t,e=-1){let a=!("auto"!=e||!t[0].hasOwnProperty("decimals"));for(let r=0,n=t.length;r<n;r++){let n=t[r];(e>-1||a)&&(e=a?n.decimals:e,t[r].values=n.values.map(t=>t?+t.toFixed(e):t))}return t}function xt(t,{toShorthands:e=!0,toRelative:a=!0,decimals:r=3}={}){return r>-1&&r<2&&(t=ut(t,r)),e&&(t=function(t,e=-1,a=!0){let r;if(a){let e=t.map(t=>t.type).join("");r=/[astvqmhlc]/g.test(e)}t=a&&r?function(t,e=-1){return ct(t,!1,e)}(t,e):t;let n={type:"M",values:t[0].values};t[0].decimals&&(n.decimals=t[0].decimals);let l,i=[n],o={x:t[0].values[0],y:t[0].values[1]},y=.01;for(let a=1,r=t.length;a<r;a++){let r=t[a],{type:s,values:h}=r,u=h.slice(-2),x=t[a-1],c=x.type;l={x:u[0],y:u[1]};let f,p,g,d,v={x:h[0],y:h[1]},m=j(l.x-o.x),w=j(l.y-o.y),b=(m+w)/2*y;switch(s){case"L":n=0===w||w<b&&m>b?{type:"H",values:[h[0]]}:0===m||w>b&&m<b?{type:"V",values:[h[1]]}:r;break;case"Q":if("Q"!==c){o={x:u[0],y:u[1]},i.push(r);continue}let t={x:x.values[0],y:x.values[1]};d={x:2*o.x-t.x,y:2*o.y-t.y},f=j(v.x-d.x),p=j(v.y-d.y),g=(f+p)/2,n=g<b?{type:"T",values:[l.x,l.y]}:r;break;case"C":let e={x:h[2],y:h[3]};if("C"!==c){i.push(r),o={x:u[0],y:u[1]};continue}let a={x:x.values[2],y:x.values[3]};d={x:2*o.x-a.x,y:2*o.y-a.y},f=j(v.x-d.x),p=j(v.y-d.y),g=(f+p)/2,n=g<b?{type:"S",values:[e.x,e.y,l.x,l.y]}:r;break;default:n={type:s,values:h}}(r.decimals||0===r.decimals)&&(n.decimals=r.decimals),e>-1&&(n.values=n.values.map(t=>+t.toFixed(e))),o={x:u[0],y:u[1]},i.push(n)}return i}(t)),a&&(t=function(t,e=-1){return ct(t,!0,e)}(t)),r>-1&&(t=ut(t,r)),t}function ct(t,e=!1,a=-1){a>=0&&(t[0].values=t[0].values.map(t=>+t.toFixed(a)));let r=t[0].values,n=r[0],l=r[1],i=n,o=l;for(let r=1,y=t.length;r<y;r++){let y=t[r],{type:s,values:h}=y,u=e?s.toLowerCase():s.toUpperCase();if(s!==u)switch(s=u,y.type=s,s){case"a":case"A":h[5]=e?h[5]-n:h[5]+n,h[6]=e?h[6]-l:h[6]+l;break;case"v":case"V":h[0]=e?h[0]-l:h[0]+l;break;case"h":case"H":h[0]=e?h[0]-n:h[0]+n;break;case"m":case"M":e?(h[0]-=n,h[1]-=l):(h[0]+=n,h[1]+=l),i=e?h[0]+n:h[0],o=e?h[1]+l:h[1];break;default:if(h.length)for(let t=0;t<h.length;t++)h[t]=e?h[t]-(t%2?l:n):h[t]+(t%2?l:n)}let x=h.length;switch(s){case"z":case"Z":n=i,l=o;break;case"h":case"H":n=e?n+h[0]:h[0];break;case"v":case"V":l=e?l+h[0]:h[0];break;case"m":case"M":i=h[x-2]+(e?n:0),o=h[x-1]+(e?l:0);default:n=h[x-2]+(e?n:0),l=h[x-1]+(e?l:0)}a>=0&&(y.values=y.values.map(t=>+t.toFixed(a)))}return t}function ft(t,e=1e-5){let a=[t[0]],r={x:t[0].values[0],y:t[0].values[1]},n=r,l=r;for(let i=1,o=t.length;i<o;i++){let y=t[i],s=t[i+1]||t[o-1],h="Z"===s.type?r:{x:s.values[s.values.length-2],y:s.values[s.values.length-1]},{type:u,values:x}=y,c=x.slice(-2);l="Z"!==u?{x:c[0],y:c[1]}:r;let f="C"===u?[{x:x[0],y:x[1]},{x:x[2],y:x[3]}]:"Q"===u?[{x:x[0],y:x[1]}]:[],p=j(ot([n,...f,l,h]));n=l,p<e||("M"===u?(r=l,n=r):"Z"===u&&(n=r),a.push(y))}return a.push({type:"Z",values:[]}),a}function pt(t){let e={x:t[0].values[0],y:t[0].values[1]},a=e,r=[t[0]];for(let n=1,l=t.length;n<l;n++){let l=t[n],{type:i,values:o,t:y=0}=l,s=o.slice(-2);a={x:s[0],y:s[1]},"L"===i&&a.x===e.x&&a.y===e.y||(r.push(l),e=a)}return r}function gt(t,e=-1,a=!1){"l"===t[1].type&&a&&(t[0].type="m");let r=`${t[0].type}${t[0].values.join(" ")}`;for(let n=1;n<t.length;n++){let l=t[n-1],i=t[n],o=l.type===i.type&&a||("m"===l.type&&"l"===i.type||"M"===l.type&&"l"===i.type||"M"===l.type&&"L"===i.type)&&a?" ":i.type;i.values.length&&e>-1&&(i.values=i.values.map(t=>+t.toFixed(e))),r+=`${o}${i.values.join(" ")}`}return a&&(r=r.replaceAll(" 0."," .").replaceAll(" -","-").replaceAll("-0.","-.").replace(/\s+([mlcsqtahvz])/gi,"$1").replaceAll("Z","z")),r}function dt(t={}){Object.assign(this,t)}async function vt(t,{turnpolicy:e="majority",turdsize:a=1,optcurve:r=!0,alphamax:n=1,opttolerance:l=1,minSize:i=1e3,maxSize:o=5e3,scale:y=1,brightness:s=1,contrast:h=1,invert:u=0,blur:x=0,crop:c=!0,optimize:f=!1,addDimensions:p=!0,toRelative:g=!0,toShorthands:d=!0,decimals:v=3}={}){let m=await b(t,{minSize:i,maxSize:o,crop:c,scale:y,brightness:s,contrast:h,invert:u,blur:x}),{bmp:w,scaleAdjust:A,width:L,height:S}=m,{pathList:z,polygons:D}=k(w,{turnpolicy:e,turdsize:a,optcurve:r,alphamax:n,opttolerance:l,scaleAdjust:A,minSize:i,maxSize:o}),C=function(t=[],e=1){t.sort((t,e)=>t.minX-e.minX||t.minY-e.minY);let a=t.length,r=[];for(let n=0;n<a;n++){let a,l=[],i=t[n],{curve:o,minX:y,maxX:s,minY:h,maxY:u,sign:x}=i,c={x:y,y:h,width:s-y,height:u-h},f=o.n;l.push({type:"M",values:[o.c[3*(f-1)+2].x*e,o.c[3*(f-1)+2].y*e],bb:c,cw:"+"===x});for(let t=0;t<f;t++){let r=o.tag[t];"curve"===r?a=[{type:"C",values:[o.c[3*t].x*e,o.c[3*t].y*e,o.c[3*t+1].x*e,o.c[3*t+1].y*e,o.c[3*t+2].x*e,o.c[3*t+2].y*e]}]:"corner"===r&&(a=[{type:"L",values:[o.c[3*t+1].x*e,o.c[3*t+1].y*e]},{type:"L",values:[o.c[3*t+2].x*e,o.c[3*t+2].y*e]}]),l.push(...a)}l.push({type:"Z",values:[]}),r.push(l)}return r}(z,y=1/A);if(!C.flat().length)throw new Error("Couldn't trace image");let $=function(t,e,a,{toRelative:r=!0,toShorthands:n=!0,decimals:l=3,addDimensions:i=!1,optimize:o=!1}={}){e=P(e),a=P(a);let y=[],s=t.length;for(let e=0;e<s;e++){let a=t[e],r=a[0].bb,n=tt(a,!0);y.push({pathData:a,bb:r,poly:n,includes:[]})}if(o)for(let t=0,e=y.length;t<e;t++){let{pathData:e,bb:a}=y[t];e=pt(e),e=ht(e),e=ft(e),y[t].pathData=e}for(let t=0,e=y.length;t<e;t++){let a=y[t],{bb:r,poly:n}=a;for(let a=0;a<e;a++){let e=y[a];if(t===a)continue;let[l,i]=[e.bb,e.poly];if(!it(r,l))continue;let o=[{x:l.x+.5*l.width,y:l.y+.5*l.height},i[0],i[T(i.length/2)],i[i.length-1]],s=!1;for(let t=0;t<o.length;t++)if(W(o[t],n,r,!0)){s=!0;break}s&&y[t].includes.push(a)}}for(let t=0,e=y.length;t<e;t++){let e=y[t],{includes:a}=e;a.forEach(e=>{let a=y[e].pathData;a.length&&(y[t].pathData.push(...a),y[e].pathData=[])})}y=y.filter(t=>t.pathData.length);let h=JSON.parse(JSON.stringify(y)).map(t=>t.pathData),u=JSON.parse(JSON.stringify(h)).flat(),x=i?`width="${e}" height="${a}" `:"",c=`<svg viewBox="0 0 ${e} ${a}" ${x}xmlns="http://www.w3.org/2000/svg">`,f=[];y.forEach(t=>{let{pathData:e}=t;try{(r||n||-1!=l)&&(e=xt(e,{toRelative:r,toShorthands:n,decimals:l}));let t=gt(e,l);f.push(t),c+=`<path d="${t}"/>`}catch{console.warn("catch pathdata could not be parsed",e)}}),c+="</svg>",(r||n||-1!=l)&&(u=xt(u,{toRelative:r,toShorthands:n,decimals:l}));let p=gt(u,l),g=`<svg viewBox="0 0 ${e} ${a}" ${x}xmlns="http://www.w3.org/2000/svg"><path d="${p}"/></svg>`;return{width:e,height:a,commands:u.length,svg:g,d:p,svgSplit:c,dArr:f,pathData:u,pathDataArr:h}}(C,L,S,{addDimensions:p,toRelative:g,toShorthands:d,optimize:f,decimals:v});return $.scaleAdjust=A,new dt($)}dt.prototype.getSVG=function(t=!1){return t?this.svgSplit:this.svg},dt.prototype.getPathData=function(){return this.pathDataNorm},dt.prototype.getPathDataNorm=function(){return this.pathDataNorm},dt.prototype.getD=function(){return this.d},"undefined"!=typeof window&&(window.pathDataToD=gt,window.PotracePlus=vt,window.svg2Canvas=L),t.PI=w,t.PotraceObj=dt,t.PotracePlus=vt,t.abs=e,t.acos=a,t.asin=r,t.atan=n,t.atan2=l,t.ceil=i,t.cos=o,t.exp=y,t.fixPathData=function(t,{addExtremes:e=!1,sortSubPaths:a=!0,sortCommands:r=!0,fixFlatCubics:n=!0,removeCollinear:l=!0}={}){let i=[],o=function(t){let e=[];try{t.map((t,e)=>"m"===t.type.toLowerCase()?e:-1).filter(t=>-1!==t)}catch{console.log("catch",t)}let a=t.map((t,e)=>"m"===t.type.toLowerCase()?e:-1).filter(t=>-1!==t);return 1===a.length?[t]:(a.forEach((r,n)=>{e.push(t.slice(r,a[n+1]))}),e)}(t).map(t=>({pathData:t,bb:{},tolerance:0})),y=o.length;for(let t=0;t<y;t++){let{pathData:a}=o[t];if(e){a=nt(a,!0),o[t].pathData=a}let r=lt(tt(a)),{width:n,height:l}=r;o[t].tolerance=(n+l)/2*.001,o[t].bb=r}let s=o.map(t=>[t.bb.x,t.bb.right]).flat(),h=o.map(t=>[t.bb.y,t.bb.bottom]).flat(),u=X(...s),x=F(...s),c=X(...h),f=F(...h),p={x:u,y:c,left:u,top:c,right:x,bottom:f,width:x-u,height:f-c},g={x:p.x,y:p.y};o.forEach((t,e)=>{let a={x:t.bb.x,y:t.bb.y},r=G(g,a);t.dist=r}),o.sort((t,e)=>t.dist-e.dist||t.bb.y-e.bb.y);for(let t=0;t<y;t++){let{pathData:e,tolerance:a,bb:r}=o[t];e=pt(e),e=st(e,{bb:r}),e=ft(e),i.push(...e)}return i=xt(i),i},t.floor=s,t.hypot=u,t.log=h,t.max=x,t.min=c,t.pow=f,t.random=p,t.round=g,t.sin=d,t.sqrt=v,t.svg2Canvas=L,t.tan=m}(this["potrace-plus"]=this["potrace-plus"]||{});
