const{abs:t,acos:e,asin:a,atan:r,atan2:n,ceil:i,cos:l,exp:s,floor:y,log:h,hypot:o,max:x,min:c,pow:u,random:f,round:p,sin:g,sqrt:d,tan:m,PI:w}=Math;async function v(t,{minSize:e=1e3,maxSize:a=5e3,filter:r="",scale:n=1,stripWhite:i=!0,crop:l=!0,canvas:s=null,brightness:y=1,contrast:h=1,invert:o=!1,blur:x=0}={}){let c,u,f=function(t){if(t instanceof HTMLImageElement)return"img";if(t instanceof SVGElement)return"svg";if(t instanceof HTMLCanvasElement)return"canvas";if(t instanceof File)return"file";if(t instanceof ArrayBuffer)return"buffer";if(t instanceof Blob)return"blob";if(Array.isArray(t))return"array";if("string"==typeof t){let e=/^(file:|https?:\/\/|\/|\.\/|\.\.\/)/.test(t),a=t.startsWith("data:image");return e||a?"url":"string"}let e=typeof t,a=t.constructor.name;return(a||e).toLowerCase()}(t),p={minSize:e,maxSize:a,filter:r,scale:n,brightness:y,contrast:h,invert:o,blur:x,canvas:s};if("img"===f)u=t.src,c=await b(u,p);else if("blob"===f||"file"===f)u=await URL.createObjectURL(t),c=await b(u,p);else if("url"===f)u=t,console.log("is URL",t),c=await b(u,p);else if("svg"===f)u=await A(t),c=await b(u,p);else if("canvas"===f){let e=t.getContext("2d"),a=`grayscale(1) invert(${o=o?"1":"0"}) blur(${x}px) brightness(${y}) contrast(${h})`;e.filter=a;let r=await e.getImageData(0,0,t.width,t.height);c={imgData:r,width:r.width,height:r.height,scaleAdjust:1}}let{imgData:g,scaleAdjust:d,width:m,height:w}=c,v={x:0,y:0,width:0,height:0};l&&(v=function(t,e=!0,a=!0,r=!1,n=null){let[i,l]=[t.width,t.height];if(!i&&!l)throw new Error("No width or height specified");let s,y=[],h={x:0,y:0,width:i,height:l},o=new Uint32Array(t.data.buffer),x=0,c="";const u=(t,e,a)=>{let r=Math.floor(a/t);return{x:a-r*t,y:r}},f=(t=0,e=!1,a=null)=>{if(r&&a){x++;let t=u(i,0,a);c+=`<rect x="${t.x}" y="${t.y}" transform="scale(1)" transform-origin="center" width="1" height="1" fill="rgba(0,255,255,0.25)" stroke="none" />`}return e?t<4294867295:t>0};let p=0,g=0,d=0,m=0,w=i,v=l,b=0,M=i*l-1,[A,S,z,I]=[1,1,1,1];if(a){let t=Math.floor(i/2),a=Math.floor(l/2),n=[0,l*i-1,i-1,l*i-i,t,l*i-t-1,a*i-1,a*i];for(let t=0;t<n.length;t++){let a=n[t];if(!(A||I||S||z))break;f(o[a],e,a)&&(0===t?(A=0,S=0):1===t?(I=0,z=0):2===t?(I=0,S=0):3===t?(A=0,S=0):4===t?A=0:5===t?I=0:6===t?z=0:7===t&&(S=0))}if(r&&console.log("corner mid check",x,"cropTop",A,"cropLeft",S,"cropRight",z,"cropBottom",I),!(A||S||z||I))return r&&console.log("image cannot be cropped â€“ opaque pixels in corners",x,"cropTop",A,"cropLeft",S,"cropRight",z,"cropBottom",I),h}for(g=0;g<l;g++){for(p=0;p<i&&(!A||!f(o[b],e,b)||(d=g,A=0,y.push(p),I))&&(!I||!f(o[M],e,M)||(v=l-g,I=0,s=u(i,0,M),y.push(s.x),A));p++)b++,M--;if(!A&&!I)break;if(g+2>=l-g&&!d)return r&&(console.log("image is empty",g,x,i*l),n.insertAdjacentHTML("beforeend",c)),h}for(p=0;p<i;p++)for(b=(d+1)*i+p,M=d*i+(i-p-1),g=d;g<v-1&&(!S||!f(o[b],e,b)||(m=p,S=0,z))&&(!z||!f(o[M],e,M)||(w=i-p,z=0,S));g++)b+=i,M+=i;return m=Math.min(...y,m),w=Math.max(...y,w),h.x=m,h.y=d,h.width=w-m,h.height=v-d,r&&(console.log(x,i*l,"skipped:",i*l-x,y),n.insertAdjacentHTML("beforeend",c)),h}(g,i),m=Math.ceil(v.width/d),w=Math.ceil(v.height/d),c.width=m,c.height=w);let M=function(t,e=0,a=0,r=0,n=0){let{data:i,width:l,height:s}=t;r=r||l,n=n||s;let y=new S(r,n),h=4*l,o=0;for(let t=a;t<a+n;t++){let a=0,n=t*h;for(let t=e;t<e+r;t++){let e=i[n+4*t],l=o*r+a;y.data[l]=e<127?1:0,a++}o++}return y}(g,v.x,v.y,v.width,v.height);return{bmp:M,scaleAdjust:d,width:m,height:w}}async function b(t="",{minSize:e=1e3,maxSize:a=5e3,scale:r=1,brightness:n=1,contrast:i=1,invert:l=0,blur:s=0,canvas:y=null}={}){let h,o,x,c,u=1,f=0;e*=r,a*=r,y||((y=document.getElementById("canvasPot"))||(y=document.createElement("canvas")),y.id="canvasPot",document.body.append(y));let p,g=y.getContext("2d",{alpha:!1,willReadFrequently:!0}),d=await fetch(t);if(d.ok){let r=await d.blob(),{type:m}=r;"image/svg+xml"!==m?(p=!0,h=await createImageBitmap(r),[o,x]=[h.width,h.height]):(h=new Image,h.src=t,h.crossOrigin="anonymous",await h.decode(),[o,x]=[h.naturalWidth,h.naturalHeight]),f=Math.min(o,x),u=!p&&(f<e||f>a)?e/f:1,o*=u,x*=u,y.width=o,y.height=x,g.fillStyle="white",g.fillRect(0,0,o,x);let w=`grayscale(1) invert(${l=l?"1":"0"}) blur(${s}px) brightness(${n}) contrast(${i})`;g.filter=w,g.drawImage(h,0,0,o,x),c=g.getImageData(0,0,o,x)}let{width:m,height:w}=c;return m=Math.ceil(m/u),w=Math.ceil(w/u),{imgData:c,scaleAdjust:u,width:m,height:w}}async function M(t,{minSize:e=1e3,maxSize:a=5e3,filter:r="",scale:n=1,canvas:i=null}={}){i||(i=document.createElement("canvas"));let l=await A(t),s=new Image;s.src=l,s.crossOrigin="anonymous",await s.decode();let[y,h]=[s.naturalWidth,s.naturalHeight],o=Math.min(y,h),x=o<e||o>a?e/o:1,c=y*x,u=h*x;i.width=c,i.height=u;let f=i.getContext("2d");return f.fillStyle="white",f.fillRect(0,0,c,u),r&&(f.filter=r),f.drawImage(s,0,0,c,u),URL.revokeObjectURL(l),i}async function A(t){const e=t.cloneNode(!0);if(document.body.append(e),!e.hasAttribute("width")&&!e.hasAttribute("height")){let a=e.hasAttribute("viewBox")?{x:0,y:0,width:300,height:150}:t.getBBox(),r=t.viewBox.baseVal.width?e.viewBox.baseVal.width:t.width.baseVal.value?t.width.baseVal.value:a.width,n=t.viewBox.baseVal.height?e.viewBox.baseVal.height:t.height.baseVal.value?t.height.baseVal.value:a.height;e.setAttribute("width",r),e.setAttribute("height",n)}let a=(new XMLSerializer).serializeToString(e),r=new Blob([a],{type:"image/svg+xml"}),n=URL.createObjectURL(r);return e.remove(),n}function S(t,e){this.w=t,this.h=e,this.size=t*e,this.arraybuffer=new ArrayBuffer(this.size),this.data=new Int8Array(this.arraybuffer)}function z(){this.area=0,this.len=0,this.curve={},this.pt=[],this.minX=1e5,this.minY=1e5,this.maxX=-1,this.maxY=-1}function I(t){this.n=t,this.tag=new Array(t),this.c=new Array(3*t),this.alphaCurve=0,this.vertex=new Array(t),this.alpha=new Array(t),this.alpha0=new Array(t),this.beta=new Array(t)}S.prototype.at=function(t,e){return t>=0&&t<this.w&&e>=0&&e<this.h&&1===this.data[this.w*e+t]},S.prototype.index=function(t){let e={x:0,y:Math.floor(t/this.w)};return e.x=t-e.y*this.w,e},S.prototype.flip=function(t,e){this.at(t,e)?this.data[this.w*e+t]=0:this.data[this.w*e+t]=1},S.prototype.copy=function(){let t,e=new S(this.w,this.h);for(t=0;t<this.size;t++)e.data[t]=this.data[t];return e};const{abs:C,acos:$,asin:k,atan:L,atan2:P,ceil:D,cos:j,exp:E,floor:R,log:B,max:q,min:O,pow:V,random:H,round:N,sin:U,sqrt:F,tan:T,PI:X}=Math;function Q(t,e,a=!1){let r=P(e.y-t.y,e.x-t.x);return a&&r<0&&(r+=2*Math.PI),r}function J(t,e,a,r=!1){const n=(t,e,a)=>t>=e&&t<=a||t<=e&&t>=a;let i=!1;if((!r||!a.bottom)&&(a.left>t.x||a.top>t.y||a.bottom<t.y||a.right<t.x))return!1;for(let a=e.length-1,r=0;r<e.length;a=r,r++){const l=e[a],s=e[r];if(t.x==l.x&&t.y==l.y||t.x==s.x&&t.y==s.y)return!0;if(l.y==s.y&&t.y==l.y&&n(t.x,l.x,s.x))return!0;if(n(t.y,l.y,s.y)){if(t.y==l.y&&s.y>=l.y||t.y==s.y&&l.y>=s.y)continue;const e=(l.x-t.x)*(s.y-t.y)-(s.x-t.x)*(l.y-t.y);if(0==e)return!0;l.y<s.y==e>0&&(i=!i)}}return!!i}function Y(t,e,a,r=!1){let n={x:(e.x-t.x)*a+t.x,y:(e.y-t.y)*a+t.y};return r&&(n.angle=Q(t,e),n.angle<0&&(n.angle+=2*X)),n}function W(t,e=.5,a=!1,r=!1){let n;return n=t.length>2?((t,e,a=!1)=>{let n=4===t.length,i=t[0],l=t[1],s=n?t[2]:t[1],y=t[t.length-1],h={x:0,y:0};if(a||r){let t,a,o,x,c,u=i.x===l.x&&i.y===l.y,f=y.x===s.x&&y.y===s.y;0!==e||u?1!==e||f?(u&&(e+=1e-7),f&&(e-=1e-7),t=Y(i,l,e),n?(a=Y(l,s,e),o=Y(s,y,e),x=Y(t,a,e),c=Y(a,o,e),h=Y(x,c,e),h.angle=Q(x,c),r&&(h.cpts=[a,o,x,c])):(a=Y(i,l,e),o=Y(l,y,e),h=Y(a,o,e),h.angle=Q(a,o),r&&(h.cpts=[a,o]))):(h.x=y.x,h.y=y.y,h.angle=Q(s,y)):(h.x=i.x,h.y=i.y,h.angle=Q(i,l))}else{let t=1-e;h=n?{x:t**3*i.x+3*t**2*e*l.x+3*t*e**2*s.x+e**3*y.x,y:t**3*i.y+3*t**2*e*l.y+3*t*e**2*s.y+e**3*y.y}:{x:t*t*i.x+2*t*e*l.x+e**2*y.x,y:t*t*i.y+2*t*e*l.y+e**2*y.y}}return h})(t,e,a):Y(t[0],t[1],e,a),a&&n.angle<0&&(n.angle+=2*X),n}function Z(t){let e=[],a={x:t[0].values[0],y:t[0].values[1]};return t.forEach(t=>{let{type:r,values:n}=t;if(n.length){let t=n.length>1?{x:n[n.length-2],y:n[n.length-1]}:"V"===r?{x:a.x,y:n[0]}:{x:n[0],y:a.y};e.push(t),a=t}}),e}function G(t){return 4===t.length?function(t,e,a,r){let[n,i,l,s,y,h,o,x]=[t.x,t.y,e.x,e.y,a.x,a.y,r.x,r.y],c=Math.min(t.y,r.y),u=Math.min(t.x,r.x),f=Math.max(t.x,r.x),p=Math.max(t.y,r.y);if(e.y>=c&&e.y<=p&&a.y>=c&&a.y<=p&&e.x>=u&&e.x<=f&&a.x>=u&&a.x<=f)return[];for(var g,d,m,w,v,b,M,A,S=[],z=0;z<2;++z)if(0==z?(d=6*n-12*l+6*y,g=-3*n+9*l-9*y+3*o,m=3*l-3*n):(d=6*i-12*s+6*h,g=-3*i+9*s-9*h+3*x,m=3*s-3*i),Math.abs(g)<1e-12){if(Math.abs(d)<1e-12)continue;0<(w=-m/d)&&w<1&&S.push(w)}else(M=d*d-4*m*g)<0?Math.abs(M)<1e-12&&0<(w=-d/(2*g))&&w<1&&S.push(w):(0<(v=(-d+(A=Math.sqrt(M)))/(2*g))&&v<1&&S.push(v),0<(b=(-d-A)/(2*g))&&b<1&&S.push(b));var I=S.length;for(;I--;)w=S[I];return S}(t[0],t[1],t[2],t[3]):function(t,e,a){let r,n,i,l=Math.min(t.y,a.y),s=Math.min(t.x,a.x),y=Math.max(t.x,a.x),h=Math.max(t.y,a.y);if(e.y>=l&&e.y<=h&&e.x>=s&&e.x<=y)return[];let[o,x,c,u,f,p]=[t.x,t.y,e.x,e.y,a.x,a.y],g=[];for(var d=0;d<2;++d)r=0==d?o-2*c+f:x-2*u+p,n=0==d?-2*o+2*c:-2*x+2*u,Math.abs(r)>1e-12&&(i=-n/(2*r),i>0&&i<1&&g.push(i));return g}(t[0],t[1],t[2])}function K(t,e){const a=(t,e,a,r,n,i)=>{var l=Math.cos(i),s=Math.sin(i),y=r*Math.cos(t),h=n*Math.sin(t);return{x:e+l*y-s*h,y:a+s*y+l*h}};let r,n,i,l,s,y=function(t,e,a,r,n,i,l,s,y){const h=(t,e,a,r)=>P(r-e,a-t);let o={cx:0,cy:0,rx:a=C(a),ry:r=C(r),startAngle:0,endAngle:0,deltaAngle:0,clockwise:l,xAxisRotation:n,largeArc:i,sweep:l};if(0==a||0==r)throw Error("rx and ry can not be 0");if(a===r){let a=Math.abs(s-t),r=Math.abs(y-e),n=a,i=Math.min(t,s),h=Math.min(e,y),x=.5*Math.PI;if(0===a&&r||0===r&&a)return n=0===a&&r?r/2:a/2,o.rx=n,o.ry=n,0===a&&r?(o.cx=t,o.cy=h+r/2,o.startAngle=e>y?x:-x,o.endAngle=e>y?-x:x,o.deltaAngle=l?Math.PI:-Math.PI):0===r&&a&&(o.cx=i+a/2,o.cy=e,o.startAngle=t>s?Math.PI:0,o.endAngle=t>s?-Math.PI:Math.PI,o.deltaAngle=l?Math.PI:-Math.PI),o}let x,c,u=a===r?0:n*X/180,f=u?U(u):0,p=u?j(u):1,g=(t-s)/2,d=(e-y)/2,m=(t+s)/2,w=(e+y)/2,v=u?p*g+f*d:g,b=u?p*d-f*g:d,M=v*v/(a*a)+b*b/(r*r);M>1&&(a*=F(M),r*=F(M),o.rx=a,o.ry=r);let A=a*r,S=a*b,z=r*v,I=S**2+z**2;if(!I)throw Error("start point can not be same as end point");let $=F(C((A*A-I)/I));i==l&&($=-$);let k=$*S/r,L=-$*z/a;x=u?p*k-f*L+m:m+k,c=u?f*k+p*L+w:w+L,o.cy=c,o.cx=x;let D=h(x,c,t,e),E=h(x,c,s,y);!l&&E>D&&(E-=2*Math.PI),l&&D>E&&(E=E<=0?E+2*Math.PI:E);let R=E-D;return o.startAngle=D,o.endAngle=E,o.deltaAngle=R,o}(t.x,t.y,e[0],e[1],e[2],e[3],e[4],e[5],e[6]),{rx:h,ry:o,cx:x,cy:c,endAngle:u,deltaAngle:f}=y,p=e[2],g={x:e[5],y:e[6]},d=[g],m=p*Math.PI/180,w=Math.tan(m);s=Math.atan2(-o*w,h);let v=s,b=s+Math.PI,M=Math.atan2(o,h*w),A=M+Math.PI,S=[t.x,g.x],z=[t.y,g.y],I=Math.min(...S),$=Math.max(...S),k=Math.min(...z),L=Math.max(...z),D=a(u-.001*f,x,c,h,o,m),E=a(u-.999*f,x,c,h,o,m);return(D.x>$||E.x>$)&&(r=a(v,x,c,h,o,m),d.push(r)),(D.x<I||E.x<I)&&(n=a(b,x,c,h,o,m),d.push(n)),(D.y<k||E.y<k)&&(l=a(A,x,c,h,o,m),d.push(l)),(D.y>L||E.y>L)&&(i=a(M,x,c,h,o,m),d.push(i)),d}function _(t){let e=[];try{t.map((t,e)=>"m"===t.type.toLowerCase()?e:-1).filter(t=>-1!==t)}catch{console.log("catch",t)}let a=t.map((t,e)=>"m"===t.type.toLowerCase()?e:-1).filter(t=>-1!==t);return 1===a.length?[t]:(a.forEach((r,n)=>{e.push(t.slice(r,a[n+1]))}),e)}function tt(t,e){let a,r,n,i,l,s,y=[],h=[],o=t[0],x=t[1],c=t[t.length-2],u=t[t.length-1];return 4===t.length?(a=W([o,x],e),r=W([x,c],e),n=W([c,u],e),i=W([a,r],e),l=W([r,n],e),s=W([i,l],e),y.push({x:o.x,y:o.y},{x:a.x,y:a.y},{x:i.x,y:i.y},{x:s.x,y:s.y}),h.push({x:s.x,y:s.y},{x:l.x,y:l.y},{x:n.x,y:n.y},{x:u.x,y:u.y})):3===t.length?(r=W([o,x],e),n=W([x,u],e),s=W([r,n],e),y.push({x:o.x,y:o.y},{x:r.x,y:r.y},{x:s.x,y:s.y}),h.push({x:s.x,y:s.y},{x:n.x,y:n.y},{x:u.x,y:u.y})):2===t.length&&(r=W([o,u],e),y.push({x:o.x,y:o.y},{x:r.x,y:r.y}),h.push({x:r.x,y:r.y},{x:u.x,y:u.y})),[y,h]}function et(t,e){let a=[],r=6===e.length?"C":"Q",n={x:e[0],y:e[1]},i="C"===r?{x:e[2],y:e[3]}:n,l={x:e[4],y:e[5]},s=Math.max(l.x,t.x),y=Math.min(l.x,t.x),h=Math.max(l.y,t.y),o=Math.min(l.y,t.y),x=0;if(n.x<y||n.x>s||n.y<o||n.y>h||i.x<y||i.x>s||i.y<o||i.y>h){let s=G("C"===r?[t,n,i,l]:[t,n,l]).sort();if(s.length){let r=function(t,e,a,r=!0){let n=[];if(!a.length)return!1;let i,l,s,y=e.length,h={x:e[y-2],y:e[y-1]};2===e.length?s=[t,h]:4===e.length?(i={x:e[0],y:e[1]},s=[t,i,h]):6===e.length&&(i={x:e[0],y:e[1]},l={x:e[2],y:e[3]},s=[t,i,l,h]);if(a.length)if(1===a.length){let t=tt(s,a[0]),e=t[0],r=t[1];n.push(e,r)}else{let t=a[0],e=tt(s,t),r=e[0];n.push(r),s=e[1];for(let e=1;e<a.length;e++){t=a[e-1];let r=tt(s,(a[e]-t)/(1-t));n.push(r[0]),e===a.length-1&&n.push(r[r.length-1]),s=r[1]}}if(r){let t,e,a=[];return n.forEach(r=>{t={type:"",values:[]},r.shift(),e=r.map(t=>Object.values(t)).flat(),t.values=e,3===r.length?t.type="C":2===r.length?t.type="Q":1===r.length&&(t.type="L"),a.push(t)}),a}return n}(t,e,s);a.push(...r),x+=r.length}else a.push({type:r,values:e})}else a.push({type:r,values:e});return{pathData:a,count:x}}function at(t){let e=[t[0]],a={x:t[0].values[0],y:t[0].values[1]},r={x:t[0].values[0],y:t[0].values[1]},n=t.length;for(let i=1;n&&i<n;i++){let n=t[i],{type:l,values:s}=n,y=s.slice(-2);if(y[0],y[1],"C"!==l&&"Q"!==l)e.push(n);else if("C"===l||"Q"===l){let t=et(a,s).pathData;t.length?e.push(...t):e.push(n)}a={x:y[0],y:y[1]},"z"===l.toLowerCase()?a=r:"M"===l&&(r={x:y[0],y:y[1]})}return e}function rt(t,e){let[a,r,n,i,l,s]=[t.x,t.y,t.width,t.height,t.x+t.width,t.y+t.height],[y,h,o,x,c,u]=[e.x,e.y,e.width,e.height,e.x+e.width,e.y+e.height],f=!1;return n*i!=o*x&&n*i>o*x&&a<y&&l>c&&r<h&&s>u&&(f=!0),f}function nt(t){let e=1/0,a=-1/0,r=1/0,n=-1/0;const i=t=>{t.x<e&&(e=t.x),t.x>a&&(a=t.x),t.y<r&&(r=t.y),t.y>n&&(n=t.y)};for(let e=0;e<t.length;e++){let a=t[e],{type:r,values:n}=a,l=n.length,s=(t[e-1]?t[e-1]:t[e]).values,y=s.length;if(l){let t={x:s[y-2],y:s[y-1]},e={x:n[l-2],y:n[l-1]};if(i(e),"C"===r||"Q"===r){let a={x:n[0],y:n[1]},l="C"===r?{x:n[2],y:n[3]}:a,s="C"===r?[t,a,l,e]:[t,a,e];G(s).forEach(t=>{let e=W(s,t);i(e)})}else if("A"===r){K(t,n).forEach(t=>{i(t)})}}}return{x:e,y:r,width:a-e,height:n-r}}function it(t,e=["x","y"]){let a=_(t);if(1===a.length)return t;let r=[];var n;a.forEach(function(t,e){let a=function(t,e=-1){let a=t.map(t=>t.x),r=t.map(t=>t.y),n=Math.min(...a),i=Math.max(...a),l=Math.min(...r),s=Math.max(...r),y={x:n,left:n,right:i,y:l,top:l,bottom:s,width:i-n,height:s-l};if(e>-1)for(let t in y)y[t]=+y[t].toFixed(e);return y}(Z(t)),{x:n,y:i,width:l,height:s}=a;r.push({x:n,y:i,width:l,height:s,index:e})}),r.sort((n=e,function(t,e){return n.map(function(a){var r=1;return"-"===a[0]&&(r=-1,a=a.substring(1)),t[a]>e[a]?r:t[a]<e[a]?-r:0}).reduce(function(t,e){return t||e},0)}));let i=[];return r.forEach(function(t,e){let r=t.index;i.push(...a[r])}),i}function lt(t,e=-1){let a=!("auto"!=e||!t[0].hasOwnProperty("decimals"));for(let r=0,n=t.length;r<n;r++){let n=t[r];(e>-1||a)&&(e=a?n.decimals:e,t[r].values=n.values.map(t=>t?+t.toFixed(e):t))}return t}function st(t,{toShorthands:e=!0,toRelative:a=!0,decimals:r=3}={}){return r>-1&&r<2&&(t=lt(t,r)),e&&(t=function(t,e=-1,a=!0){let r;if(a){let e=t.map(t=>t.type).join("");r=/[astvqmhlc]/g.test(e)}t=a&&r?function(t,e=-1){return yt(t,!1,e)}(t,e):t;let n={type:"M",values:t[0].values};t[0].decimals&&(n.decimals=t[0].decimals);let i,l=[n],s={x:t[0].values[0],y:t[0].values[1]},y=.01;for(let a=1,r=t.length;a<r;a++){let r=t[a],{type:h,values:o}=r,x=o.slice(-2),c=t[a-1],u=c.type;i={x:x[0],y:x[1]};let f,p,g,d,m={x:o[0],y:o[1]},w=Math.abs(i.x-s.x),v=Math.abs(i.y-s.y),b=(w+v)/2*y;switch(h){case"L":n=0===v||v<b&&w>b?{type:"H",values:[o[0]]}:0===w||v>b&&w<b?{type:"V",values:[o[1]]}:r;break;case"Q":if("Q"!==u){s={x:x[0],y:x[1]},l.push(r);continue}let t={x:c.values[0],y:c.values[1]};d={x:2*s.x-t.x,y:2*s.y-t.y},f=Math.abs(m.x-d.x),p=Math.abs(m.y-d.y),g=(f+p)/2,n=g<b?{type:"T",values:[i.x,i.y]}:r;break;case"C":let e={x:o[2],y:o[3]};if("C"!==u){l.push(r),s={x:x[0],y:x[1]};continue}let a={x:c.values[2],y:c.values[3]};d={x:2*s.x-a.x,y:2*s.y-a.y},f=Math.abs(m.x-d.x),p=Math.abs(m.y-d.y),g=(f+p)/2,n=g<b?{type:"S",values:[e.x,e.y,i.x,i.y]}:r;break;default:n={type:h,values:o}}(r.decimals||0===r.decimals)&&(n.decimals=r.decimals),e>-1&&(n.values=n.values.map(t=>+t.toFixed(e))),s={x:x[0],y:x[1]},l.push(n)}return l}(t)),a&&(t=function(t,e=-1){return yt(t,!0,e)}(t)),r>-1&&(t=lt(t,r)),t}function yt(t,e=!1,a=-1){a>=0&&(t[0].values=t[0].values.map(t=>+t.toFixed(a)));let r=t[0].values,n=r[0],i=r[1],l=n,s=i;for(let r=1,y=t.length;r<y;r++){let y=t[r],{type:h,values:o}=y,x=e?h.toLowerCase():h.toUpperCase();if(h!==x)switch(h=x,y.type=h,h){case"a":case"A":o[5]=e?o[5]-n:o[5]+n,o[6]=e?o[6]-i:o[6]+i;break;case"v":case"V":o[0]=e?o[0]-i:o[0]+i;break;case"h":case"H":o[0]=e?o[0]-n:o[0]+n;break;case"m":case"M":e?(o[0]-=n,o[1]-=i):(o[0]+=n,o[1]+=i),l=e?o[0]+n:o[0],s=e?o[1]+i:o[1];break;default:if(o.length)for(let t=0;t<o.length;t++)o[t]=e?o[t]-(t%2?i:n):o[t]+(t%2?i:n)}let c=o.length;switch(h){case"z":case"Z":n=l,i=s;break;case"h":case"H":n=e?n+o[0]:o[0];break;case"v":case"V":i=e?i+o[0]:o[0];break;case"m":case"M":l=o[c-2]+(e?n:0),s=o[c-1]+(e?i:0);default:n=o[c-2]+(e?n:0),i=o[c-1]+(e?i:0)}a>=0&&(y.values=y.values.map(t=>+t.toFixed(a)))}return t}function ht(t,e=-1,a=!1){"l"===t[1].type&&a&&(t[0].type="m");let r=`${t[0].type}${t[0].values.join(" ")}`;for(let n=1;n<t.length;n++){let i=t[n-1],l=t[n],s=i.type===l.type&&a||("m"===i.type&&"l"===l.type||"M"===i.type&&"l"===l.type||"M"===i.type&&"L"===l.type)&&a?" ":l.type;l.values.length&&e>-1&&(l.values=l.values.map(t=>+t.toFixed(e))),r+=`${s}${l.values.join(" ")}`}return a&&(r=r.replaceAll(" 0."," .").replaceAll(" -","-").replaceAll("-0.","-.").replace(/\s+([mlcsqtahvz])/gi,"$1").replaceAll("Z","z")),r}function ot(t,{turnpolicy:e="majority",turdsize:a=1,optcurve:r=!0,alphamax:n=1,opttolerance:i=1}={}){let l=[];return function(){let r,n=t.copy(),i={x:0,y:0};function s(t){let e=n.w*t.y+t.x;for(;e<n.size&&1!==n.data[e];)e++;return e<n.size&&n.index(e)}function y(t,e){for(let a=2;a<5;a++){let r=0;for(let i=1-a;i<=a-1;i++)r+=n.at(t+i,e+a-1)?1:-1,r+=n.at(t+a-1,e+i-1)?1:-1,r+=n.at(t+i-1,e-a)?1:-1,r+=n.at(t-a,e+i)?1:-1;if(r>0)return 1;if(r<0)return 0}return 0}function h(a){let r,i=new z,l=a.x,s=a.y,h=0,o=1;for(i.sign=t.at(a.x,a.y)?"+":"-";i.pt.push({x:l,y:s}),l>i.maxX&&(i.maxX=l),l<i.minX&&(i.minX=l),s>i.maxY&&(i.maxY=s),s<i.minY&&(i.minY=s),i.len++,l+=h,s+=o,i.area-=l*o,l!==a.x||s!==a.y;){let t=n.at(l+(h+o-1)/2,s+(o-h-1)/2),a=n.at(l+(h-o-1)/2,s+(o+h-1)/2);a&&!t?"right"===e||"black"===e&&"+"===i.sign||"white"===e&&"-"===i.sign||"majority"===e&&y(l,s)||"minority"===e&&!y(l,s)?(r=h,h=-o,o=r):(r=h,h=o,o=-r):a?(r=h,h=-o,o=r):t||(r=h,h=o,o=-r)}return i}function o(t){let e,a,r=t.pt[0].y,i=t.len;for(let l=1;l<i;l++){let i=t.pt[l].x,s=t.pt[l].y;if(s!==r){a=r<s?r:s,e=t.maxX;for(let t=i;t<e;t++)n.flip(t,a);r=s}}}for(;i=s(i);)r=h(i),o(r),r.area>a&&l.push(r)}(),function(){function t(){this.data=[0,0,0,0,0,0,0,0,0]}function e(t,e,a,r,n){this.x=t,this.y=e,this.xy=a,this.x2=r,this.y2=n}function a(t,e){return t>=e?t%e:t>=0?t:e-1-(-1-t)%e}function s(t,e){return t.x*e.y-t.y*e.x}function y(t,e,a){return t<=a?t<=e&&e<a:t<=e||e<a}function h(t){return t>0?1:t<0?-1:0}function o(t,e){let a=new Array(3),r=0;a[0]=e.x,a[1]=e.y,a[2]=1;for(let e=0;e<3;e++)for(let n=0;n<3;n++)r+=a[e]*t.at(e,n)*a[n];return r}function x(t,e,a){return{x:e.x+t*(a.x-e.x),y:e.y+t*(a.y-e.y)}}function c(t,e){let a=function(t,e){return{x:-h(e.y-t.y),y:h(e.x-t.x)}}(t,e);return a.y*(e.x-t.x)-a.x*(e.y-t.y)}function u(t="",e={},a={},r={},n={}){let i,l,s,y;return"cprod"===t||"iprod1"===t?(i=a.x-e.x,s=a.y-e.y,l=n.x-r.x,y=n.y-r.y):(i=a.x-e.x,s=a.y-e.y,l=r.x-e.x,y=r.y-e.y),"cprod"===t||"dpara"===t?i*y-l*s:i*l+s*y}function f(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function p(t,e,a,r,n){let i=1-t;return{x:i*i*i*e.x+i*i*t*3*a.x+t*t*i*3*r.x+t*t*t*n.x,y:i*i*i*e.y+i*i*t*3*a.y+t*t*i*3*r.y+t*t*t*n.y}}function g(t,e,a,r,n,i){let l=u("cprod",t,e,n,i),s=u("cprod",e,a,n,i),y=l-2*s+u("cprod",a,r,n,i),h=-2*l+2*s,o=h*h-4*y*l;if(0===y||o<0)return-1;let x=Math.sqrt(o),c=(-h+x)/(2*y),f=(-h-x)/(2*y);return c>=0&&c<=1?c:f>=0&&f<=1?f:-1}function d(t){t.x0=t.pt[0].x,t.y0=t.pt[0].y,t.sums=[];let a=t.sums;a.push(new e(0,0,0,0,0));for(let r=0;r<t.len;r++){let n=t.pt[r].x-t.x0,i=t.pt[r].y-t.y0;a.push(new e(a[r].x+n,a[r].y+i,a[r].xy+n*i,a[r].x2+n*n,a[r].y2+i*i))}}function m(t){let e,r=t.len,n=t.pt,i=new Array(r),l=new Array(r),o=new Array(4);t.lon=new Array(r);let x,c,u,f,p,g,d,m,w=[{x:0,y:0},{x:0,y:0}],v={x:0,y:0},b={x:0,y:0},M={x:0,y:0},A=0;for(c=r-1;c>=0;c--)n[c].x!=n[A].x&&n[c].y!=n[A].y&&(A=c+1),l[c]=A;for(c=r-1;c>=0;c--){for(o[0]=o[1]=o[2]=o[3]=0,e=(3+3*(n[a(c+1,r)].x-n[c].x)+(n[a(c+1,r)].y-n[c].y))/2,o[e]++,w[0].x=0,w[0].y=0,w[1].x=0,w[1].y=0,A=l[c],f=c;;){if(x=0,e=(3+3*h(n[A].x-n[f].x)+h(n[A].y-n[f].y))/2,o[e]++,o[0]&&o[1]&&o[2]&&o[3]){i[c]=f,x=1;break}if(v.x=n[A].x-n[c].x,v.y=n[A].y-n[c].y,s(w[0],v)<0||s(w[1],v)>0)break;if(Math.abs(v.x)<=1&&Math.abs(v.y)<=1||(b.x=v.x+(v.y>=0&&(v.y>0||v.x<0)?1:-1),b.y=v.y+(v.x<=0&&(v.x<0||v.y<0)?1:-1),s(w[0],b)>=0&&(w[0].x=b.x,w[0].y=b.y),b.x=v.x+(v.y<=0&&(v.y<0||v.x<0)?1:-1),b.y=v.y+(v.x>=0&&(v.x>0||v.y<0)?1:-1),s(w[1],b)<=0&&(w[1].x=b.x,w[1].y=b.y)),f=A,A=l[f],!y(A,c,f))break}0===x&&(M.x=h(n[A].x-n[f].x),M.y=h(n[A].y-n[f].y),v.x=n[f].x-n[c].x,v.y=n[f].y-n[c].y,p=s(w[0],v),g=s(w[0],M),d=s(w[1],v),m=s(w[1],M),u=1e7,g<0&&(u=Math.floor(p/-g)),m>0&&(u=Math.min(u,Math.floor(-d/m))),i[c]=a(f+u,r))}for(u=i[r-1],t.lon[r-1]=u,c=r-2;c>=0;c--)y(c+1,i[c],u)&&(u=i[c]),t.lon[c]=u;for(c=r-1;y(a(c+1,r),u,t.lon[c]);c--)t.lon[c]=u}function w(t){function e(t,e,a){let r,n,i,l,s,y,h,o,x,c,u,f,p,g,d=t.len,m=t.pt,w=t.sums,v=0;return a>=d&&(a-=d,v=1),0===v?(r=w[a+1].x-w[e].x,n=w[a+1].y-w[e].y,l=w[a+1].x2-w[e].x2,i=w[a+1].xy-w[e].xy,s=w[a+1].y2-w[e].y2,y=a+1-e):(r=w[a+1].x-w[e].x+w[d].x,n=w[a+1].y-w[e].y+w[d].y,l=w[a+1].x2-w[e].x2+w[d].x2,i=w[a+1].xy-w[e].xy+w[d].xy,s=w[a+1].y2-w[e].y2+w[d].y2,y=a+1-e+d),u=(m[e].x+m[a].x)/2-m[0].x,f=(m[e].y+m[a].y)/2-m[0].y,g=m[a].x-m[e].x,p=-(m[a].y-m[e].y),h=(l-2*r*u)/y+u*u,o=(i-r*f-n*u)/y+u*f,x=(s-2*n*f)/y+f*f,c=p*p*h+2*p*g*o+g*g*x,Math.sqrt(c)}let r,n,i,l,s,y,h,o=t.len,x=new Array(o+1),c=new Array(o+1),u=new Array(o),f=new Array(o+1),p=new Array(o+1),g=new Array(o+1);for(r=0;r<o;r++)h=a(t.lon[a(r-1,o)]-1,o),h==r&&(h=a(r+1,o)),u[r]=h<r?o:h;for(n=1,r=0;r<o;r++)for(;n<=u[r];)f[n]=r,n++;for(r=0,n=0;r<o;n++)p[n]=r,r=u[r];for(p[n]=o,i=n,r=o,n=i;n>0;n--)g[n]=r,r=f[r];for(g[0]=0,x[0]=0,n=1;n<=i;n++)for(r=g[n];r<=p[n];r++){for(y=-1,l=p[n-1];l>=f[r];l--)s=e(t,l,r)+x[l],(y<0||s<y)&&(c[r]=l,y=s);x[r]=y}for(t.m=i,t.po=new Array(i),r=o,n=i-1;r>0;n--)r=c[r],t.po[n]=r}function v(e){function r(t,e,a,r,n){let i,l,s,y,h,o,x,c,u,f,p,g=t.len,d=t.sums,m=0;for(;a>=g;)a-=g,m+=1;for(;e>=g;)e-=g,m-=1;for(;a<0;)a+=g,m-=1;for(;e<0;)e+=g,m+=1;i=d[a+1].x-d[e].x+m*d[g].x,l=d[a+1].y-d[e].y+m*d[g].y,s=d[a+1].x2-d[e].x2+m*d[g].x2,y=d[a+1].xy-d[e].xy+m*d[g].xy,h=d[a+1].y2-d[e].y2+m*d[g].y2,o=a+1-e+m*g,r.x=i/o,r.y=l/o,x=(s-i*i/o)/o,c=(y-i*l/o)/o,u=(h-l*l/o)/o,f=(x+u+Math.sqrt((x-u)*(x-u)+4*c*c))/2,x-=f,u-=f,Math.abs(x)>=Math.abs(u)?(p=Math.sqrt(x*x+c*c),0!==p&&(n.x=-c/p,n.y=x/p)):(p=Math.sqrt(u*u+c*c),0!==p&&(n.x=-u/p,n.y=c/p)),0===p&&(n.x=n.y=0)}let n,i,l,s,y,h,x,c,u,f,p,g,d,m,w,v=e.m,b=e.po,M=e.len,A=e.pt,S=e.x0,z=e.y0,C=new Array(v),$=new Array(v),k=new Array(v),L=new Array(3),P={x:0,y:0};for(e.curve=new I(v),i=0;i<v;i++)l=b[a(i+1,v)],l=a(l-b[i],M)+b[i],C[i]={x:0,y:0},$[i]={x:0,y:0},r(e,b[i],l,C[i],$[i]);for(i=0;i<v;i++)if(k[i]=new t,n=$[i].x*$[i].x+$[i].y*$[i].y,0===n)for(l=0;l<3;l++)for(s=0;s<3;s++)k[i].data[3*l+s]=0;else for(L[0]=$[i].y,L[1]=-$[i].x,L[2]=-L[1]*C[i].y-L[0]*C[i].x,y=0;y<3;y++)for(s=0;s<3;s++)k[i].data[3*y+s]=L[y]*L[s]/n;for(i=0;i<v;i++){for(h=new t,x={x:0,y:0},P.x=A[b[i]].x-S,P.y=A[b[i]].y-z,l=a(i-1,v),y=0;y<3;y++)for(s=0;s<3;s++)h.data[3*y+s]=k[l].at(y,s)+k[i].at(y,s);for(;;){if(f=h.at(0,0)*h.at(1,1)-h.at(0,1)*h.at(1,0),0!==f){x.x=(-h.at(0,2)*h.at(1,1)+h.at(1,2)*h.at(0,1))/f,x.y=(h.at(0,2)*h.at(1,0)-h.at(1,2)*h.at(0,0))/f;break}for(h.at(0,0)>h.at(1,1)?(L[0]=-h.at(0,1),L[1]=h.at(0,0)):h.at(1,1)?(L[0]=-h.at(1,1),L[1]=h.at(1,0)):(L[0]=1,L[1]=0),n=L[0]*L[0]+L[1]*L[1],L[2]=-L[1]*P.y-L[0]*P.x,y=0;y<3;y++)for(s=0;s<3;s++)h.data[3*y+s]+=L[y]*L[s]/n}if(c=Math.abs(x.x-P.x),u=Math.abs(x.y-P.y),c<=.5&&u<=.5)e.curve.vertex[i]={x:x.x+S,y:x.y+z};else{if(p=o(h,P),d=P.x,m=P.y,0!==h.at(0,0))for(w=0;w<2;w++)x.y=P.y-.5+w,x.x=-(h.at(0,1)*x.y+h.at(0,2))/h.at(0,0),c=Math.abs(x.x-P.x),g=o(h,x),c<=.5&&g<p&&(p=g,d=x.x,m=x.y);if(0!==h.at(1,1))for(w=0;w<2;w++)x.x=P.x-.5+w,x.y=-(h.at(1,0)*x.x+h.at(1,2))/h.at(1,1),u=Math.abs(x.y-P.y),g=o(h,x),u<=.5&&g<p&&(p=g,d=x.x,m=x.y);for(y=0;y<2;y++)for(s=0;s<2;s++)x.x=P.x-.5+y,x.y=P.y-.5+s,g=o(h,x),g<p&&(p=g,d=x.x,m=x.y);e.curve.vertex[i]={x:d+S,y:m+z}}}}function b(t){let e,a,r,n=t.curve,i=n.n,l=n.vertex;for(e=0,a=i-1;e<a;e++,a--)r=l[e],l[e]=l[a],l[a]=r}function M(t){let e,r,i,l,s,y,h,o,f,p=t.curve.n,g=t.curve;for(e=0;e<p;e++)r=a(e+1,p),i=a(e+2,p),f=x(.5,g.vertex[i],g.vertex[r]),s=c(g.vertex[e],g.vertex[i]),0!==s?(l=u("dpara",g.vertex[e],g.vertex[r],g.vertex[i])/s,l=Math.abs(l),y=l>1?1-1/l:0,y/=.75):y=4/3,g.alpha0[r]=y,y>=n?(g.tag[r]="corner",g.c[3*r+1]=g.vertex[r],g.c[3*r+2]=f):(y<.55?y=.55:y>1&&(y=1),h=x(.5+.5*y,g.vertex[e],g.vertex[r]),o=x(.5+.5*y,g.vertex[i],g.vertex[r]),g.tag[r]="curve",g.c[3*r+0]=h,g.c[3*r+1]=o,g.c[3*r+2]=f),g.alpha[r]=y,g.beta[r]=.5;g.alphacurve=1}function A(t){function e(){this.pen=0,this.c=[{x:0,y:0},{x:0,y:0}],this.t=0,this.s=0,this.alpha=0}function r(t,e,r,n,i,l,s){let y,o,c,d,m,w,v,b,M,A,S,z,I,C,$,k,L,P,D,j,E,R,B,q=t.curve.n,O=t.curve,V=O.vertex;if(e==r)return 1;if(y=e,m=a(e+1,q),o=a(y+1,q),d=l[o],0===d)return 1;for(b=f(V[e],V[m]),y=o;y!=r;y=o){if(o=a(y+1,q),c=a(y+2,q),l[o]!=d)return 1;if(h(u("cprod",V[e],V[m],V[o],V[c]))!=d)return 1;if(u("iprod1",V[e],V[m],V[o],V[c])<b*f(V[o],V[c])*-.999847695156)return 1}if(S=O.c[3*a(e,q)+2],z=V[a(e+1,q)],I=V[a(r,q)],C=O.c[3*a(r,q)+2],w=s[r]-s[e],w-=u("dpara",V[0],O.c[3*e+2],O.c[3*r+2])/2,e>=r&&(w+=s[q]),P=u("dpara",S,z,I),D=u("dpara",S,z,C),j=u("dpara",S,I,C),E=P+j-D,D==P)return 1;if(B=j/(j-E),R=D/(D-P),k=D*B/2,0===k)return 1;for(L=w/k,v=2-Math.sqrt(4-L/.3),n.c[0]=x(B*v,S,z),n.c[1]=x(R*v,C,I),n.alpha=v,n.t=B,n.s=R,z={x:n.c[0].x,y:n.c[0].y},I={x:n.c[1].x,y:n.c[1].y},n.pen=0,y=a(e+1,q);y!=r;y=o){if(o=a(y+1,q),B=g(S,z,I,C,V[y],V[o]),B<-.5)return 1;if($=p(B,S,z,I,C),b=f(V[y],V[o]),0===b)return 1;if(M=u("dpara",V[y],V[o],$)/b,Math.abs(M)>i)return 1;if(u("iprod",V[y],V[o],$)<0||u("iprod",V[o],V[y],$)<0)return 1;n.pen+=M*M}for(y=e;y!=r;y=o){if(o=a(y+1,q),B=g(S,z,I,C,O.c[3*y+2],O.c[3*o+2]),B<-.5)return 1;if($=p(B,S,z,I,C),b=f(O.c[3*y+2],O.c[3*o+2]),0===b)return 1;if(M=u("dpara",O.c[3*y+2],O.c[3*o+2],$)/b,A=u("dpara",O.c[3*y+2],O.c[3*o+2],V[o])/b,A*=.75*O.alpha[o],A<0&&(M=-M,A=-A),M<A-i)return 1;M<A&&(n.pen+=(M-A)*(M-A))}return 0}let n,l,s,y,o,c,d,m,w,v,b,M=t.curve,A=M.n,S=M.vertex,z=new Array(A+1),C=new Array(A+1),$=new Array(A+1),k=new Array(A+1),L=new e,P=new Array(A),D=new Array(A+1);for(l=0;l<A;l++)"curve"==M.tag[l]?P[l]=h(u("dpara",S[a(l-1,A)],S[l],S[a(l+1,A)])):P[l]=0;for(d=0,D[0]=0,o=M.vertex[0],l=0;l<A;l++)c=a(l+1,A),"curve"==M.tag[c]&&(m=M.alpha[c],d+=.3*m*(4-m)*u("dpara",M.c[3*l+2],S[c],M.c[3*c+2])/2,d+=u("dpara",o,M.c[3*l+2],M.c[3*c+2])/2),D[l+1]=d;for(z[0]=-1,C[0]=0,$[0]=0,s=1;s<=A;s++)for(z[s]=s-1,C[s]=C[s-1],$[s]=$[s-1]+1,l=s-2;l>=0&&(y=r(t,l,a(s,A),L,i,P,D),!y);l--)($[s]>$[l]+1||$[s]==$[l]+1&&C[s]>C[l]+L.pen)&&(z[s]=l,C[s]=C[l]+L.pen,$[s]=$[l]+1,k[s]=L,L=new e);for(n=$[A],w=new I(n),v=new Array(n),b=new Array(n),s=A,l=n-1;l>=0;l--)z[s]==s-1?(w.tag[l]=M.tag[a(s,A)],w.c[3*l+0]=M.c[3*a(s,A)+0],w.c[3*l+1]=M.c[3*a(s,A)+1],w.c[3*l+2]=M.c[3*a(s,A)+2],w.vertex[l]=M.vertex[a(s,A)],w.alpha[l]=M.alpha[a(s,A)],w.alpha0[l]=M.alpha0[a(s,A)],w.beta[l]=M.beta[a(s,A)],v[l]=b[l]=1):(w.tag[l]="curve",w.c[3*l+0]=k[s].c[0],w.c[3*l+1]=k[s].c[1],w.c[3*l+2]=M.c[3*a(s,A)+2],w.vertex[l]=x(k[s].s,M.c[3*a(s,A)+2],S[a(s,A)]),w.alpha[l]=k[s].alpha,w.alpha0[l]=k[s].alpha,v[l]=k[s].s,b[l]=k[s].t),s=z[s];for(l=0;l<n;l++)c=a(l+1,n),w.beta[l]=v[l]/(v[l]+b[c]);w.alphacurve=1,t.curve=w}t.prototype.at=function(t,e){return this.data[3*t+e]};for(let t=0;t<l.length;t++){let e=l[t];d(e),m(e),w(e),v(e),"-"===e.sign&&b(e),M(e),r&&A(e)}}(),l}function xt(t={}){Object.assign(this,t)}async function ct(t,{turnpolicy:e="majority",turdsize:a=1,optcurve:r=!0,alphamax:n=1,opttolerance:i=1,minSize:l=1e3,maxSize:s=5e3,scale:y=1,brightness:h=1,contrast:o=1,invert:x=0,blur:c=0,crop:u=!0,addDimensions:f=!0,toRelative:p=!0,toShorthands:g=!0,decimals:d=3}={}){let m=await v(t,{minSize:l,maxSize:s,crop:u,scale:y,brightness:h,contrast:o,invert:x,blur:c}),{bmp:w,scaleAdjust:b,width:M,height:A}=m,S=function(t=[],e=1){let a=t.length,r=[];for(let n=0;n<a;n++){let a,i=t[n].curve,l=i.n;r.push({type:"M",values:[i.c[3*(l-1)+2].x*e,i.c[3*(l-1)+2].y*e]});for(let t=0;t<l;t++){let n=i.tag[t];"curve"===n?a=[{type:"C",values:[i.c[3*t].x*e,i.c[3*t].y*e,i.c[3*t+1].x*e,i.c[3*t+1].y*e,i.c[3*t+2].x*e,i.c[3*t+2].y*e]}]:"corner"===n&&(a=[{type:"L",values:[i.c[3*t+1].x*e,i.c[3*t+1].y*e]},{type:"L",values:[i.c[3*t+2].x*e,i.c[3*t+2].y*e]}]),r.push(...a)}r.push({type:"Z",values:[]})}return r}(ot(w,{turnpolicy:e,turdsize:a,optcurve:r,alphamax:n,opttolerance:i,scaleAdjust:b,minSize:l,maxSize:s}),y=1/b);if(!S.length)throw new Error("Couldn't trace image");let z=JSON.parse(JSON.stringify(S)),I=function(t,e,a,{toRelative:r=!0,toShorthands:n=!0,decimals:i=3,addDimensions:l=!1}={}){e=Math.ceil(e),a=Math.ceil(a);let s=_(it(JSON.parse(JSON.stringify(t)))),y=[],h=s.length;for(let t=0;t<h;t++){let e=s[t],a=at(JSON.parse(JSON.stringify(e))),r=nt(a),n=Z(a);y.push({pathData:e,bb:r,poly:n,includes:[]})}for(let t=0,e=y.length;t<e;t++){let a=y[t],{bb:r,poly:n}=a;for(let a=0;a<e;a++){let e=y[a];if(t===a)continue;let[i,l]=[e.bb,e.poly];if(!rt(r,i))continue;let s=[{x:i.x+.5*i.width,y:i.y+.5*i.height},l[0],l[Math.floor(l.length/2)],l[l.length-1]],h=!1;for(let t=0;t<s.length;t++)if(J(s[t],n,r,!0)){h=!0;break}h&&y[t].includes.push(a)}}for(let t=0,e=y.length;t<e;t++){let e=y[t],{includes:a}=e;a.forEach(e=>{let a=y[e].pathData;a.length&&(y[t].pathData.push(...a),y[e].pathData=[])})}y=y.filter(t=>t.pathData.length);let o=l?`width="${e}" height="${a}" `:"",x=`<svg viewBox="0 0 ${e} ${a}" ${o}xmlns="http://www.w3.org/2000/svg">`,c=[];y.forEach(t=>{let{pathData:e}=t;try{(r||n||-1!=i)&&(e=st(e,{toRelative:r,toShorthands:n,decimals:i}));let t=ht(e,i);c.push(t),x+=`<path d="${t}"/>`}catch{console.log("catch",e)}}),x+="</svg>",(r||n||-1!=i)&&(t=st(t,{toRelative:r,toShorthands:n,decimals:i}));let u=ht(t,i);return{svg:`<svg viewBox="0 0 ${e} ${a}" ${o}xmlns="http://www.w3.org/2000/svg"><path d="${u}"/></svg>`,d:u,svgSplit:x,dArr:c,pathData:t}}(S,M,A,{addDimensions:f,toRelative:p,toShorthands:g,decimals:d});return I.width=M,I.height=A,I.commands=S.length,I.scaleAdjust=b,I.pathDataNorm=z,new xt(I)}xt.prototype.getSVG=function(t=!1){return t?this.svgSplit:this.svg},xt.prototype.getPathData=function(){return this.pathData},xt.prototype.getD=function(){return this.d},"undefined"!=typeof window&&(window.PotracePlus=ct,window.svg2Canvas=M);export{w as PI,xt as PotraceObj,ct as PotracePlus,t as abs,e as acos,a as asin,r as atan,n as atan2,i as ceil,l as cos,s as exp,y as floor,o as hypot,h as log,x as max,c as min,u as pow,f as random,p as round,g as sin,d as sqrt,M as svg2Canvas,m as tan};
