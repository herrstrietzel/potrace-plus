const{abs:t,acos:e,asin:a,atan:r,atan2:n,ceil:l,cos:i,exp:s,floor:o,log:y,hypot:h,max:x,min:u,pow:c,random:f,round:p,sin:g,sqrt:d,tan:m,PI:v}=Math;async function w(t,{minSize:e=1e3,maxSize:a=5e3,filter:r="",scale:n=1,stripWhite:l=!0,crop:i=!0,canvas:s=null,brightness:o=1,contrast:y=1,invert:h=!1,blur:x=0}={}){let u,c,f=function(t){if(t instanceof HTMLImageElement)return"img";if(t instanceof SVGElement)return"svg";if(t instanceof HTMLCanvasElement)return"canvas";if(t instanceof File)return"file";if(t instanceof ArrayBuffer)return"buffer";if(t instanceof Blob)return"blob";if(Array.isArray(t))return"array";if("string"==typeof t){let e=/^(file:|https?:\/\/|\/|\.\/|\.\.\/)/.test(t),a=t.startsWith("data:image");return e||a?"url":"string"}let e=typeof t,a=t.constructor.name;return(a||e).toLowerCase()}(t),p={minSize:e,maxSize:a,filter:r,scale:n,brightness:o,contrast:y,invert:h,blur:x,canvas:s};if("img"===f)c=t.src,u=await b(c,p);else if("blob"===f||"file"===f)c=await URL.createObjectURL(t),u=await b(c,p);else if("url"===f)c=t,console.log("is URL",t),u=await b(c,p);else if("svg"===f)c=await A(t),u=await b(c,p);else if("canvas"===f){let e=t.getContext("2d"),a=`grayscale(1) invert(${h=h?"1":"0"}) blur(${x}px) brightness(${o}) contrast(${y})`;e.filter=a;let r=await e.getImageData(0,0,t.width,t.height);u={imgData:r,width:r.width,height:r.height,scaleAdjust:1}}let{imgData:g,scaleAdjust:d,width:m,height:v}=u,w={x:0,y:0,width:0,height:0};i&&(w=function(t,e=!0,a=!0,r=!1,n=null){let[l,i]=[t.width,t.height];if(!l&&!i)throw new Error("No width or height specified");let s,o=[],y={x:0,y:0,width:l,height:i},h=new Uint32Array(t.data.buffer),x=0,u="";const c=(t,e,a)=>{let r=Math.floor(a/t);return{x:a-r*t,y:r}},f=(t=0,e=!1,a=null)=>{if(r&&a){x++;let t=c(l,0,a);u+=`<rect x="${t.x}" y="${t.y}" transform="scale(1)" transform-origin="center" width="1" height="1" fill="rgba(0,255,255,0.25)" stroke="none" />`}return e?t<4294867295:t>0};let p=0,g=0,d=0,m=0,v=l,w=i,b=0,M=l*i-1,[A,L,S,z]=[1,1,1,1];if(a){let t=Math.floor(l/2),a=Math.floor(i/2),n=[0,i*l-1,l-1,i*l-l,t,i*l-t-1,a*l-1,a*l];for(let t=0;t<n.length;t++){let a=n[t];if(!(A||z||L||S))break;f(h[a],e,a)&&(0===t?(A=0,L=0):1===t?(z=0,S=0):2===t?(z=0,L=0):3===t?(A=0,L=0):4===t?A=0:5===t?z=0:6===t?S=0:7===t&&(L=0))}if(r&&console.log("corner mid check",x,"cropTop",A,"cropLeft",L,"cropRight",S,"cropBottom",z),!(A||L||S||z))return r&&console.log("image cannot be cropped â€“ opaque pixels in corners",x,"cropTop",A,"cropLeft",L,"cropRight",S,"cropBottom",z),y}for(g=0;g<i;g++){for(p=0;p<l&&(!A||!f(h[b],e,b)||(d=g,A=0,o.push(p),z))&&(!z||!f(h[M],e,M)||(w=i-g,z=0,s=c(l,0,M),o.push(s.x),A));p++)b++,M--;if(!A&&!z)break;if(g+2>=i-g&&!d)return r&&(console.log("image is empty",g,x,l*i),n.insertAdjacentHTML("beforeend",u)),y}for(p=0;p<l;p++)for(b=(d+1)*l+p,M=d*l+(l-p-1),g=d;g<w-1&&(!L||!f(h[b],e,b)||(m=p,L=0,S))&&(!S||!f(h[M],e,M)||(v=l-p,S=0,L));g++)b+=l,M+=l;return m=Math.min(...o,m),v=Math.max(...o,v),y.x=m,y.y=d,y.width=v-m,y.height=w-d,r&&(console.log(x,l*i,"skipped:",l*i-x,o),n.insertAdjacentHTML("beforeend",u)),y}(g,l),m=Math.ceil(w.width/d),v=Math.ceil(w.height/d),u.width=m,u.height=v);let M=function(t,e=0,a=0,r=0,n=0){let{data:l,width:i,height:s}=t;r=r||i,n=n||s;let o=new L(r,n),y=4*i,h=0;for(let t=a;t<a+n;t++){let a=0,n=t*y;for(let t=e;t<e+r;t++){let e=l[n+4*t],i=h*r+a;o.data[i]=e<127?1:0,a++}h++}return o}(g,w.x,w.y,w.width,w.height);return{bmp:M,scaleAdjust:d,width:m,height:v}}async function b(t="",{minSize:e=1e3,maxSize:a=5e3,scale:r=1,brightness:n=1,contrast:l=1,invert:i=0,blur:s=0,canvas:o=null}={}){let y,h,x,u,c=1,f=0;e*=r,a*=r,o||((o=document.getElementById("canvasPot"))||(o=document.createElement("canvas")),o.id="canvasPot",document.body.append(o));let p,g=o.getContext("2d",{alpha:!1,willReadFrequently:!0}),d=await fetch(t);if(d.ok){let r=await d.blob(),{type:m}=r;"image/svg+xml"!==m?(p=!0,y=await createImageBitmap(r),[h,x]=[y.width,y.height]):(y=new Image,y.src=t,y.crossOrigin="anonymous",await y.decode(),[h,x]=[y.naturalWidth,y.naturalHeight]),f=Math.min(h,x),c=!p&&(f<e||f>a)?e/f:1,h*=c,x*=c,o.width=h,o.height=x,g.fillStyle="white",g.fillRect(0,0,h,x);let v=`grayscale(1) invert(${i=i?"1":"0"}) blur(${s}px) brightness(${n}) contrast(${l})`;g.filter=v,g.drawImage(y,0,0,h,x),u=g.getImageData(0,0,h,x)}let{width:m,height:v}=u;return m=Math.ceil(m/c),v=Math.ceil(v/c),{imgData:u,scaleAdjust:c,width:m,height:v}}async function M(t,{minSize:e=1e3,maxSize:a=5e3,filter:r="",scale:n=1,canvas:l=null}={}){l||(l=document.createElement("canvas"));let i=await A(t),s=new Image;s.src=i,s.crossOrigin="anonymous",await s.decode();let[o,y]=[s.naturalWidth,s.naturalHeight],h=Math.min(o,y),x=h<e||h>a?e/h:1,u=o*x,c=y*x;l.width=u,l.height=c;let f=l.getContext("2d");return f.fillStyle="white",f.fillRect(0,0,u,c),r&&(f.filter=r),f.drawImage(s,0,0,u,c),URL.revokeObjectURL(i),l}async function A(t){const e=t.cloneNode(!0);if(document.body.append(e),!e.hasAttribute("width")&&!e.hasAttribute("height")){let a=e.hasAttribute("viewBox")?{x:0,y:0,width:300,height:150}:t.getBBox(),r=t.viewBox.baseVal.width?e.viewBox.baseVal.width:t.width.baseVal.value?t.width.baseVal.value:a.width,n=t.viewBox.baseVal.height?e.viewBox.baseVal.height:t.height.baseVal.value?t.height.baseVal.value:a.height;e.setAttribute("width",r),e.setAttribute("height",n)}let a=(new XMLSerializer).serializeToString(e),r=new Blob([a],{type:"image/svg+xml"}),n=URL.createObjectURL(r);return e.remove(),n}function L(t,e){this.w=t,this.h=e,this.size=t*e,this.arraybuffer=new ArrayBuffer(this.size),this.data=new Int8Array(this.arraybuffer)}function S(){this.area=0,this.len=0,this.curve={},this.pt=[],this.minX=1e5,this.minY=1e5,this.maxX=-1,this.maxY=-1}function z(t){this.n=t,this.tag=new Array(t),this.c=new Array(3*t),this.alphaCurve=0,this.vertex=new Array(t),this.alpha=new Array(t),this.alpha0=new Array(t),this.beta=new Array(t)}function D(t,e=1){let a=t.curve,r=a.n,n=[];n.push({x:a.c[3*(r-1)+2].x*e,y:a.c[3*(r-1)+2].y*e});for(let t=0;t<r;t++){let r=a.tag[t];"curve"===r?n.push({x:a.c[3*t+2].x*e,y:a.c[3*t+2].y*e}):"corner"===r&&n.push({x:a.c[3*t+1].x*e,y:a.c[3*t+1].y*e},{x:a.c[3*t+2].x*e,y:a.c[3*t+2].y*e})}return n}function C(t,{turnpolicy:e="majority",turdsize:a=1,optcurve:r=!0,alphamax:n=1,opttolerance:l=1,getPolygon:i=!1}={}){let s=[],o=[];if(function(){let r,n=t.copy(),l={x:0,y:0};function i(t){let e=n.w*t.y+t.x;for(;e<n.size&&1!==n.data[e];)e++;return e<n.size&&n.index(e)}function o(t,e){for(let a=2;a<5;a++){let r=0;for(let l=1-a;l<=a-1;l++)r+=n.at(t+l,e+a-1)?1:-1,r+=n.at(t+a-1,e+l-1)?1:-1,r+=n.at(t+l-1,e-a)?1:-1,r+=n.at(t-a,e+l)?1:-1;if(r>0)return 1;if(r<0)return 0}return 0}function y(a){let r,l=new S,i=a.x,s=a.y,y=0,h=1;for(l.sign=t.at(a.x,a.y)?"+":"-";l.pt.push({x:i,y:s}),i>l.maxX&&(l.maxX=i),i<l.minX&&(l.minX=i),s>l.maxY&&(l.maxY=s),s<l.minY&&(l.minY=s),l.len++,i+=y,s+=h,l.area-=i*h,i!==a.x||s!==a.y;){let t=n.at(i+(y+h-1)/2,s+(h-y-1)/2),a=n.at(i+(y-h-1)/2,s+(h+y-1)/2);a&&!t?"right"===e||"black"===e&&"+"===l.sign||"white"===e&&"-"===l.sign||"majority"===e&&o(i,s)||"minority"===e&&!o(i,s)?(r=y,y=-h,h=r):(r=y,y=h,h=-r):a?(r=y,y=-h,h=r):t||(r=y,y=h,h=-r)}return l}function h(t){let e,a,r=t.pt[0].y,l=t.len;for(let i=1;i<l;i++){let l=t.pt[i].x,s=t.pt[i].y;if(s!==r){a=r<s?r:s,e=t.maxX;for(let t=l;t<e;t++)n.flip(t,a);r=s}}}for(;l=i(l);)r=y(l),h(r),r.area>a&&s.push(r)}(),function(){function t(){this.data=[0,0,0,0,0,0,0,0,0]}function e(t,e,a,r,n){this.x=t,this.y=e,this.xy=a,this.x2=r,this.y2=n}function a(t,e){return t>=e?t%e:t>=0?t:e-1-(-1-t)%e}function y(t,e){return t.x*e.y-t.y*e.x}function h(t,e,a){return t<=a?t<=e&&e<a:t<=e||e<a}function x(t){return t>0?1:t<0?-1:0}function u(t,e){let a=new Array(3),r=0;a[0]=e.x,a[1]=e.y,a[2]=1;for(let e=0;e<3;e++)for(let n=0;n<3;n++)r+=a[e]*t.at(e,n)*a[n];return r}function c(t,e,a){return{x:e.x+t*(a.x-e.x),y:e.y+t*(a.y-e.y)}}function f(t,e){let a=function(t,e){return{x:-x(e.y-t.y),y:x(e.x-t.x)}}(t,e);return a.y*(e.x-t.x)-a.x*(e.y-t.y)}function p(t="",e={},a={},r={},n={}){let l,i,s,o;return"cprod"===t||"iprod1"===t?(l=a.x-e.x,s=a.y-e.y,i=n.x-r.x,o=n.y-r.y):(l=a.x-e.x,s=a.y-e.y,i=r.x-e.x,o=r.y-e.y),"cprod"===t||"dpara"===t?l*o-i*s:l*i+s*o}function g(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function d(t,e,a,r,n){let l=1-t;return{x:l*l*l*e.x+l*l*t*3*a.x+t*t*l*3*r.x+t*t*t*n.x,y:l*l*l*e.y+l*l*t*3*a.y+t*t*l*3*r.y+t*t*t*n.y}}function m(t,e,a,r,n,l){let i=p("cprod",t,e,n,l),s=p("cprod",e,a,n,l),o=i-2*s+p("cprod",a,r,n,l),y=-2*i+2*s,h=y*y-4*o*i;if(0===o||h<0)return-1;let x=Math.sqrt(h),u=(-y+x)/(2*o),c=(-y-x)/(2*o);return u>=0&&u<=1?u:c>=0&&c<=1?c:-1}function v(t){t.x0=t.pt[0].x,t.y0=t.pt[0].y,t.sums=[];let a=t.sums;a.push(new e(0,0,0,0,0));for(let r=0;r<t.len;r++){let n=t.pt[r].x-t.x0,l=t.pt[r].y-t.y0;a.push(new e(a[r].x+n,a[r].y+l,a[r].xy+n*l,a[r].x2+n*n,a[r].y2+l*l))}}function w(t){let e,r=t.len,n=t.pt,l=new Array(r),i=new Array(r),s=new Array(4);t.lon=new Array(r);let o,u,c,f,p,g,d,m,v=[{x:0,y:0},{x:0,y:0}],w={x:0,y:0},b={x:0,y:0},M={x:0,y:0},A=0;for(u=r-1;u>=0;u--)n[u].x!=n[A].x&&n[u].y!=n[A].y&&(A=u+1),i[u]=A;for(u=r-1;u>=0;u--){for(s[0]=s[1]=s[2]=s[3]=0,e=(3+3*(n[a(u+1,r)].x-n[u].x)+(n[a(u+1,r)].y-n[u].y))/2,s[e]++,v[0].x=0,v[0].y=0,v[1].x=0,v[1].y=0,A=i[u],f=u;;){if(o=0,e=(3+3*x(n[A].x-n[f].x)+x(n[A].y-n[f].y))/2,s[e]++,s[0]&&s[1]&&s[2]&&s[3]){l[u]=f,o=1;break}if(w.x=n[A].x-n[u].x,w.y=n[A].y-n[u].y,y(v[0],w)<0||y(v[1],w)>0)break;if(Math.abs(w.x)<=1&&Math.abs(w.y)<=1||(b.x=w.x+(w.y>=0&&(w.y>0||w.x<0)?1:-1),b.y=w.y+(w.x<=0&&(w.x<0||w.y<0)?1:-1),y(v[0],b)>=0&&(v[0].x=b.x,v[0].y=b.y),b.x=w.x+(w.y<=0&&(w.y<0||w.x<0)?1:-1),b.y=w.y+(w.x>=0&&(w.x>0||w.y<0)?1:-1),y(v[1],b)<=0&&(v[1].x=b.x,v[1].y=b.y)),f=A,A=i[f],!h(A,u,f))break}0===o&&(M.x=x(n[A].x-n[f].x),M.y=x(n[A].y-n[f].y),w.x=n[f].x-n[u].x,w.y=n[f].y-n[u].y,p=y(v[0],w),g=y(v[0],M),d=y(v[1],w),m=y(v[1],M),c=1e7,g<0&&(c=Math.floor(p/-g)),m>0&&(c=Math.min(c,Math.floor(-d/m))),l[u]=a(f+c,r))}for(c=l[r-1],t.lon[r-1]=c,u=r-2;u>=0;u--)h(u+1,l[u],c)&&(c=l[u]),t.lon[u]=c;for(u=r-1;h(a(u+1,r),c,t.lon[u]);u--)t.lon[u]=c}function b(t){function e(t,e,a){let r,n,l,i,s,o,y,h,x,u,c,f,p,g,d=t.len,m=t.pt,v=t.sums,w=0;return a>=d&&(a-=d,w=1),0===w?(r=v[a+1].x-v[e].x,n=v[a+1].y-v[e].y,i=v[a+1].x2-v[e].x2,l=v[a+1].xy-v[e].xy,s=v[a+1].y2-v[e].y2,o=a+1-e):(r=v[a+1].x-v[e].x+v[d].x,n=v[a+1].y-v[e].y+v[d].y,i=v[a+1].x2-v[e].x2+v[d].x2,l=v[a+1].xy-v[e].xy+v[d].xy,s=v[a+1].y2-v[e].y2+v[d].y2,o=a+1-e+d),c=(m[e].x+m[a].x)/2-m[0].x,f=(m[e].y+m[a].y)/2-m[0].y,g=m[a].x-m[e].x,p=-(m[a].y-m[e].y),y=(i-2*r*c)/o+c*c,h=(l-r*f-n*c)/o+c*f,x=(s-2*n*f)/o+f*f,u=p*p*y+2*p*g*h+g*g*x,Math.sqrt(u)}let r,n,l,i,s,o,y,h=t.len,x=new Array(h+1),u=new Array(h+1),c=new Array(h),f=new Array(h+1),p=new Array(h+1),g=new Array(h+1);for(r=0;r<h;r++)y=a(t.lon[a(r-1,h)]-1,h),y==r&&(y=a(r+1,h)),c[r]=y<r?h:y;for(n=1,r=0;r<h;r++)for(;n<=c[r];)f[n]=r,n++;for(r=0,n=0;r<h;n++)p[n]=r,r=c[r];for(p[n]=h,l=n,r=h,n=l;n>0;n--)g[n]=r,r=f[r];for(g[0]=0,x[0]=0,n=1;n<=l;n++)for(r=g[n];r<=p[n];r++){for(o=-1,i=p[n-1];i>=f[r];i--)s=e(t,i,r)+x[i],(o<0||s<o)&&(u[r]=i,o=s);x[r]=o}for(t.m=l,t.po=new Array(l),r=h,n=l-1;r>0;n--)r=u[r],t.po[n]=r}function M(e){function r(t,e,a,r,n){let l,i,s,o,y,h,x,u,c,f,p,g=t.len,d=t.sums,m=0;for(;a>=g;)a-=g,m+=1;for(;e>=g;)e-=g,m-=1;for(;a<0;)a+=g,m-=1;for(;e<0;)e+=g,m+=1;l=d[a+1].x-d[e].x+m*d[g].x,i=d[a+1].y-d[e].y+m*d[g].y,s=d[a+1].x2-d[e].x2+m*d[g].x2,o=d[a+1].xy-d[e].xy+m*d[g].xy,y=d[a+1].y2-d[e].y2+m*d[g].y2,h=a+1-e+m*g,r.x=l/h,r.y=i/h,x=(s-l*l/h)/h,u=(o-l*i/h)/h,c=(y-i*i/h)/h,f=(x+c+Math.sqrt((x-c)*(x-c)+4*u*u))/2,x-=f,c-=f,Math.abs(x)>=Math.abs(c)?(p=Math.sqrt(x*x+u*u),0!==p&&(n.x=-u/p,n.y=x/p)):(p=Math.sqrt(c*c+u*u),0!==p&&(n.x=-c/p,n.y=u/p)),0===p&&(n.x=n.y=0)}let n,l,i,s,o,y,h,x,c,f,p,g,d,m,v,w=e.m,b=e.po,M=e.len,A=e.pt,L=e.x0,S=e.y0,D=new Array(w),C=new Array(w),$=new Array(w),k=new Array(3),j={x:0,y:0};for(e.curve=new z(w),l=0;l<w;l++)i=b[a(l+1,w)],i=a(i-b[l],M)+b[l],D[l]={x:0,y:0},C[l]={x:0,y:0},r(e,b[l],i,D[l],C[l]);for(l=0;l<w;l++)if($[l]=new t,n=C[l].x*C[l].x+C[l].y*C[l].y,0===n)for(i=0;i<3;i++)for(s=0;s<3;s++)$[l].data[3*i+s]=0;else for(k[0]=C[l].y,k[1]=-C[l].x,k[2]=-k[1]*D[l].y-k[0]*D[l].x,o=0;o<3;o++)for(s=0;s<3;s++)$[l].data[3*o+s]=k[o]*k[s]/n;for(l=0;l<w;l++){for(y=new t,h={x:0,y:0},j.x=A[b[l]].x-L,j.y=A[b[l]].y-S,i=a(l-1,w),o=0;o<3;o++)for(s=0;s<3;s++)y.data[3*o+s]=$[i].at(o,s)+$[l].at(o,s);for(;;){if(f=y.at(0,0)*y.at(1,1)-y.at(0,1)*y.at(1,0),0!==f){h.x=(-y.at(0,2)*y.at(1,1)+y.at(1,2)*y.at(0,1))/f,h.y=(y.at(0,2)*y.at(1,0)-y.at(1,2)*y.at(0,0))/f;break}for(y.at(0,0)>y.at(1,1)?(k[0]=-y.at(0,1),k[1]=y.at(0,0)):y.at(1,1)?(k[0]=-y.at(1,1),k[1]=y.at(1,0)):(k[0]=1,k[1]=0),n=k[0]*k[0]+k[1]*k[1],k[2]=-k[1]*j.y-k[0]*j.x,o=0;o<3;o++)for(s=0;s<3;s++)y.data[3*o+s]+=k[o]*k[s]/n}if(x=Math.abs(h.x-j.x),c=Math.abs(h.y-j.y),x<=.5&&c<=.5)e.curve.vertex[l]={x:h.x+L,y:h.y+S};else{if(p=u(y,j),d=j.x,m=j.y,0!==y.at(0,0))for(v=0;v<2;v++)h.y=j.y-.5+v,h.x=-(y.at(0,1)*h.y+y.at(0,2))/y.at(0,0),x=Math.abs(h.x-j.x),g=u(y,h),x<=.5&&g<p&&(p=g,d=h.x,m=h.y);if(0!==y.at(1,1))for(v=0;v<2;v++)h.x=j.x-.5+v,h.y=-(y.at(1,0)*h.x+y.at(1,2))/y.at(1,1),c=Math.abs(h.y-j.y),g=u(y,h),c<=.5&&g<p&&(p=g,d=h.x,m=h.y);for(o=0;o<2;o++)for(s=0;s<2;s++)h.x=j.x-.5+o,h.y=j.y-.5+s,g=u(y,h),g<p&&(p=g,d=h.x,m=h.y);e.curve.vertex[l]={x:d+L,y:m+S}}}}function A(t){let e,a,r,n=t.curve,l=n.n,i=n.vertex;for(e=0,a=l-1;e<a;e++,a--)r=i[e],i[e]=i[a],i[a]=r}function L(t){let e,r,l,i,s,o,y,h,x,u=t.curve.n,g=t.curve;for(e=0;e<u;e++)r=a(e+1,u),l=a(e+2,u),x=c(.5,g.vertex[l],g.vertex[r]),s=f(g.vertex[e],g.vertex[l]),0!==s?(i=p("dpara",g.vertex[e],g.vertex[r],g.vertex[l])/s,i=Math.abs(i),o=i>1?1-1/i:0,o/=.75):o=4/3,g.alpha0[r]=o,o>=n?(g.tag[r]="corner",g.c[3*r+1]=g.vertex[r],g.c[3*r+2]=x):(o<.55?o=.55:o>1&&(o=1),y=c(.5+.5*o,g.vertex[e],g.vertex[r]),h=c(.5+.5*o,g.vertex[l],g.vertex[r]),g.tag[r]="curve",g.c[3*r+0]=y,g.c[3*r+1]=h,g.c[3*r+2]=x),g.alpha[r]=o,g.beta[r]=.5;g.alphacurve=1}function S(t){function e(){this.pen=0,this.c=[{x:0,y:0},{x:0,y:0}],this.t=0,this.s=0,this.alpha=0}function r(t,e,r,n,l,i,s){let o,y,h,u,f,v,w,b,M,A,L,S,z,D,C,$,k,j,E,R,B,q,I,P=t.curve.n,T=t.curve,V=T.vertex;if(e==r)return 1;if(o=e,f=a(e+1,P),y=a(o+1,P),u=i[y],0===u)return 1;for(b=g(V[e],V[f]),o=y;o!=r;o=y){if(y=a(o+1,P),h=a(o+2,P),i[y]!=u)return 1;if(x(p("cprod",V[e],V[f],V[y],V[h]))!=u)return 1;if(p("iprod1",V[e],V[f],V[y],V[h])<b*g(V[y],V[h])*-.999847695156)return 1}if(L=T.c[3*a(e,P)+2],S=V[a(e+1,P)],z=V[a(r,P)],D=T.c[3*a(r,P)+2],v=s[r]-s[e],v-=p("dpara",V[0],T.c[3*e+2],T.c[3*r+2])/2,e>=r&&(v+=s[P]),j=p("dpara",L,S,z),E=p("dpara",L,S,D),R=p("dpara",L,z,D),B=j+R-E,E==j)return 1;if(I=R/(R-B),q=E/(E-j),$=E*I/2,0===$)return 1;for(k=v/$,w=2-Math.sqrt(4-k/.3),n.c[0]=c(I*w,L,S),n.c[1]=c(q*w,D,z),n.alpha=w,n.t=I,n.s=q,S={x:n.c[0].x,y:n.c[0].y},z={x:n.c[1].x,y:n.c[1].y},n.pen=0,o=a(e+1,P);o!=r;o=y){if(y=a(o+1,P),I=m(L,S,z,D,V[o],V[y]),I<-.5)return 1;if(C=d(I,L,S,z,D),b=g(V[o],V[y]),0===b)return 1;if(M=p("dpara",V[o],V[y],C)/b,Math.abs(M)>l)return 1;if(p("iprod",V[o],V[y],C)<0||p("iprod",V[y],V[o],C)<0)return 1;n.pen+=M*M}for(o=e;o!=r;o=y){if(y=a(o+1,P),I=m(L,S,z,D,T.c[3*o+2],T.c[3*y+2]),I<-.5)return 1;if(C=d(I,L,S,z,D),b=g(T.c[3*o+2],T.c[3*y+2]),0===b)return 1;if(M=p("dpara",T.c[3*o+2],T.c[3*y+2],C)/b,A=p("dpara",T.c[3*o+2],T.c[3*y+2],V[y])/b,A*=.75*T.alpha[y],A<0&&(M=-M,A=-A),M<A-l)return 1;M<A&&(n.pen+=(M-A)*(M-A))}return 0}let n,i,s,o,y,h,u,f,v,w,b,M=t.curve,A=M.n,L=M.vertex,S=new Array(A+1),D=new Array(A+1),C=new Array(A+1),$=new Array(A+1),k=new e,j=new Array(A),E=new Array(A+1);for(i=0;i<A;i++)"curve"==M.tag[i]?j[i]=x(p("dpara",L[a(i-1,A)],L[i],L[a(i+1,A)])):j[i]=0;for(u=0,E[0]=0,y=M.vertex[0],i=0;i<A;i++)h=a(i+1,A),"curve"==M.tag[h]&&(f=M.alpha[h],u+=.3*f*(4-f)*p("dpara",M.c[3*i+2],L[h],M.c[3*h+2])/2,u+=p("dpara",y,M.c[3*i+2],M.c[3*h+2])/2),E[i+1]=u;for(S[0]=-1,D[0]=0,C[0]=0,s=1;s<=A;s++)for(S[s]=s-1,D[s]=D[s-1],C[s]=C[s-1]+1,i=s-2;i>=0&&(o=r(t,i,a(s,A),k,l,j,E),!o);i--)(C[s]>C[i]+1||C[s]==C[i]+1&&D[s]>D[i]+k.pen)&&(S[s]=i,D[s]=D[i]+k.pen,C[s]=C[i]+1,$[s]=k,k=new e);for(n=C[A],v=new z(n),w=new Array(n),b=new Array(n),s=A,i=n-1;i>=0;i--)S[s]==s-1?(v.tag[i]=M.tag[a(s,A)],v.c[3*i+0]=M.c[3*a(s,A)+0],v.c[3*i+1]=M.c[3*a(s,A)+1],v.c[3*i+2]=M.c[3*a(s,A)+2],v.vertex[i]=M.vertex[a(s,A)],v.alpha[i]=M.alpha[a(s,A)],v.alpha0[i]=M.alpha0[a(s,A)],v.beta[i]=M.beta[a(s,A)],w[i]=b[i]=1):(v.tag[i]="curve",v.c[3*i+0]=$[s].c[0],v.c[3*i+1]=$[s].c[1],v.c[3*i+2]=M.c[3*a(s,A)+2],v.vertex[i]=c($[s].s,M.c[3*a(s,A)+2],L[a(s,A)]),v.alpha[i]=$[s].alpha,v.alpha0[i]=$[s].alpha,w[i]=$[s].s,b[i]=$[s].t),s=S[s];for(i=0;i<n;i++)h=a(i+1,n),v.beta[i]=w[i]/(w[i]+b[h]);v.alphacurve=1,t.curve=v}t.prototype.at=function(t,e){return this.data[3*t+e]};for(let t=0;t<s.length;t++){let e=s[t];if(v(e),w(e),b(e),M(e),"-"===e.sign&&A(e),L(e),i){let t=D(e);o.push(t)}r&&S(e)}}(),i){let t="";o.forEach(e=>{t+="M"+e.map(t=>`${t.x} ${t.y}`).join(" ")})}return{pathList:s,polygons:o}}L.prototype.at=function(t,e){return t>=0&&t<this.w&&e>=0&&e<this.h&&1===this.data[this.w*e+t]},L.prototype.index=function(t){let e={x:0,y:Math.floor(t/this.w)};return e.x=t-e.y*this.w,e},L.prototype.flip=function(t,e){this.at(t,e)?this.data[this.w*e+t]=0:this.data[this.w*e+t]=1},L.prototype.copy=function(){let t,e=new L(this.w,this.h);for(t=0;t<this.size;t++)e.data[t]=this.data[t];return e};const{abs:$,acos:k,asin:j,atan:E,atan2:R,ceil:B,cos:q,exp:I,floor:P,log:T,max:V,min:F,pow:O,random:X,round:Y,sin:Z,sqrt:H,tan:N,PI:U}=Math;function Q(t,e,a=!1){let r=R(e.y-t.y,e.x-t.x);return a&&r<0&&(r+=2*Math.PI),r}function J(t,e,a,r=!1){const n=(t,e,a)=>t>=e&&t<=a||t<=e&&t>=a;let l=!1;if((!r||!a.bottom)&&(a.left>t.x||a.top>t.y||a.bottom<t.y||a.right<t.x))return!1;for(let a=e.length-1,r=0;r<e.length;a=r,r++){const i=e[a],s=e[r];if(t.x==i.x&&t.y==i.y||t.x==s.x&&t.y==s.y)return!0;if(i.y==s.y&&t.y==i.y&&n(t.x,i.x,s.x))return!0;if(n(t.y,i.y,s.y)){if(t.y==i.y&&s.y>=i.y||t.y==s.y&&i.y>=s.y)continue;const e=(i.x-t.x)*(s.y-t.y)-(s.x-t.x)*(i.y-t.y);if(0==e)return!0;i.y<s.y==e>0&&(l=!l)}}return!!l}function W(t,e){return(e.x-t.x)**2+(e.y-t.y)**2}function G(t,e,a,r=!1){let n={x:(e.x-t.x)*a+t.x,y:(e.y-t.y)*a+t.y};return r&&(n.angle=Q(t,e),n.angle<0&&(n.angle+=2*U)),n}function K(t,e=.5,a=!1,r=!1){let n;return n=t.length>2?((t,e,a=!1)=>{let n=4===t.length,l=t[0],i=t[1],s=n?t[2]:t[1],o=t[t.length-1],y={x:0,y:0};if(a||r){let t,a,h,x,u,c=l.x===i.x&&l.y===i.y,f=o.x===s.x&&o.y===s.y;0!==e||c?1!==e||f?(c&&(e+=1e-7),f&&(e-=1e-7),t=G(l,i,e),n?(a=G(i,s,e),h=G(s,o,e),x=G(t,a,e),u=G(a,h,e),y=G(x,u,e),y.angle=Q(x,u),r&&(y.cpts=[a,h,x,u])):(a=G(l,i,e),h=G(i,o,e),y=G(a,h,e),y.angle=Q(a,h),r&&(y.cpts=[a,h]))):(y.x=o.x,y.y=o.y,y.angle=Q(s,o)):(y.x=l.x,y.y=l.y,y.angle=Q(l,i))}else{let t=1-e;y=n?{x:t**3*l.x+3*t**2*e*i.x+3*t*e**2*s.x+e**3*o.x,y:t**3*l.y+3*t**2*e*i.y+3*t*e**2*s.y+e**3*o.y}:{x:t*t*l.x+2*t*e*i.x+e**2*o.x,y:t*t*l.y+2*t*e*i.y+e**2*o.y}}return y})(t,e,a):G(t[0],t[1],e,a),a&&n.angle<0&&(n.angle+=2*U),n}function _(t,e=!1){let a=[];return t[0].values[0],t[0].values[1],t.forEach(t=>{let{type:r,values:n}=t;if(n.length)if(e)for(let t=1;t<n.length;t+=2)a.push({x:n[t-1],y:n[t]});else a.push({x:n[n.length-2],y:n[n.length-1]})}),a}function tt(t){return 4===t.length?function(t,e,a,r){let[n,l,i,s,o,y,h,x]=[t.x,t.y,e.x,e.y,a.x,a.y,r.x,r.y],u=Math.min(t.y,r.y),c=Math.min(t.x,r.x),f=Math.max(t.x,r.x),p=Math.max(t.y,r.y);if(e.y>=u&&e.y<=p&&a.y>=u&&a.y<=p&&e.x>=c&&e.x<=f&&a.x>=c&&a.x<=f)return[];for(var g,d,m,v,w,b,M,A,L=[],S=0;S<2;++S)if(0==S?(d=6*n-12*i+6*o,g=-3*n+9*i-9*o+3*h,m=3*i-3*n):(d=6*l-12*s+6*y,g=-3*l+9*s-9*y+3*x,m=3*s-3*l),Math.abs(g)<1e-12){if(Math.abs(d)<1e-12)continue;0<(v=-m/d)&&v<1&&L.push(v)}else(M=d*d-4*m*g)<0?Math.abs(M)<1e-12&&0<(v=-d/(2*g))&&v<1&&L.push(v):(0<(w=(-d+(A=Math.sqrt(M)))/(2*g))&&w<1&&L.push(w),0<(b=(-d-A)/(2*g))&&b<1&&L.push(b));var z=L.length;for(;z--;)v=L[z];return L}(t[0],t[1],t[2],t[3]):function(t,e,a){let r,n,l,i=Math.min(t.y,a.y),s=Math.min(t.x,a.x),o=Math.max(t.x,a.x),y=Math.max(t.y,a.y);if(e.y>=i&&e.y<=y&&e.x>=s&&e.x<=o)return[];let[h,x,u,c,f,p]=[t.x,t.y,e.x,e.y,a.x,a.y],g=[];for(var d=0;d<2;++d)r=0==d?h-2*u+f:x-2*c+p,n=0==d?-2*h+2*u:-2*x+2*c,Math.abs(r)>1e-12&&(l=-n/(2*r),l>0&&l<1&&g.push(l));return g}(t[0],t[1],t[2])}function et(t,e){let a,r,n,l,i,s,o=[],y=[],h=t[0],x=t[1],u=t[t.length-2],c=t[t.length-1];return 4===t.length?(a=K([h,x],e),r=K([x,u],e),n=K([u,c],e),l=K([a,r],e),i=K([r,n],e),s=K([l,i],e),o.push({x:h.x,y:h.y},{x:a.x,y:a.y},{x:l.x,y:l.y},{x:s.x,y:s.y}),y.push({x:s.x,y:s.y},{x:i.x,y:i.y},{x:n.x,y:n.y},{x:c.x,y:c.y})):3===t.length?(r=K([h,x],e),n=K([x,c],e),s=K([r,n],e),o.push({x:h.x,y:h.y},{x:r.x,y:r.y},{x:s.x,y:s.y}),y.push({x:s.x,y:s.y},{x:n.x,y:n.y},{x:c.x,y:c.y})):2===t.length&&(r=K([h,c],e),o.push({x:h.x,y:h.y},{x:r.x,y:r.y}),y.push({x:r.x,y:r.y},{x:c.x,y:c.y})),[o,y]}function at(t,e,a=!1){let r=[],n=6===e.length?"C":"Q",l={x:e[0],y:e[1]},i="C"===n?{x:e[2],y:e[3]}:l,s={x:e[4],y:e[5]},o=Math.max(s.x,t.x),y=Math.min(s.x,t.x),h=Math.max(s.y,t.y),x=Math.min(s.y,t.y),u=0,c=[];if(l.x<y||l.x>o||l.y<x||l.y>h||i.x<y||i.x>o||i.y<x||i.y>h){if(c=tt("C"===n?[t,l,i,s]:[t,l,s]).sort(),c=c.filter(t=>t>.05&&t<.95),c.length){let a=function(t,e,a,r=!0){let n=[];if(!a.length)return!1;let l,i,s,o=e.length,y={x:e[o-2],y:e[o-1]};2===e.length?s=[t,y]:4===e.length?(l={x:e[0],y:e[1]},s=[t,l,y]):6===e.length&&(l={x:e[0],y:e[1]},i={x:e[2],y:e[3]},s=[t,l,i,y]);if(a.length)if(1===a.length){let t=et(s,a[0]),e=t[0],r=t[1];n.push(e,r)}else{let t=a[0],e=et(s,t),r=e[0];n.push(r),s=e[1];for(let e=1;e<a.length;e++){t=a[e-1];let r=et(s,(a[e]-t)/(1-t));n.push(r[0]),e===a.length-1&&n.push(r[r.length-1]),s=r[1]}}if(r){let t,e,a=[];return n.forEach(r=>{t={type:"",values:[]},r.shift(),e=r.map(t=>Object.values(t)).flat(),t.values=e,3===r.length?t.type="C":2===r.length?t.type="Q":1===r.length&&(t.type="L"),a.push(t)}),a}return n}(t,e,c);r.push(...a),u+=a.length}else r.push({type:n,values:e})}else r.push({type:n,values:e});return{pathData:r,count:u,tArr:c}}function rt(t,e=!1){let a=[t[0]],r={x:t[0].values[0],y:t[0].values[1]},n={x:t[0].values[0],y:t[0].values[1]},l=t.length;for(let i=1;l&&i<l;i++){let l=t[i],{type:s,values:o}=l,y=o.slice(-2);if(y[0],y[1],"C"!==s&&"Q"!==s)a.push(l);else if("C"===s||"Q"===s){let t=at(r,o,e),{pathData:n,tArr:l=[]}=t;n.length>1&&(n.forEach((t,e)=>{if(e<n.length-1){let{values:e}=t;e.slice(-2)}}),e&&l.forEach((t,e)=>{n[e].t=t})),a.push(...n)}r={x:y[0],y:y[1]},"z"===s.toLowerCase()?r=n:"M"===s&&(n={x:y[0],y:y[1]})}return a}function nt(t,e=-1){let a=t.map(t=>t.x),r=t.map(t=>t.y),n=Math.min(...a),l=Math.max(...a),i=Math.min(...r),s=Math.max(...r),o={x:n,left:n,right:l,y:i,top:i,bottom:s,width:l-n,height:s-i};if(e>-1)for(let t in o)o[t]=+o[t].toFixed(e);return o}function lt(t,e){let[a,r,n,l,i,s]=[t.x,t.y,t.width,t.height,t.x+t.width,t.y+t.height],[o,y,h,x,u,c]=[e.x,e.y,e.width,e.height,e.x+e.width,e.y+e.height],f=!1;return n*l!=h*x&&n*l>h*x&&a<o&&i>u&&r<y&&s>c&&(f=!0),f}function it(t,e=.001){let a=0;for(let e=0,r=t.length;r&&e<r;e++){a+=t[e].x*t[e===t.length-1?0:e+1].y*.5-t[e===t.length-1?0:e+1].x*t[e].y*.5}return a}function st(t,e){let a=0,r="z"===t[t.length-1].type.toLowerCase();if(!r||e<1||t.length<3)return t;let n=r?1:0;!function(t){let e=t.length,a="Z"==t[e-1].type,r=t[0],[n,l]=[r.values[0],r.values[1]].map(t=>+t.toFixed(8)),i=a?t[e-2]:t[e-1],s=i.values.length,[o,y]=[i.values[s-2],i.values[s-1]].map(t=>+t.toFixed(8));!a||n==o&&l==y||(t.pop(),t.push({type:"L",values:[n,l]},{type:"Z",values:[]}))}(t),a=e+1<t.length-1?e+1:t.length-1-n;let l,i,s=t.slice(a),o=t.slice(0,a);return o.shift(),l=o[o.length-1].values||[],i=[l[l.length-2],l[l.length-1]],n&&(s.pop(),o.push({type:"Z",values:[]})),t=[{type:"M",values:i},...s,...o]}function ot(t,{removeFinalLineto:e=!0,startToTop:a=!0,bb:r={x:0,y:0,width:0,height:0}}={}){let n=[],l=t.length,i={x:t[0].values[0],y:t[0].values[1]};if(!("z"===t[l-1].type.toLowerCase()))return t;let s=0;if(a){let e=[];for(let a=0,r=t.length;a<r;a++){let r=t[a],{type:n,values:l}=r;if(l.length){let t=l.slice(-2),r={x:t[0],y:t[1],dist:0,index:0};r.index=a,e.push(r)}}e=e.sort((t,e)=>t.y-e.y||t.x-e.x),s=e[0].index}l=(t=st(t,s)).length,i={x:t[0].values[0],y:t[0].values[1]};let o=t[l-2],y=o.type,h=o.values.slice(-2),x=1e-5,u=Math.abs(h[0]-i.x),c=Math.abs(h[1]-i.y);return e&&("L"===y&&u<x&&c<x)&&t.splice(l-2,1),n.push(...t),console.log("pathDataToTopLeft2",n),n}function yt(t,e=!1,a=!0){let r=[];new Set([...t.map(t=>t.type)]);let n=t.length,l=t[0].values[0],i=t[0].values[1];if(!("z"===t[n-1].type.toLowerCase()))return t;let s=0,o={x:0,y:0};if(a){let e=[];for(let a=0,r=t.length;a<r;a++){let r=t[a],{type:n,values:l}=r;if(l.length){let t=l.slice(-2),r={x:t[0],y:t[1],dist:0,index:0};r.dist=W(o,r),r.index=a,e.push(r)}}e=e.sort((t,e)=>t.dist-e.dist||t.y-e.y),s=e[0].index}n=(t=st(t,s)).length;let y=t[n-2],h=y.type,x=y.values.slice(-2),u="L"===h&&x[0]===l&&x[1]===i;return e&&u&&t.splice(n-2,1),r.push(...t),r}function ht(t,e=-1){let a=!("auto"!=e||!t[0].hasOwnProperty("decimals"));for(let r=0,n=t.length;r<n;r++){let n=t[r];(e>-1||a)&&(e=a?n.decimals:e,t[r].values=n.values.map(t=>t?+t.toFixed(e):t))}return t}function xt(t,{toShorthands:e=!0,toRelative:a=!0,decimals:r=3}={}){return r>-1&&r<2&&(t=ht(t,r)),e&&(t=function(t,e=-1,a=!0){let r;if(a){let e=t.map(t=>t.type).join("");r=/[astvqmhlc]/g.test(e)}t=a&&r?function(t,e=-1){return ut(t,!1,e)}(t,e):t;let n={type:"M",values:t[0].values};t[0].decimals&&(n.decimals=t[0].decimals);let l,i=[n],s={x:t[0].values[0],y:t[0].values[1]},o=.01;for(let a=1,r=t.length;a<r;a++){let r=t[a],{type:y,values:h}=r,x=h.slice(-2),u=t[a-1],c=u.type;l={x:x[0],y:x[1]};let f,p,g,d,m={x:h[0],y:h[1]},v=Math.abs(l.x-s.x),w=Math.abs(l.y-s.y),b=(v+w)/2*o;switch(y){case"L":n=0===w||w<b&&v>b?{type:"H",values:[h[0]]}:0===v||w>b&&v<b?{type:"V",values:[h[1]]}:r;break;case"Q":if("Q"!==c){s={x:x[0],y:x[1]},i.push(r);continue}let t={x:u.values[0],y:u.values[1]};d={x:2*s.x-t.x,y:2*s.y-t.y},f=Math.abs(m.x-d.x),p=Math.abs(m.y-d.y),g=(f+p)/2,n=g<b?{type:"T",values:[l.x,l.y]}:r;break;case"C":let e={x:h[2],y:h[3]};if("C"!==c){i.push(r),s={x:x[0],y:x[1]};continue}let a={x:u.values[2],y:u.values[3]};d={x:2*s.x-a.x,y:2*s.y-a.y},f=Math.abs(m.x-d.x),p=Math.abs(m.y-d.y),g=(f+p)/2,n=g<b?{type:"S",values:[e.x,e.y,l.x,l.y]}:r;break;default:n={type:y,values:h}}(r.decimals||0===r.decimals)&&(n.decimals=r.decimals),e>-1&&(n.values=n.values.map(t=>+t.toFixed(e))),s={x:x[0],y:x[1]},i.push(n)}return i}(t)),a&&(t=function(t,e=-1){return ut(t,!0,e)}(t)),r>-1&&(t=ht(t,r)),t}function ut(t,e=!1,a=-1){a>=0&&(t[0].values=t[0].values.map(t=>+t.toFixed(a)));let r=t[0].values,n=r[0],l=r[1],i=n,s=l;for(let r=1,o=t.length;r<o;r++){let o=t[r],{type:y,values:h}=o,x=e?y.toLowerCase():y.toUpperCase();if(y!==x)switch(y=x,o.type=y,y){case"a":case"A":h[5]=e?h[5]-n:h[5]+n,h[6]=e?h[6]-l:h[6]+l;break;case"v":case"V":h[0]=e?h[0]-l:h[0]+l;break;case"h":case"H":h[0]=e?h[0]-n:h[0]+n;break;case"m":case"M":e?(h[0]-=n,h[1]-=l):(h[0]+=n,h[1]+=l),i=e?h[0]+n:h[0],s=e?h[1]+l:h[1];break;default:if(h.length)for(let t=0;t<h.length;t++)h[t]=e?h[t]-(t%2?l:n):h[t]+(t%2?l:n)}let u=h.length;switch(y){case"z":case"Z":n=i,l=s;break;case"h":case"H":n=e?n+h[0]:h[0];break;case"v":case"V":l=e?l+h[0]:h[0];break;case"m":case"M":i=h[u-2]+(e?n:0),s=h[u-1]+(e?l:0);default:n=h[u-2]+(e?n:0),l=h[u-1]+(e?l:0)}a>=0&&(o.values=o.values.map(t=>+t.toFixed(a)))}return t}function ct(t,e=1e-5){let a=[t[0]],r={x:t[0].values[0],y:t[0].values[1]},n=r,l=r;for(let i=1,s=t.length;i<s;i++){let o=t[i],y=t[i+1]||t[s-1],h="Z"===y.type?r:{x:y.values[y.values.length-2],y:y.values[y.values.length-1]},{type:x,values:u}=o,c=u.slice(-2);l="Z"!==x?{x:c[0],y:c[1]}:r;let f="C"===x?[{x:u[0],y:u[1]},{x:u[2],y:u[3]}]:"Q"===x?[{x:u[0],y:u[1]}]:[],p=Math.abs(it([n,...f,l,h]));n=l,p<e||("M"===x?(r=l,n=r):"Z"===x&&(n=r),a.push(o))}return a.push({type:"Z",values:[]}),a}function ft(t,{addExtremes:e=!1,sortSubPaths:a=!0,sortCommands:r=!0,fixFlatCubics:n=!0,removeCollinear:l=!0}={}){let i=[],s=function(t){let e=[];try{t.map((t,e)=>"m"===t.type.toLowerCase()?e:-1).filter(t=>-1!==t)}catch{console.log("catch",t)}let a=t.map((t,e)=>"m"===t.type.toLowerCase()?e:-1).filter(t=>-1!==t);return 1===a.length?[t]:(a.forEach((r,n)=>{e.push(t.slice(r,a[n+1]))}),e)}(t),o=s.map(t=>({pathData:t,bb:{},tolerance:0})),y=o.length;for(let t=0;t<y;t++){let{pathData:a}=o[t];if(e){a=rt(a,!0),o[t].pathData=a}let r=nt(_(a)),{width:n,height:l}=r;o[t].tolerance=(n+l)/2*.001,o[t].bb=r}let h=o.map(t=>[t.bb.x,t.bb.right]).flat(),x=o.map(t=>[t.bb.y,t.bb.bottom]).flat(),u=Math.min(...h),c=Math.max(...h),f=Math.min(...x),p=Math.max(...x),g={x:u,y:f,left:u,top:f,right:c,bottom:p,width:c-u,height:p-f},d={x:g.x,y:g.y};o.forEach((t,e)=>{let a={x:t.bb.x,y:t.bb.y},r=W(d,a);t.dist=r}),o.sort((t,e)=>t.dist-e.dist||t.bb.y-e.bb.y);for(let t=0;t<y;t++){let{pathData:e,tolerance:a,bb:r}=o[t];e=pt(e),e=ot(e,{bb:r}),e=ct(e),i.push(...e)}return i=xt(i),i}function pt(t){let e={x:t[0].values[0],y:t[0].values[1]},a=e,r=[t[0]];for(let n=1,l=t.length;n<l;n++){let l=t[n],{type:i,values:s,t:o=0}=l,y=s.slice(-2);a={x:y[0],y:y[1]},"L"===i&&a.x===e.x&&a.y===e.y||(r.push(l),e=a)}return r}function gt(t,e=-1,a=!1){"l"===t[1].type&&a&&(t[0].type="m");let r=`${t[0].type}${t[0].values.join(" ")}`;for(let n=1;n<t.length;n++){let l=t[n-1],i=t[n],s=l.type===i.type&&a||("m"===l.type&&"l"===i.type||"M"===l.type&&"l"===i.type||"M"===l.type&&"L"===i.type)&&a?" ":i.type;i.values.length&&e>-1&&(i.values=i.values.map(t=>+t.toFixed(e))),r+=`${s}${i.values.join(" ")}`}return a&&(r=r.replaceAll(" 0."," .").replaceAll(" -","-").replaceAll("-0.","-.").replace(/\s+([mlcsqtahvz])/gi,"$1").replaceAll("Z","z")),r}function dt(t={}){Object.assign(this,t)}async function mt(t,{turnpolicy:e="majority",turdsize:a=1,optcurve:r=!0,alphamax:n=1,opttolerance:l=1,minSize:i=1e3,maxSize:s=5e3,scale:o=1,brightness:y=1,contrast:h=1,invert:x=0,blur:u=0,crop:c=!0,optimize:f=!1,addDimensions:p=!0,toRelative:g=!0,toShorthands:d=!0,decimals:m=3}={}){let v=await w(t,{minSize:i,maxSize:s,crop:c,scale:o,brightness:y,contrast:h,invert:x,blur:u}),{bmp:b,scaleAdjust:M,width:A,height:L}=v,{pathList:S,polygons:z}=C(b,{turnpolicy:e,turdsize:a,optcurve:r,alphamax:n,opttolerance:l,scaleAdjust:M,minSize:i,maxSize:s}),D=function(t=[],e=1){t.sort((t,e)=>t.minX-e.minX||t.minY-e.minY);let a=t.length,r=[];for(let n=0;n<a;n++){let a,l=[],i=t[n],{curve:s,minX:o,maxX:y,minY:h,maxY:x,sign:u}=i,c={x:o,y:h,width:y-o,height:x-h},f=s.n;l.push({type:"M",values:[s.c[3*(f-1)+2].x*e,s.c[3*(f-1)+2].y*e],bb:c,cw:"+"===u});for(let t=0;t<f;t++){let r=s.tag[t];"curve"===r?a=[{type:"C",values:[s.c[3*t].x*e,s.c[3*t].y*e,s.c[3*t+1].x*e,s.c[3*t+1].y*e,s.c[3*t+2].x*e,s.c[3*t+2].y*e]}]:"corner"===r&&(a=[{type:"L",values:[s.c[3*t+1].x*e,s.c[3*t+1].y*e]},{type:"L",values:[s.c[3*t+2].x*e,s.c[3*t+2].y*e]}]),l.push(...a)}l.push({type:"Z",values:[]}),r.push(l)}return r}(S,o=1/M);if(!D.flat().length)throw new Error("Couldn't trace image");let $=function(t,e,a,{toRelative:r=!0,toShorthands:n=!0,decimals:l=3,addDimensions:i=!1,optimize:s=!1}={}){e=Math.ceil(e),a=Math.ceil(a);let o=[],y=t.length;for(let e=0;e<y;e++){let a=t[e],r=a[0].bb,n=_(a,!0);o.push({pathData:a,bb:r,poly:n,includes:[]})}if(s)for(let t=0,e=o.length;t<e;t++){let{pathData:e,bb:a}=o[t];e=pt(e),e=yt(e),e=ct(e),o[t].pathData=e}for(let t=0,e=o.length;t<e;t++){let a=o[t],{bb:r,poly:n}=a;for(let a=0;a<e;a++){let e=o[a];if(t===a)continue;let[l,i]=[e.bb,e.poly];if(!lt(r,l))continue;let s=[{x:l.x+.5*l.width,y:l.y+.5*l.height},i[0],i[Math.floor(i.length/2)],i[i.length-1]],y=!1;for(let t=0;t<s.length;t++)if(J(s[t],n,r,!0)){y=!0;break}y&&o[t].includes.push(a)}}for(let t=0,e=o.length;t<e;t++){let e=o[t],{includes:a}=e;a.forEach(e=>{let a=o[e].pathData;a.length&&(o[t].pathData.push(...a),o[e].pathData=[])})}o=o.filter(t=>t.pathData.length);let h=JSON.parse(JSON.stringify(o)).map(t=>t.pathData),x=JSON.parse(JSON.stringify(h)).flat(),u=i?`width="${e}" height="${a}" `:"",c=`<svg viewBox="0 0 ${e} ${a}" ${u}xmlns="http://www.w3.org/2000/svg">`,f=[];o.forEach(t=>{let{pathData:e}=t;try{(r||n||-1!=l)&&(e=xt(e,{toRelative:r,toShorthands:n,decimals:l}));let t=gt(e,l);f.push(t),c+=`<path d="${t}"/>`}catch{console.warn("catch pathdata could not be parsed",e)}}),c+="</svg>",(r||n||-1!=l)&&(x=xt(x,{toRelative:r,toShorthands:n,decimals:l}));let p=gt(x,l),g=`<svg viewBox="0 0 ${e} ${a}" ${u}xmlns="http://www.w3.org/2000/svg"><path d="${p}"/></svg>`;return{width:e,height:a,commands:x.length,svg:g,d:p,svgSplit:c,dArr:f,pathData:x,pathDataArr:h}}(D,A,L,{addDimensions:p,toRelative:g,toShorthands:d,optimize:f,decimals:m});return $.scaleAdjust=M,new dt($)}dt.prototype.getSVG=function(t=!1){return t?this.svgSplit:this.svg},dt.prototype.getPathData=function(){return this.pathDataNorm},dt.prototype.getPathDataNorm=function(){return this.pathDataNorm},dt.prototype.getD=function(){return this.d},"undefined"!=typeof window&&(window.pathDataToD=gt,window.PotracePlus=mt,window.svg2Canvas=M);export{v as PI,dt as PotraceObj,mt as PotracePlus,t as abs,e as acos,a as asin,r as atan,n as atan2,l as ceil,i as cos,s as exp,ft as fixPathData,o as floor,h as hypot,y as log,x as max,u as min,c as pow,f as random,p as round,g as sin,d as sqrt,M as svg2Canvas,m as tan};
